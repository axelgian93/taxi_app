(()=>{var e={};e.id=661,e.ids=[661],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6531:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=s(3191),a=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["trips",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7930)),"/app/src/app/admin/trips/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/admin/trips/page.tsx"],u="/admin/trips/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/trips/page",pathname:"/admin/trips",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9189:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4047:(e,t,s)=>{Promise.resolve().then(s.bind(s,933)),Promise.resolve().then(s.bind(s,6618)),Promise.resolve().then(s.bind(s,8482))},385:(e,t,s)=>{Promise.resolve().then(s.bind(s,5095))},5047:(e,t,s)=>{"use strict";var r=s(7389);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},5095:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(326),a=s(7577),n=s(434),i=s(5047),l=s(8069),o=s(6208),d=s(2326);function c(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[m,p]=(0,a.useState)(null),[x,j]=(0,a.useState)(void 0),[f,g]=(0,a.useState)(!1),[y,v]=(0,a.useState)(""),b=(0,i.useSearchParams)(),C=(0,i.useRouter)(),[N,w]=(0,a.useState)(b.get("status")||""),[S,E]=(0,a.useState)(b.get("city")||""),[P,D]=(0,a.useState)(b.get("from")||""),[T,A]=(0,a.useState)(b.get("to")||""),[R,I]=(0,a.useState)(()=>{let e=Number(b.get("pages")||"1");return isFinite(e)&&e>=1?Math.floor(e):1}),L=(0,a.useMemo)(()=>{let e=new URLSearchParams;return e.set("limit","50"),N&&e.set("status",N),S&&e.set("city",S),P&&e.set("from",P),T&&e.set("to",T),e.toString()},[N,S,P,T]),[k,M]=(0,a.useState)(!0),[$,q]=(0,a.useState)({}),_=(0,a.useMemo)(()=>{let t=P?Date.parse(P):null,s=T?Date.parse(T+"T23:59:59"):null;return e.filter(e=>{if(N&&e.status!==N||S&&(e.city||"").toLowerCase()!==S.toLowerCase())return!1;if(t||s){let r=e.requestedAt?Date.parse(e.requestedAt):NaN;if(!isFinite(r)||t&&r<t||s&&r>s)return!1}return!y||!!e.id.toLowerCase().includes(y.trim().toLowerCase())})},[e,N,S,P,T,y]);async function O(){let e=(0,o.oC)();if(e&&x){c(!0);try{let s=L?"&":"",r=await (0,l.j)(`/admin/trips?${L}${s}cursor=${encodeURIComponent(x)}`,{},e);t(e=>[...e,...r.items||[]]),j(r.nextCursor),g(!!r.nextCursor)}catch(e){p(e?.message||"Error al cargar m\xe1s trips")}finally{c(!1)}}}return s?(0,r.jsxs)("div",{children:[r.jsx("h2",{children:"Trips"}),r.jsx("div",{className:"card",style:{marginTop:10},children:(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[r.jsx(d.qM,{height:32,width:140}),r.jsx(d.qM,{height:32,width:140}),r.jsx(d.qM,{height:32,width:180}),r.jsx(d.qM,{height:32,width:180})]})}),r.jsx("div",{className:"table-wrap",style:{marginTop:10},children:r.jsx(d.qM,{height:240})})]}):m?r.jsx("div",{style:{color:"var(--danger)"},children:m}):(0,r.jsxs)("div",{children:[r.jsx("h2",{children:"Trips"}),(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between",margin:"8px 0",alignItems:"center"},children:[(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[["","REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED","COMPLETED","CANCELED"].map(e=>r.jsx("button",{className:`btn ${N===e?"":"secondary"}`,onClick:()=>w(e),"aria-pressed":N===e,"aria-label":`Filtro ${e||"Todos"}`,children:e||"Todos"},e||"ALL")),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[r.jsx("span",{className:"muted",children:"Buscar ID"}),r.jsx("input",{"aria-label":"Buscar por ID",placeholder:"trp_...",value:y,onChange:e=>v(e.target.value)})]})]}),r.jsx("button",{className:"btn secondary",onClick:()=>(function(e){let t=["id","status","riderId","driverId","city","requestedAt"],s=e.map(e=>t.map(t=>String(e[t]??""))),r=new Blob([[t.join(","),...s.map(e=>e.map(e=>/[,"]/.test(e)?`"${e.replace(/"/g,'""')}"`:e).join(","))].join("\n")+"\n"],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=`trips_export_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)})(_),style:{marginRight:8},children:"Export CSV"}),(0,r.jsxs)("button",{className:"btn secondary",onClick:()=>M(e=>!e),children:[k?"Pausar":"Reanudar"," auto-refresh"]})]}),r.jsx(u,{status:N,city:S,from:P,to:T,onChange:e=>{t([]),j(void 0),g(!1),w(e.status),E(e.city),D(e.from),A(e.to);let s=new URLSearchParams;e.status&&s.set("status",e.status),e.city&&s.set("city",e.city),e.from&&s.set("from",e.from),e.to&&s.set("to",e.to),s.set("pages","1");let r=s.toString();C.replace(`/admin/trips${r?`?${r}`:""}`)}}),0!==_.length||s?null:r.jsx("div",{className:"muted",style:{marginTop:8},children:"Sin resultados con los filtros actuales."}),(0,r.jsxs)("table",{className:"table",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"ID"}),r.jsx("th",{children:"Status"}),r.jsx("th",{children:"Rider"}),r.jsx("th",{children:"Driver"}),r.jsx("th",{children:"Ciudad"}),r.jsx("th",{children:"Requested"}),r.jsx("th",{children:"Acciones"})]})}),(0,r.jsxs)("tbody",{children:[_.map(e=>(0,r.jsxs)("tr",{className:$[e.id]?"flash":"",children:[r.jsx("td",{children:r.jsx(n.default,{href:`/admin/trips/${e.id}`,children:e.id})}),r.jsx("td",{children:e.status}),r.jsx("td",{className:"muted",children:e.riderId||"-"}),r.jsx("td",{className:"muted",children:e.driverId||"-"}),r.jsx("td",{className:"muted",children:e.city||"-"}),r.jsx("td",{className:"muted",children:function(e){if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}}(e.requestedAt)}),r.jsx("td",{children:r.jsx("button",{className:"btn secondary",disabled:"COMPLETED"===e.status||"CANCELED"===e.status||s,onClick:()=>h(e.id),children:"Cancelar"})})]},e.id)),s&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,children:(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[r.jsx(d.qM,{height:18,width:120}),r.jsx(d.qM,{height:18,width:200}),r.jsx(d.qM,{height:18,width:160})]})})})]})]}),r.jsx("div",{style:{marginTop:12},children:f?r.jsx("button",{className:"btn",onClick:O,disabled:s,children:s?"Cargandoâ€¦":"Cargar m\xe1s"}):r.jsx("span",{className:"muted",children:"No hay m\xe1s resultados"})})]})}function u(e){let{status:t,city:s,from:a,to:n,onChange:i}=e;return r.jsx("div",{className:"card",style:{margin:"12px 0"},children:(0,r.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:16},children:[(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Estado"}),(0,r.jsxs)("select",{value:t,onChange:e=>i({status:e.target.value,city:s,from:a,to:n}),children:[r.jsx("option",{value:"",children:"Todos"}),r.jsx("option",{value:"ASSIGNED",children:"ASSIGNED"}),r.jsx("option",{value:"ACCEPTED",children:"ACCEPTED"}),r.jsx("option",{value:"ARRIVED",children:"ARRIVED"}),r.jsx("option",{value:"STARTED",children:"STARTED"}),r.jsx("option",{value:"COMPLETED",children:"COMPLETED"}),r.jsx("option",{value:"CANCELLED",children:"CANCELLED"})]})]}),(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Ciudad"}),r.jsx("input",{value:s,onChange:e=>i({status:t,city:e.target.value,from:a,to:n}),placeholder:"Guayaquil",style:{padding:6,borderRadius:8}})]}),(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Desde"}),r.jsx("input",{type:"date",value:a,onChange:e=>i({status:t,city:s,from:e.target.value,to:n})})]}),(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Hasta"}),r.jsx("input",{type:"date",value:n,onChange:e=>i({status:t,city:s,from:a,to:e.target.value})})]}),r.jsx("button",{className:"btn secondary",onClick:()=>i({status:"",city:"",from:"",to:""}),children:"Limpiar"})]})})}async function h(e){if(!confirm("\xbfCancelar este viaje?"))return;let t=prompt("Motivo de cancelaci\xf3n (opcional):","ADMIN_PANEL"),s=(0,o.oC)();if(!s){location.href="/login";return}try{await (0,l.j)(`/trips/${encodeURIComponent(e)}/cancel`,{method:"POST",body:JSON.stringify({reason:t||"ADMIN_PANEL"})},s),location.href=location.href}catch(e){alert(e?.message||"No se pudo cancelar")}}},8482:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(326),a=s(7577),n=s.n(a),i=s(434),l=s(6208);let o="http://localhost:8081";function d(){let[e,t]=(0,a.useState)(()=>!1),[s,n]=(0,a.useState)(!1),[i,d]=(0,a.useState)(null);async function c(){n(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/seed`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Seed HTTP ${t.status}`);d("Demo iniciada")}catch(e){d(e?.message||"Error en seed")}finally{n(!1)}}async function u(){n(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/reset`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Reset HTTP ${t.status}`);d("Demo reseteada")}catch(e){d(e?.message||"Error en reset")}finally{n(!1)}}async function h(){let s=!e;t(s),s?await c():await u()}return(0,r.jsxs)("div",{style:{background:e?"#0b4":"#444",color:"white",padding:"6px 12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[r.jsx("strong",{children:"Modo Demo"}),r.jsx("span",{className:"muted",children:e?"activo":"inactivo"}),i&&r.jsx("span",{style:{opacity:.8},children:i})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[r.jsx("button",{className:"btn secondary",onClick:h,disabled:s,children:e?"Detener":"Iniciar"}),e&&r.jsx("button",{className:"btn secondary",onClick:u,disabled:s,children:"Reset ahora"})]})]})}function c(){let[e,t]=(0,a.useState)(""),[s,n]=(0,a.useState)("");if(!e)return null;let i=s?` ${s.toLowerCase()}`:"";return(0,r.jsxs)("span",{className:"muted",style:{marginLeft:12},children:["v",e,i?` (${i})`:""]})}var u=s(8145);function h({children:e}){return(0,r.jsxs)(r.Fragment,{children:[r.jsx(d,{}),(0,r.jsxs)("header",{className:"container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{className:"row",children:[r.jsx("strong",{children:"Taxi App"}),(0,r.jsxs)("nav",{className:"row",style:{gap:16},children:[r.jsx(i.default,{href:"/",children:"Inicio"}),r.jsx(i.default,{href:"/admin/trips",children:"Trips"}),r.jsx(i.default,{href:"/admin/tariffs",children:"Tarifas"}),r.jsx(i.default,{href:"/admin/simulator",children:"Simulador"}),r.jsx(i.default,{href:"/admin/reports",children:"Reportes"}),r.jsx(i.default,{href:"/admin/ops",children:"Operaciones"})]})]}),r.jsx(m,{})]}),r.jsx(u.V,{children:r.jsx("main",{className:"container",children:e})}),(0,r.jsxs)("footer",{className:"container",style:{marginTop:24,paddingBottom:24,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[r.jsx(i.default,{href:"/admin/readme",children:"Gu\xeda de Demo"}),r.jsx(c,{})]})]})}function m(){let[e,t]=n().useState(()=>(0,l.PR)());return e?(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("span",{className:"muted",children:[e.email," (",e.role,")"]}),r.jsx("button",{className:"btn secondary",onClick:()=>{(0,l.DH)(),location.href="/login"},children:"Salir"})]}):r.jsx(i.default,{className:"btn secondary",href:"/login",children:"Ingresar"})}},2326:(e,t,s)=>{"use strict";s.d(t,{ik:()=>n,qM:()=>a});var r=s(326);function a({height:e=16,width:t="100%",style:s,className:a}){return r.jsx("div",{className:a,style:{height:e,width:t,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...s}})}function n({lines:e=3}){return r.jsx("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:e}).map((e,t)=>r.jsx(a,{height:12,width:`${80-8*t}%`},t))})}s(7577)},8145:(e,t,s)=>{"use strict";s.d(t,{V:()=>l,p:()=>i});var r=s(326),a=s(7577);let n=(0,a.createContext)(null);function i(){let e=(0,a.useContext)(n);if(!e)throw Error("useToast must be used within ToastProvider");return e}function l({children:e}){let[t,s]=(0,a.useState)([]),i=(e,t="info",r=3200)=>{let a=Date.now()+Math.floor(1e3*Math.random()),n={id:a,kind:t,text:e,ttl:Date.now()+r};s(e=>[...e,n]),setTimeout(()=>s(e=>e.filter(e=>e.id!==a)),r)},l=(0,a.useMemo)(()=>({show:i}),[]);return(0,r.jsxs)(n.Provider,{value:l,children:[e,r.jsx("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:t.map(e=>(0,r.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:`4px solid ${"success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6"}`},children:[r.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),r.jsx("div",{className:"muted",children:e.text})]},e.id))})]})}},8069:(e,t,s)=>{"use strict";s.d(t,{S:()=>r,j:()=>a});let r="http://localhost:8081";async function a(e,t={},s){let a=new Headers(t.headers||{});a.set("Content-Type","application/json"),s&&a.set("Authorization",`Bearer ${s}`);let n=await fetch(`${r}${e}`,{...t,headers:a,cache:"no-store"});if(!n.ok){let e=await n.text().catch(()=>"");throw Error(`API ${n.status}: ${e||n.statusText}`)}return n.json()}},6208:(e,t,s)=>{"use strict";function r(e,t){}function a(){return null}function n(){}function i(){return null}s.d(t,{DH:()=>n,J1:()=>r,PR:()=>a,oC:()=>i})},7930:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/app/src/app/admin/trips/page.tsx#default`)},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(9510);s(4315),s(1159);let a=(0,s(5782).default)(()=>s.e(298).then(s.bind(s,7298)),{loadableGenerated:{modules:["app/layout.tsx -> @/src/components/ClientShell"]},ssr:!1});function n({children:e}){return r.jsx("html",{lang:"es",children:r.jsx("body",{children:r.jsx(a,{children:e})})})}},4315:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[555],()=>s(6531));module.exports=r})();