(()=>{var e={};e.id=375,e.ids=[375],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3966:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>h,pages:()=>c,routeModule:()=>u,tree:()=>d});var a=s(3191),r=s(8716),n=s(7922),i=s.n(n),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["reports",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2789)),"/app/src/app/admin/reports/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/admin/reports/page.tsx"],h="/admin/reports/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/reports/page",pathname:"/admin/reports",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9189:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4047:(e,t,s)=>{Promise.resolve().then(s.bind(s,933)),Promise.resolve().then(s.bind(s,6618)),Promise.resolve().then(s.bind(s,8482))},1740:(e,t,s)=>{Promise.resolve().then(s.bind(s,4112))},5047:(e,t,s)=>{"use strict";var a=s(7389);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},4112:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(326),r=s(7577),n=s(5047),i=s(6208),l=s(2326);let o="http://localhost:8081";function d(){(0,n.useRouter)(),(0,n.useSearchParams)(),(0,r.useRef)(!1);let[e,t]=(0,r.useState)(""),[s,d]=(0,r.useState)(""),[x,N]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[M,D]=(0,r.useState)("city_method"),[P,$]=(0,r.useState)(1e3),[T,R]=(0,r.useState)(!1),[I,A]=(0,r.useState)([]),[_,B]=(0,r.useState)([]),[E,O]=(0,r.useState)([]),[L,U]=(0,r.useState)([]),[z,F]=(0,r.useState)([]),[q,G]=(0,r.useState)([]),[W,K]=(0,r.useState)([]),[Y,H]=(0,r.useState)(!1),[V,X]=(0,r.useState)(null),J=(0,r.useMemo)(()=>c(M),[M]),Z=(0,r.useMemo)(()=>h(I,J),[I,J]),Q=(0,r.useMemo)(()=>h(_,J),[_,J]),ee=(0,r.useMemo)(()=>u(I,J),[I,J]),et=(0,r.useMemo)(()=>u(_,J),[_,J]),es=(0,r.useMemo)(()=>h(E,c("day")),[E]),ea=(0,r.useMemo)(()=>h(L,c("city")),[L]),er=(0,r.useMemo)(()=>h(z,c("method")),[z]),en=(0,r.useMemo)(()=>y(I),[I]),ei=(0,r.useMemo)(()=>y(_),[_]),[el,eo]=(0,r.useState)(null);if(Y)return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[a.jsx("h2",{children:"Reportes"}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx(l.qM,{height:32,width:120}),a.jsx(l.qM,{height:32,width:140})]})]}),a.jsx("div",{className:"card",style:{marginTop:10},children:a.jsx(l.ik,{lines:2})}),a.jsx("div",{className:"card",style:{marginTop:10},children:a.jsx(l.qM,{height:260})}),(0,a.jsxs)("div",{className:"row",style:{gap:10,marginTop:10,flexWrap:"wrap"},children:[a.jsx(l.qM,{height:180,width:280}),a.jsx(l.qM,{height:180,width:280}),a.jsx(l.qM,{height:180,width:280})]})]});async function ed(){X(null);let t=(0,i.oC)();if(!t){location.href="/login";return}H(!0);try{let a=new URLSearchParams;e&&a.set("from",new Date(e).toISOString()),s&&a.set("to",new Date(s+"T23:59:59").toISOString()),x&&a.set("city",x),k&&a.set("method",k),a.set("groupBy",M),a.set("format","json"),a.set("limit",String(P));let r=await fetch(`${o}/admin/revenue/report?${a}`,{headers:{Authorization:`Bearer ${(0,i.oC)()}`},cache:"no-store"});if(!r.ok)throw Error(`HTTP ${r.status}`);let n=await r.json(),l=Array.isArray(n.items)?n.items:[];if(A(l),B([]),T&&e&&s){let a=new Date(e),r=new Date(s+"T23:59:59").getTime()-a.getTime(),n=new Date(a.getTime()-1e3),i=new Date(n.getTime()-r),l=new URLSearchParams;l.set("from",i.toISOString()),l.set("to",n.toISOString()),x&&l.set("city",x),k&&l.set("method",k),l.set("groupBy",M),l.set("format","json"),l.set("limit",String(P));let d=await fetch(`${o}/admin/revenue/report?${l}`,{headers:{Authorization:`Bearer ${t}`},cache:"no-store"});if(d.ok){let e=await d.json();B(Array.isArray(e.items)?e.items:[])}}ec("day").then(O).catch(()=>O([])),ec("city").then(U).catch(()=>U([])),ec("method").then(F).catch(()=>F([])),S({from:e,to:s,city:x}).then(eo).catch(()=>eo(null)),g("city",{from:e,to:s,city:x,limit:P}).then(G).catch(()=>G([])),g("day",{from:e,to:s,city:x,limit:P}).then(K).catch(()=>K([]))}catch(e){X(e?.message||"Error al cargar reporte")}finally{H(!1)}}async function ec(t){let a=(0,i.oC)();if(!a)return[];let r=new URLSearchParams;e&&r.set("from",new Date(e).toISOString()),s&&r.set("to",new Date(s+"T23:59:59").toISOString()),x&&r.set("city",x),k&&r.set("method",k),r.set("groupBy",t),r.set("format","json"),r.set("limit",String(P));let n=await fetch(`${o}/admin/revenue/report?${r}`,{headers:{Authorization:`Bearer ${a}`},cache:"no-store"});if(!n.ok)return[];let l=await n.json();return Array.isArray(l.items)?l.items:[]}return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[a.jsx("h2",{children:"Reportes"}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("button",{className:"btn secondary",onClick:function(){let t=(0,i.oC)();if(!t){location.href="/login";return}let a=new URLSearchParams;e&&a.set("from",new Date(e).toISOString()),s&&a.set("to",new Date(s+"T23:59:59").toISOString()),x&&a.set("city",x),k&&a.set("method",k),a.set("groupBy",M),a.set("format","csv"),a.set("limit",String(P)),fetch(`${o}/admin/revenue/report?${a}`,{headers:{Authorization:`Bearer ${t}`}}).then(e=>e.blob()).then(e=>{let t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`revenue_${M}_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}).catch(()=>alert("No se pudo descargar CSV"))},children:"Export CSV"}),a.jsx("button",{className:"btn",onClick:ed,disabled:Y,children:Y?"Cargando…":"Actualizar"})]})]}),a.jsx(f,{gmv:en.gmv,count:en.count,avg:en.avg,tripSummary:el||void 0}),a.jsx("div",{className:"card",style:{margin:"10px 0"},children:(0,a.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Preset"}),a.jsx(w,{value:{from:e,to:s,city:x,method:k,groupBy:M,limit:P,compare:T},onLoad:e=>{t(e.from||""),d(e.to||""),N(e.city||""),C(e.method||""),D(e.groupBy||"city_method"),$(Number(e.limit||1e3)),R(!!e.compare)}})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Guardar preset"}),a.jsx("button",{className:"btn secondary",onClick:()=>(function(e){let t=prompt("Nombre del preset:")?.trim();if(!t)return;let s=(function(){try{return JSON.parse(localStorage.getItem(v)||"[]")}catch{return[]}})().filter(e=>e.name!==t);s.push({name:t,...e}),b(s),alert("Preset guardado")})({from:e,to:s,city:x,method:k,groupBy:M,limit:P,compare:T}),children:"Guardar"})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Rango r\xe1pido"}),(0,a.jsxs)("select",{value:"",onChange:e=>(function(e){let s,a;let r=e=>e.toString().padStart(2,"0"),n=e=>`${e.getFullYear()}-${r(e.getMonth()+1)}-${r(e.getDate())}`,i=new Date;if("today"===e)s=new Date(i.getFullYear(),i.getMonth(),i.getDate()),a=new Date(i.getFullYear(),i.getMonth(),i.getDate());else if("7d"===e)(s=new Date(a=new Date(i.getFullYear(),i.getMonth(),i.getDate()))).setDate(a.getDate()-6);else if("30d"===e)(s=new Date(a=new Date(i.getFullYear(),i.getMonth(),i.getDate()))).setDate(a.getDate()-29);else if("this_month"===e)s=new Date(i.getFullYear(),i.getMonth(),1),a=new Date(i.getFullYear(),i.getMonth()+1,0);else{if("prev_month"!==e)return;s=new Date(i.getFullYear(),i.getMonth()-1,1),a=new Date(i.getFullYear(),i.getMonth(),0)}t(n(s)),d(n(a))})(e.target.value),children:[a.jsx("option",{value:"",children:"Seleccionar…"}),a.jsx("option",{value:"today",children:"Hoy"}),a.jsx("option",{value:"7d",children:"\xdaltimos 7 d\xedas"}),a.jsx("option",{value:"30d",children:"\xdaltimos 30 d\xedas"}),a.jsx("option",{value:"this_month",children:"Este mes"}),a.jsx("option",{value:"prev_month",children:"Mes anterior"})]})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Desde"}),a.jsx("input",{type:"date",value:e,onChange:e=>t(e.target.value)})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Hasta"}),a.jsx("input",{type:"date",value:s,onChange:e=>d(e.target.value)})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Ciudad"}),a.jsx("input",{value:x,onChange:e=>N(e.target.value),placeholder:"Guayaquil"})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"M\xe9todo"}),a.jsx("input",{value:k,onChange:e=>C(e.target.value),placeholder:"CARD/CASH"})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"Grupo"}),(0,a.jsxs)("select",{value:M,onChange:e=>D(e.target.value),children:[a.jsx("option",{value:"city_method",children:"Ciudad + M\xe9todo"}),a.jsx("option",{value:"city",children:"Ciudad"}),a.jsx("option",{value:"method",children:"M\xe9todo"}),a.jsx("option",{value:"day",children:"D\xeda"}),a.jsx("option",{value:"city_day",children:"Ciudad + D\xeda"})]})]}),(0,a.jsxs)("label",{children:[a.jsx("div",{className:"muted",children:"L\xedmite"}),a.jsx("input",{type:"number",value:P,onChange:e=>$(Number(e.target.value))})]}),(0,a.jsxs)("label",{className:"row",style:{gap:8},children:[a.jsx("input",{type:"checkbox",checked:T,onChange:e=>R(e.target.checked),disabled:!e||!s}),a.jsx("span",{className:"muted",children:"Comparar vs periodo anterior"})]})]})}),(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[a.jsx(f,{gmv:en.gmv,count:en.count,avg:en.avg,prev:T?ei:void 0,tripSummary:el||void 0}),a.jsx("button",{className:"btn secondary",onClick:()=>(function(){try{let e=document.getElementById("main_chart");if(!e)return;let t=new XMLSerializer().serializeToString(e),s=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(s),r=new Image;r.onload=()=>{let t=document.createElement("canvas");t.width=e.width.baseVal.value,t.height=e.height.baseVal.value;let s=t.getContext("2d");s.fillStyle="#0b0f17",s.fillRect(0,0,t.width,t.height),s.drawImage(r,0,0),URL.revokeObjectURL(a);let n=document.createElement("a");n.download=`revenue_chart_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.png`,n.href=t.toDataURL("image/png"),n.click()},r.src=a}catch{}})(),"aria-label":"Exportar gr\xe1fico como PNG",children:"Export PNG"})]}),a.jsx(m,{series:Z,prevSeries:T?Q:void 0,dims:J,countTotals:ee,prevCountTotals:T?et:void 0,exportableId:"main_chart"}),(0,a.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap",marginTop:12},children:[(0,a.jsxs)("div",{style:{flex:"1 1 380px",minWidth:320},children:[a.jsx("div",{style:{marginBottom:6},children:a.jsx("strong",{children:"Por ciudad"})}),a.jsx(m,{series:ea,dims:c("city")})]}),(0,a.jsxs)("div",{style:{flex:"1 1 380px",minWidth:320},children:[a.jsx("div",{style:{marginBottom:6},children:a.jsx("strong",{children:"Por m\xe9todo"})}),a.jsx(j,{series:er})]})]}),(0,a.jsxs)("div",{style:{marginTop:12},children:[a.jsx("div",{style:{marginBottom:6},children:a.jsx("strong",{children:"Evoluci\xf3n diaria"})}),a.jsx(m,{series:es,dims:c("day")})]}),(0,a.jsxs)("div",{style:{marginTop:12},children:[a.jsx("div",{style:{marginBottom:6},children:a.jsx("strong",{children:"Trips por ciudad (Completed vs Canceled)"})}),a.jsx(p,{items:q})]}),(0,a.jsxs)("div",{style:{marginTop:12},children:[a.jsx("div",{style:{marginBottom:6},children:a.jsx("strong",{children:"Trips por d\xeda (Completed vs Canceled)"})}),a.jsx(p,{items:W})]}),(0,a.jsxs)("table",{className:"table",style:{marginTop:12},children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[J.keys.map(e=>a.jsx("th",{children:e},e)),a.jsx("th",{children:"Count"}),a.jsx("th",{children:"Amount (USD)"})]})}),a.jsx("tbody",{children:I.map((e,t)=>(0,a.jsxs)("tr",{children:[J.keys.map(t=>a.jsx("td",{children:String(e[t]??"")},t)),a.jsx("td",{className:"muted",children:Number(e.count||0)}),(0,a.jsxs)("td",{children:["$",Number(e.amountUsd||0).toFixed(2)]})]},t))})]})]})}function c(e){return"city"===e?{keys:["city"],primary:"city"}:"method"===e?{keys:["method"],primary:"method"}:"day"===e?{keys:["day"],primary:"day"}:"city_method"===e?{keys:["city","method"],primary:"city",secondary:"method"}:"city_day"===e?{keys:["city","day"],primary:"city",secondary:"day"}:{keys:[],primary:""}}function h(e,t){let s=new Map,a=new Set;for(let r of e){let e=String(r[t.primary]??"—"),n=t.secondary?String(r[t.secondary]??"—"):"",i=t.secondary?`${e}__${n}`:e;s.set(i,(s.get(i)||0)+Number(r.amountUsd||0)),t.secondary&&a.add(n)}let r=new Map;for(let[e,a]of s.entries())if(t.secondary){let[t,s]=e.split("__"),n=r.get(t)||{};n[s]=(n[s]||0)+a,r.set(t,n)}else r.set(e,{total:a});let n=Array.from(r.keys()),i=t.secondary?Array.from(a):["total"],l=n.map(e=>i.map(t=>r.get(e)?.[t]||0));return{labels:n,seriesKeys:i,data:l}}function m({series:e,prevSeries:t,dims:s,countTotals:r,prevCountTotals:n,exportableId:i}){let l=function(e,t){if(!t||0===t.seriesKeys.length)return e;let s=Array.from(new Set([...e.labels,...t.labels])),a=[],r=s.map(()=>[]);for(let t of e.seriesKeys)a.push(t);for(let e of t.seriesKeys)a.push(`${e} (prev)`);let n=new Map(e.labels.map((e,t)=>[e,t])),i=new Map(t.labels.map((e,t)=>[e,t]));return s.forEach((s,a)=>{let l=n.get(s),o=i.get(s);for(let t=0;t<e.seriesKeys.length;t++)r[a][t]=null!=l?e.data[l][t]:0;for(let s=0;s<t.seriesKeys.length;s++)r[a][e.seriesKeys.length+s]=null!=o?t.data[o][s]:0}),{labels:s,seriesKeys:a,data:r}}(e,t),o=Math.max(640,60*l.labels.length),d=o-60-20,c=Math.max(1,...l.data.flat()),h=["#4f46e5","#22c55e","#eab308","#ef4444","#06b6d4","#a855f7"],m=d/Math.max(1,l.labels.length),u=Math.max(10,(m-10)/Math.max(1,l.seriesKeys.length));return(0,a.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[a.jsx("svg",{id:i,width:o,height:260,role:"img","aria-label":"Revenue chart",children:(0,a.jsxs)("g",{transform:"translate(60,20)",children:[a.jsx("line",{x1:0,y1:0,x2:0,y2:180,stroke:"rgba(255,255,255,0.2)"}),a.jsx("line",{x1:0,y1:180,x2:d,y2:180,stroke:"rgba(255,255,255,0.2)"}),l.labels.map((e,t)=>{let s=t*m;return(0,a.jsxs)("g",{transform:`translate(${s},0)`,children:[l.seriesKeys.map((e,s)=>{let r=l.data[t][s]/c*170;return a.jsx("g",{children:a.jsx("rect",{x:s*u+4*s,y:180-r,width:u,height:r,fill:h[s%h.length],rx:3})},s)}),a.jsx("text",{x:m/2,y:194,textAnchor:"middle",fontSize:"10",fill:"#9aa4b2",children:e})]},t)}),r&&r.labels.length>0&&(0,a.jsxs)(a.Fragment,{children:[x(r,m,180,c,"#93c5fd"),n&&x(n,m,180,c,"#fda4af",2)]}),[0,.25,.5,.75,1].map((e,t)=>{let s=c*e,r=180-170*e;return(0,a.jsxs)("g",{children:[a.jsx("line",{x1:0,y1:r,x2:d,y2:r,stroke:"rgba(255,255,255,0.08)"}),(0,a.jsxs)("text",{x:-8,y:r,textAnchor:"end",alignmentBaseline:"middle",fontSize:"10",fill:"#9aa4b2",children:["$",s.toFixed(0)]})]},t)})]})}),(0,a.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[l.seriesKeys.map((e,t)=>(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:12,background:h[t%h.length],borderRadius:2,display:"inline-block"}}),a.jsx("span",{className:"muted",children:e})]},t)),r&&r.labels.length>0&&(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:2,background:"#93c5fd",display:"inline-block",alignSelf:"center"}}),a.jsx("span",{className:"muted",children:"Count"})]}),n&&n.labels.length>0&&(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:2,background:"#fda4af",display:"inline-block",alignSelf:"center"}}),a.jsx("span",{className:"muted",children:"Count (prev)"})]})]})]})}function u(e,t){let s=new Map;for(let a of e){let e=String(a[t.primary]??"—");s.set(e,(s.get(e)||0)+Number(a.count||0))}let a=Array.from(s.keys()),r=a.map(e=>s.get(e)||0);return{labels:a,data:r}}function x(e,t,s,r,n,i=0){let l=[];for(let a=0;a<e.labels.length;a++){let n=a*t+t/2,i=e.data[a]||0,o=s-(r>0?i/r*(s-10):0);l.push(`${n},${o}`)}return a.jsx("polyline",{fill:"none",stroke:n,strokeWidth:2,strokeDasharray:i?`${i},${i}`:void 0,points:l.join(" ")})}function p({items:e}){let t=Math.max(640,60*(e?.length||0)),s=t-60-20,r=e.map(e=>e.key),n=Math.max(1,...e.map(e=>e.total||0)),i=s/Math.max(1,r.length),l="#22c55e",o="#ef4444";return(0,a.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[a.jsx("svg",{width:t,height:240,role:"img","aria-label":"Trips counts",children:(0,a.jsxs)("g",{transform:"translate(60,20)",children:[a.jsx("line",{x1:0,y1:0,x2:0,y2:160,stroke:"rgba(255,255,255,0.2)"}),a.jsx("line",{x1:0,y1:160,x2:s,y2:160,stroke:"rgba(255,255,255,0.2)"}),e.map((e,t)=>{let s=t*i,r=Number(e.completed||0)/n*150,d=Number(e.canceled||0)/n*150,c=160-r;return(0,a.jsxs)("g",{transform:`translate(${s},0)`,children:[a.jsx("rect",{x:10,y:c-d,width:i-20,height:d,fill:o,rx:3}),a.jsx("rect",{x:10,y:c,width:i-20,height:r,fill:l,rx:3}),a.jsx("text",{x:i/2,y:174,textAnchor:"middle",fontSize:"10",fill:"#9aa4b2",children:e.key})]},t)}),[0,.25,.5,.75,1].map((e,t)=>{let r=160-150*e;return(0,a.jsxs)("g",{children:[a.jsx("line",{x1:0,y1:r,x2:s,y2:r,stroke:"rgba(255,255,255,0.08)"}),a.jsx("text",{x:-8,y:r,textAnchor:"end",alignmentBaseline:"middle",fontSize:"10",fill:"#9aa4b2",children:Math.round(n*e)})]},t)})]})}),(0,a.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:12,background:l,borderRadius:2,display:"inline-block"}}),a.jsx("span",{className:"muted",children:"Completed"})]}),(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:12,background:o,borderRadius:2,display:"inline-block"}}),a.jsx("span",{className:"muted",children:"Canceled"})]})]})]})}async function g(e,t){let s=(0,i.oC)();if(!s)return[];let a=new URLSearchParams;t.from&&a.set("from",new Date(t.from).toISOString()),t.to&&a.set("to",new Date(t.to+"T23:59:59").toISOString()),t.city&&a.set("city",t.city),a.set("groupBy",e),a.set("limit",String(t.limit));let r=await fetch(`${o}/admin/analytics/trips?${a}`,{headers:{Authorization:`Bearer ${s}`},cache:"no-store"});if(!r.ok)return[];let n=await r.json();return Array.isArray(n.items)?n.items:[]}function y(e){let t=e.reduce((e,t)=>e+Number(t.amountUsd||0),0),s=e.reduce((e,t)=>e+Number(t.count||0),0);return{gmv:t,count:s,avg:s>0?t/s:0}}function f({gmv:e,count:t,avg:s,prev:r,tripSummary:n}){let i=e=>`$${e.toFixed(2)}`,l=(e,t)=>{if(null==t||!isFinite(t)||0===t)return null;let s=e-t,r=s>0,n=0===s;return(0,a.jsxs)("span",{style:{color:n?"#9aa4b2":r?"#22c55e":"#ef4444",marginLeft:6,fontSize:12},children:[n?"•":r?"▲":"▼"," ",Math.abs(0!==t?s/t*100:0).toFixed(1),"%"]})},o=(e,t,s)=>(0,a.jsxs)("div",{className:"card",style:{padding:"12px 16px",flex:"1 1 160px"},children:[a.jsx("div",{className:"muted",style:{marginBottom:6},children:e}),(0,a.jsxs)("div",{style:{fontSize:22,fontWeight:600,display:"flex",alignItems:"center"},children:[t,s]})]});return(0,a.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap",marginTop:10},children:[o("GMV (USD)",i(e),l(e,r?.gmv)),o("Pagos (PAID)",String(t),l(t,r?.count)),o("Ticket promedio",i(s),l(s,r?.avg)),n?o("Cancel rate",`${(100*n.cancelRate).toFixed(1)}%`):null,n?o("Completion rate",`${(100*n.completionRate).toFixed(1)}%`):null]})}function j({series:e}){let t=e.data.flat().reduce((e,t)=>e+t,0),s=["#4f46e5","#22c55e","#eab308","#ef4444","#06b6d4","#a855f7"],r=0,n=e.labels.map((a,n)=>{let i=e.data[n][0]||0,l=t>0?i/t*Math.PI*2:0,o=r,d=r+l;return r=d,{d:`M 100 100 L ${100+70*Math.cos(o)} ${100+70*Math.sin(o)} A 70 70 0 ${l>Math.PI?1:0} 1 ${100+70*Math.cos(d)} ${100+70*Math.sin(d)} Z`,color:s[n%s.length],label:a,val:i}});return(0,a.jsxs)("div",{className:"card",style:{display:"flex",gap:12,alignItems:"center"},children:[a.jsx("svg",{width:220,height:220,viewBox:"0 0 200 200",children:n.map((e,t)=>a.jsx("path",{d:e.d,fill:e.color},t))}),a.jsx("div",{children:e.labels.map((e,t)=>(0,a.jsxs)("div",{className:"row",style:{gap:6},children:[a.jsx("span",{style:{width:12,height:12,background:s[t%s.length],borderRadius:2,display:"inline-block"}}),a.jsx("span",{className:"muted",children:e})]},t))})]})}let v="reports_presets";function b(e){localStorage.setItem(v,JSON.stringify(e))}function w({value:e,onLoad:t}){let[s,n]=(0,r.useState)([]),[i,l]=(0,r.useState)("");return(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[(0,a.jsxs)("select",{value:i,onChange:e=>l(e.target.value),children:[a.jsx("option",{value:"",children:"Seleccionar…"}),s.map(e=>a.jsx("option",{value:e.name,children:e.name},e.name))]}),a.jsx("button",{className:"btn secondary",onClick:()=>{let e=s.find(e=>e.name===i);e&&t(e)},children:"Cargar"}),a.jsx("button",{className:"btn secondary",onClick:()=>{if(!i)return;let e=s.filter(e=>e.name!==i);b(e),n(e),l("")},children:"Eliminar"})]})}async function S(e){let t=(0,i.oC)();if(!t)return{total:0,completed:0,canceled:0,completionRate:0,cancelRate:0};let s=new URLSearchParams;e.from&&s.set("from",new Date(e.from).toISOString()),e.to&&s.set("to",new Date(e.to+"T23:59:59").toISOString()),e.city&&s.set("city",e.city);let a=await fetch(`${o}/admin/analytics/trips?${s}`,{headers:{Authorization:`Bearer ${t}`},cache:"no-store"});return a.ok?a.json():{total:0,completed:0,canceled:0,completionRate:0,cancelRate:0}}},8482:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(326),r=s(7577),n=s.n(r),i=s(434),l=s(6208);let o="http://localhost:8081";function d(){let[e,t]=(0,r.useState)(()=>!1),[s,n]=(0,r.useState)(!1),[i,d]=(0,r.useState)(null);async function c(){n(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/seed`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Seed HTTP ${t.status}`);d("Demo iniciada")}catch(e){d(e?.message||"Error en seed")}finally{n(!1)}}async function h(){n(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/reset`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Reset HTTP ${t.status}`);d("Demo reseteada")}catch(e){d(e?.message||"Error en reset")}finally{n(!1)}}async function m(){let s=!e;t(s),s?await c():await h()}return(0,a.jsxs)("div",{style:{background:e?"#0b4":"#444",color:"white",padding:"6px 12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[a.jsx("strong",{children:"Modo Demo"}),a.jsx("span",{className:"muted",children:e?"activo":"inactivo"}),i&&a.jsx("span",{style:{opacity:.8},children:i})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("button",{className:"btn secondary",onClick:m,disabled:s,children:e?"Detener":"Iniciar"}),e&&a.jsx("button",{className:"btn secondary",onClick:h,disabled:s,children:"Reset ahora"})]})]})}function c(){let[e,t]=(0,r.useState)(""),[s,n]=(0,r.useState)("");if(!e)return null;let i=s?` ${s.toLowerCase()}`:"";return(0,a.jsxs)("span",{className:"muted",style:{marginLeft:12},children:["v",e,i?` (${i})`:""]})}var h=s(8145);function m({children:e}){return(0,a.jsxs)(a.Fragment,{children:[a.jsx(d,{}),(0,a.jsxs)("header",{className:"container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{className:"row",children:[a.jsx("strong",{children:"Taxi App"}),(0,a.jsxs)("nav",{className:"row",style:{gap:16},children:[a.jsx(i.default,{href:"/",children:"Inicio"}),a.jsx(i.default,{href:"/admin/trips",children:"Trips"}),a.jsx(i.default,{href:"/admin/tariffs",children:"Tarifas"}),a.jsx(i.default,{href:"/admin/simulator",children:"Simulador"}),a.jsx(i.default,{href:"/admin/reports",children:"Reportes"}),a.jsx(i.default,{href:"/admin/ops",children:"Operaciones"})]})]}),a.jsx(u,{})]}),a.jsx(h.V,{children:a.jsx("main",{className:"container",children:e})}),(0,a.jsxs)("footer",{className:"container",style:{marginTop:24,paddingBottom:24,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[a.jsx(i.default,{href:"/admin/readme",children:"Gu\xeda de Demo"}),a.jsx(c,{})]})]})}function u(){let[e,t]=n().useState(()=>(0,l.PR)());return e?(0,a.jsxs)("div",{className:"row",children:[(0,a.jsxs)("span",{className:"muted",children:[e.email," (",e.role,")"]}),a.jsx("button",{className:"btn secondary",onClick:()=>{(0,l.DH)(),location.href="/login"},children:"Salir"})]}):a.jsx(i.default,{className:"btn secondary",href:"/login",children:"Ingresar"})}},2326:(e,t,s)=>{"use strict";s.d(t,{ik:()=>n,qM:()=>r});var a=s(326);function r({height:e=16,width:t="100%",style:s,className:r}){return a.jsx("div",{className:r,style:{height:e,width:t,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...s}})}function n({lines:e=3}){return a.jsx("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:e}).map((e,t)=>a.jsx(r,{height:12,width:`${80-8*t}%`},t))})}s(7577)},8145:(e,t,s)=>{"use strict";s.d(t,{V:()=>l,p:()=>i});var a=s(326),r=s(7577);let n=(0,r.createContext)(null);function i(){let e=(0,r.useContext)(n);if(!e)throw Error("useToast must be used within ToastProvider");return e}function l({children:e}){let[t,s]=(0,r.useState)([]),i=(e,t="info",a=3200)=>{let r=Date.now()+Math.floor(1e3*Math.random()),n={id:r,kind:t,text:e,ttl:Date.now()+a};s(e=>[...e,n]),setTimeout(()=>s(e=>e.filter(e=>e.id!==r)),a)},l=(0,r.useMemo)(()=>({show:i}),[]);return(0,a.jsxs)(n.Provider,{value:l,children:[e,a.jsx("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:t.map(e=>(0,a.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:`4px solid ${"success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6"}`},children:[a.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),a.jsx("div",{className:"muted",children:e.text})]},e.id))})]})}},6208:(e,t,s)=>{"use strict";function a(e,t){}function r(){return null}function n(){}function i(){return null}s.d(t,{DH:()=>n,J1:()=>a,PR:()=>r,oC:()=>i})},2789:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`/app/src/app/admin/reports/page.tsx#default`)},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(9510);s(4315),s(1159);let r=(0,s(5782).default)(()=>s.e(298).then(s.bind(s,7298)),{loadableGenerated:{modules:["app/layout.tsx -> @/src/components/ClientShell"]},ssr:!1});function n({children:e}){return a.jsx("html",{lang:"es",children:a.jsx("body",{children:a.jsx(r,{children:e})})})}},4315:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[555],()=>s(3966));module.exports=a})();