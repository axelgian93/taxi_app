(()=>{var e={};e.id=782,e.ids=[782],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7190:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=s(3191),n=s(8716),a=s(7922),i=s.n(a),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["rider",{children:["request",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3835)),"/app/src/app/rider/request/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/rider/request/page.tsx"],u="/rider/request/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/rider/request/page",pathname:"/rider/request",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9189:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4047:(e,t,s)=>{Promise.resolve().then(s.bind(s,933)),Promise.resolve().then(s.bind(s,6618)),Promise.resolve().then(s.bind(s,8482))},6852:(e,t,s)=>{Promise.resolve().then(s.bind(s,2749))},2749:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(326),n=s(7577),a=s(6208),i=s(8069);function l(){let[e,t]=(0,n.useState)("Guayaquil"),[s,l]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)("CASH"),[m,p]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1),[g,j]=(0,n.useState)(null),[y,v]=(0,n.useState)(""),[b,N]=(0,n.useState)([]),[S,w]=(0,n.useState)("origin"),[P,C]=(0,n.useState)(null),[k,M]=(0,n.useState)(null);async function I(){if(s&&d){f(!0),j(null);try{let t=(0,a.oC)();if(!t){location.href="/rider/login";return}let r={city:e,pickupLat:s.lat,pickupLng:s.lng,dropoffLat:d.lat,dropoffLng:d.lng,distanceKm:m?.distanceKm||3,durationMin:m?.durationMin||10,preferredMethod:u},n=await (0,i.j)("/trips/request",{method:"POST",body:JSON.stringify(r)},t);location.href=`/rider/trip/${n.trip.id}`}catch(e){j(e?.message||"Error al solicitar")}finally{f(!1)}}}return(0,n.useEffect)(()=>{if(!s||!d){p(null);return}let e=function(e,t,s,r){let n=Math.sin((s-e)*Math.PI/180/2)**2+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin((r-t)*Math.PI/180/2)**2;return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}(s.lat,s.lng,d.lat,d.lng),t=Math.max(5,Math.round(4*e)),r=1.5+.5*e+.2*t;p({distanceKm:Number(e.toFixed(2)),durationMin:t,priceUsd:Number(Math.max(2,r).toFixed(2))})},[JSON.stringify(s),JSON.stringify(d)]),(0,r.jsxs)("div",{children:[r.jsx("h2",{children:"Solicitar viaje"}),(0,r.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Ciudad"}),r.jsx("input",{value:e,onChange:e=>t(e.target.value),placeholder:"Guayaquil"})]}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[r.jsx("span",{children:"M\xe9todo"}),(0,r.jsxs)("select",{value:u,onChange:e=>h(e.target.value),children:[r.jsx("option",{value:"CASH",children:"CASH"}),r.jsx("option",{value:"CARD",children:"CARD"})]})]}),r.jsx("button",{className:"btn",onClick:I,disabled:!s||!d||x,children:x?"Solicitando…":"Solicitar"})]}),(0,r.jsxs)("div",{className:"card",style:{marginTop:10},children:[(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Origen (click en mapa)"}),r.jsx("input",{readOnly:!0,value:s?`${s.lat.toFixed(6)}, ${s.lng.toFixed(6)}`:""})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[r.jsx("span",{children:"Buscar"}),r.jsx("input",{placeholder:"Direcci\xf3n, punto de inter\xe9s…",value:y,onChange:e=>v(e.target.value),style:{minWidth:260}})]}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[r.jsx("span",{children:"Aplicar a"}),(0,r.jsxs)("select",{value:S,onChange:e=>w(e.target.value),children:[r.jsx("option",{value:"origin",children:"Origen"}),r.jsx("option",{value:"dest",children:"Destino"})]})]}),b.length>0&&r.jsx("div",{className:"card",style:{padding:8},children:r.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:b.map((e,t)=>r.jsx("li",{children:r.jsx("button",{className:"btn secondary",onClick:()=>{let t={lat:Number(e.lat),lng:Number(e.lon)};"origin"===S?l(t):c(t),N([]),v("")},children:e.display_name})},t))})})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[r.jsx("span",{className:"muted",children:"Favoritos:"}),r.jsx("button",{className:"btn secondary",onClick:()=>P&&("origin"===S?l(P):c(P)),disabled:!P,children:"Casa"}),r.jsx("button",{className:"btn secondary",onClick:()=>k&&("origin"===S?l(k):c(k)),disabled:!k,children:"Trabajo"}),r.jsx("button",{className:"btn secondary",onClick:()=>{let e="origin"===S?s:d;e&&(localStorage.setItem("fav_home",JSON.stringify(e)),C(e))},children:"Guardar Casa"}),r.jsx("button",{className:"btn secondary",onClick:()=>{let e="origin"===S?s:d;e&&(localStorage.setItem("fav_work",JSON.stringify(e)),M(e))},children:"Guardar Trabajo"})]}),(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Destino (clic derecho/Alt)"}),r.jsx("input",{readOnly:!0,value:d?`${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}`:""})]}),m&&(0,r.jsxs)("div",{className:"row",style:{gap:12},children:[(0,r.jsxs)("span",{className:"muted",children:["Dist: ",m.distanceKm," km"]}),(0,r.jsxs)("span",{className:"muted",children:["Dur: ",m.durationMin," min"]}),(0,r.jsxs)("span",{children:["Estimado: ",(0,r.jsxs)("strong",{children:["$",m.priceUsd.toFixed(2)]})]}),(0,r.jsxs)("span",{className:"muted",children:["Pago: ",u]})]}),g&&r.jsx("div",{style:{color:"var(--danger)"},children:g})]}),r.jsx("div",{style:{height:360,marginTop:10},children:r.jsx(o,{onPick:l,onPickAlt:c})})]})]})}function o({onPick:e,onPickAlt:t}){let s=(0,n.useRef)(null);return(0,n.useRef)(null),(0,n.useRef)({}),r.jsx("div",{ref:s,style:{width:"100%",height:"100%"}})}},8482:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(326),n=s(7577),a=s.n(n),i=s(434),l=s(6208);let o="http://localhost:8081";function d(){let[e,t]=(0,n.useState)(()=>!1),[s,a]=(0,n.useState)(!1),[i,d]=(0,n.useState)(null);async function c(){a(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/seed`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Seed HTTP ${t.status}`);d("Demo iniciada")}catch(e){d(e?.message||"Error en seed")}finally{a(!1)}}async function u(){a(!0),d(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let t=await fetch(`${o}/admin/demo/reset`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!t.ok)throw Error(`Reset HTTP ${t.status}`);d("Demo reseteada")}catch(e){d(e?.message||"Error en reset")}finally{a(!1)}}async function h(){let s=!e;t(s),s?await c():await u()}return(0,r.jsxs)("div",{style:{background:e?"#0b4":"#444",color:"white",padding:"6px 12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[r.jsx("strong",{children:"Modo Demo"}),r.jsx("span",{className:"muted",children:e?"activo":"inactivo"}),i&&r.jsx("span",{style:{opacity:.8},children:i})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[r.jsx("button",{className:"btn secondary",onClick:h,disabled:s,children:e?"Detener":"Iniciar"}),e&&r.jsx("button",{className:"btn secondary",onClick:u,disabled:s,children:"Reset ahora"})]})]})}function c(){let[e,t]=(0,n.useState)(""),[s,a]=(0,n.useState)("");if(!e)return null;let i=s?` ${s.toLowerCase()}`:"";return(0,r.jsxs)("span",{className:"muted",style:{marginLeft:12},children:["v",e,i?` (${i})`:""]})}var u=s(8145);function h({children:e}){return(0,r.jsxs)(r.Fragment,{children:[r.jsx(d,{}),(0,r.jsxs)("header",{className:"container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{className:"row",children:[r.jsx("strong",{children:"Taxi App"}),(0,r.jsxs)("nav",{className:"row",style:{gap:16},children:[r.jsx(i.default,{href:"/",children:"Inicio"}),r.jsx(i.default,{href:"/admin/trips",children:"Trips"}),r.jsx(i.default,{href:"/admin/tariffs",children:"Tarifas"}),r.jsx(i.default,{href:"/admin/simulator",children:"Simulador"}),r.jsx(i.default,{href:"/admin/reports",children:"Reportes"}),r.jsx(i.default,{href:"/admin/ops",children:"Operaciones"})]})]}),r.jsx(m,{})]}),r.jsx(u.V,{children:r.jsx("main",{className:"container",children:e})}),(0,r.jsxs)("footer",{className:"container",style:{marginTop:24,paddingBottom:24,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[r.jsx(i.default,{href:"/admin/readme",children:"Gu\xeda de Demo"}),r.jsx(c,{})]})]})}function m(){let[e,t]=a().useState(()=>(0,l.PR)());return e?(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("span",{className:"muted",children:[e.email," (",e.role,")"]}),r.jsx("button",{className:"btn secondary",onClick:()=>{(0,l.DH)(),location.href="/login"},children:"Salir"})]}):r.jsx(i.default,{className:"btn secondary",href:"/login",children:"Ingresar"})}},8145:(e,t,s)=>{"use strict";s.d(t,{V:()=>l,p:()=>i});var r=s(326),n=s(7577);let a=(0,n.createContext)(null);function i(){let e=(0,n.useContext)(a);if(!e)throw Error("useToast must be used within ToastProvider");return e}function l({children:e}){let[t,s]=(0,n.useState)([]),i=(e,t="info",r=3200)=>{let n=Date.now()+Math.floor(1e3*Math.random()),a={id:n,kind:t,text:e,ttl:Date.now()+r};s(e=>[...e,a]),setTimeout(()=>s(e=>e.filter(e=>e.id!==n)),r)},l=(0,n.useMemo)(()=>({show:i}),[]);return(0,r.jsxs)(a.Provider,{value:l,children:[e,r.jsx("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:t.map(e=>(0,r.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:`4px solid ${"success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6"}`},children:[r.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),r.jsx("div",{className:"muted",children:e.text})]},e.id))})]})}},8069:(e,t,s)=>{"use strict";s.d(t,{S:()=>r,j:()=>n});let r="http://localhost:8081";async function n(e,t={},s){let n=new Headers(t.headers||{});n.set("Content-Type","application/json"),s&&n.set("Authorization",`Bearer ${s}`);let a=await fetch(`${r}${e}`,{...t,headers:n,cache:"no-store"});if(!a.ok){let e=await a.text().catch(()=>"");throw Error(`API ${a.status}: ${e||a.statusText}`)}return a.json()}},6208:(e,t,s)=>{"use strict";function r(e,t){}function n(){return null}function a(){}function i(){return null}s.d(t,{DH:()=>a,J1:()=>r,PR:()=>n,oC:()=>i})},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(9510);s(4315),s(1159);let n=(0,s(5782).default)(()=>s.e(298).then(s.bind(s,7298)),{loadableGenerated:{modules:["app/layout.tsx -> @/src/components/ClientShell"]},ssr:!1});function a({children:e}){return r.jsx("html",{lang:"es",children:r.jsx("body",{children:r.jsx(n,{children:e})})})}},3835:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/app/src/app/rider/request/page.tsx#default`)},4315:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[555],()=>s(7190));module.exports=r})();