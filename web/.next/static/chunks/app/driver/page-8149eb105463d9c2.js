(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{7420:function(e,t,n){Promise.resolve().then(n.bind(n,1763))},1763:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),a=n(2265),i=n(2268),l=n(2800),c=n(4282),s=n(8873),o=n(21);function d(){var e;let{show:t}=(0,s.p)(),[n,d]=(0,a.useState)(!0),[p,f]=(0,a.useState)(!1),[x,y]=(0,a.useState)(!0),[b,j]=(0,a.useState)(null),[v,N]=(0,a.useState)([]),[k,S]=(0,a.useState)(null),w=(0,a.useMemo)(()=>v.find(e=>e.id===k)||null,[v,k]),[C,M]=(0,a.useState)("CASH"),[I,R]=(0,a.useState)(null),L=(0,a.useRef)(null),E=(0,a.useRef)(null),[A,T]=(0,a.useState)(!0),[O,D]=(0,a.useState)(null),[F,P]=(0,a.useState)(null),q=(0,a.useRef)(null),U=(0,a.useRef)(null),_=(0,a.useRef)(new Set),B=(0,a.useRef)(null),[z,H]=(0,a.useState)(0),[J,G]=(0,a.useState)(!0),[V,W]=(0,a.useState)(!0);async function Z(){T(!0);try{let e=(0,c.oC)();if(!e){location.replace("/login");return}let t=await (0,l.j)("/drivers/my-trips/active",{},e),n=Array.isArray(t.items)?t.items:[],r=n.filter(e=>"ASSIGNED"===e.status),a=n.find(e=>"ASSIGNED"!==e.status)||null,i=new Set(r.map(e=>e.id)),s=!1;for(let e of i)if(!_.current.has(e)){s=!0;break}if(_.current=i,N(r),j(a),(null==a?void 0:a.preferredMethod)&&M(a.preferredMethod||C),a&&x&&!p)try{$()}catch(e){}if(s&&(function(){try{if(!J)return;let e=window.AudioContext||window.webkitAudioContext;if(!e)return;B.current||(B.current=new e);let t=B.current,n=t.createOscillator(),r=t.createGain();n.type="sine",n.frequency.value=880,r.gain.value=.05,n.connect(r),r.connect(t.destination),n.start(),setTimeout(()=>{try{n.stop(),n.disconnect(),r.disconnect()}catch(e){}},220)}catch(e){}}(),V)){let e=Date.now()+1200;H(e),setTimeout(()=>{H(0)},1250)}if(a)try{Y(a.id)}catch(e){}}catch(e){D((null==e?void 0:e.message)||"Error")}finally{T(!1)}}async function K(e){try{let n=(0,c.oC)();if(!n)return;await (0,l.j)("/drivers/status",{method:"POST",body:JSON.stringify({status:e})},n),d("OFFLINE"!==e),t("OFFLINE"===e?"Pasaste a OFFLINE":"Est\xe1s ONLINE","success")}catch(e){t((null==e?void 0:e.message)||"Error al actualizar estado","error")}}function $(){if(!navigator.geolocation){t("Geolocalizaci\xf3n no disponible","error");return}null==q.current&&(q.current=navigator.geolocation.watchPosition(e=>{let{latitude:t,longitude:n}=e.coords;P({lat:t,lng:n}),X(t,n).catch(()=>{})},e=>{t((null==e?void 0:e.message)||"No se pudo leer ubicaci\xf3n","error")},{enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4}),f(!0),t("Compartiendo ubicaci\xf3n…","info"))}function Q(){if(null!=q.current){try{navigator.geolocation.clearWatch(q.current)}catch(e){}q.current=null}f(!1),t("Ubicaci\xf3n detenida","info")}async function X(e,t){try{let r=(0,c.oC)();if(!r)return;let a=b?"ON_TRIP":n?"IDLE":"OFFLINE";await (0,l.j)("/drivers/location",{method:"POST",body:JSON.stringify({lat:e,lng:t,status:a})},r)}catch(e){}}async function Y(e){try{let t=await g(e);R(t),L.current&&(clearInterval(L.current),L.current=null),"number"==typeof t.graceRemainingSec&&t.graceRemainingSec>0&&(L.current=setInterval(()=>{R(e=>e?{...e,graceRemainingSec:Math.max(0,(e.graceRemainingSec||0)-1)}:e)},1e3))}catch(e){}}async function ee(e,n){try{let r=(0,c.oC)();if(!r)return;if("start"===n?await (0,l.j)("/trips/".concat(encodeURIComponent(e),"/start"),{method:"POST",body:JSON.stringify({method:C||(null==b?void 0:b.preferredMethod)||"CASH"})},r):"reject"===n?await (0,l.j)("/trips/".concat(encodeURIComponent(e),"/reject"),{method:"POST"},r):await (0,l.j)("/trips/".concat(encodeURIComponent(e),"/").concat(n),{method:"POST"},r),t("Acci\xf3n: ".concat(n),"success"),"accept"===n&&x&&!p)try{$()}catch(e){}try{Y(e)}catch(e){}await Z()}catch(e){t((null==e?void 0:e.message)||"Error realizando acci\xf3n","error")}}(0,a.useEffect)(()=>{let e=(0,c.PR)();if(!e){location.replace("/login");return}if("DRIVER"!==e.role){D("Acceso solo para DRIVER"),T(!1);return}try{let e=localStorage.getItem("driver_prefs");if(e){let t=JSON.parse(e);"boolean"==typeof t.beep&&G(t.beep),"boolean"==typeof t.flash&&W(t.flash),"boolean"==typeof t.autoShare&&y(t.autoShare),("CASH"===t.paymentMethod||"CARD"===t.paymentMethod)&&M(t.paymentMethod)}}catch(e){}return Z(),U.current=setInterval(Z,4e3),()=>{U.current&&clearInterval(U.current)}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("driver_prefs");e&&JSON.parse(e),localStorage.setItem("driver_prefs",JSON.stringify({beep:J,flash:V,autoShare:x,paymentMethod:C}))}catch(e){}},[J,V,x,C]),(0,a.useEffect)(()=>{var e;let n=null!==(e=null==I?void 0:I.graceRemainingSec)&&void 0!==e?e:null,r=E.current;null!=r&&r>0&&0===n&&t("Ventana de gracia agotada: puede aplicar fee si cancelan","info"),E.current=n},[null==I?void 0:I.graceRemainingSec]),(0,a.useEffect)(()=>{let e=e=>{var t,n;let r=null===(n=e.target)||void 0===n?void 0:null===(t=n.tagName)||void 0===t?void 0:t.toLowerCase();"input"!==r&&"textarea"!==r&&(("r"===e.key||"R"===e.key)&&(e.preventDefault(),Z()),("s"===e.key||"S"===e.key)&&(e.preventDefault(),p?Q():$()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p]);let et=(0,a.useMemo)(()=>b?{lat:Number(b.pickupLat),lng:Number(b.pickupLng)}:null,[null==b?void 0:b.id]),en=(0,a.useMemo)(()=>b?{lat:Number(b.dropoffLat),lng:Number(b.dropoffLng)}:null,[null==b?void 0:b.id]),[er,ea,ei,el]=(0,a.useMemo)(()=>{let e=(e,n)=>{if(!e||!n)return null;let r=t(n.lat-e.lat),a=t(n.lng-e.lng),i=Math.sin(r/2)**2+Math.cos(t(e.lat))*Math.cos(t(n.lat))*Math.sin(a/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},t=e=>e*Math.PI/180,n=F&&et?e(F,et):null,r=et&&en?e(et,en):null;return[n,null==n?null:Math.round(n/28*60),r,null==r?null:Math.round(r/28*60)]},[F,et,en]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:"Panel del Conductor"}),O&&(0,r.jsx)("div",{style:{color:"var(--danger)",marginBottom:8},children:O}),(0,r.jsx)("div",{className:"card",style:{marginBottom:12},children:(0,r.jsxs)("div",{className:"row",style:{gap:10,flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("input",{type:"checkbox",checked:n,onChange:e=>K(e.target.checked?"IDLE":"OFFLINE")}),(0,r.jsx)("span",{children:n?"Online":"Offline"})]}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("input",{type:"checkbox",checked:p,onChange:e=>e.target.checked?$():Q()}),(0,r.jsx)("span",{children:"Compartir ubicaci\xf3n"})]}),(0,r.jsx)("a",{className:"btn secondary",href:"/driver/history",children:"Historial"}),(0,r.jsx)("button",{className:"btn secondary",onClick:Z,disabled:A,children:"Refrescar"}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center",marginLeft:8},children:[(0,r.jsx)("input",{type:"checkbox",checked:x,onChange:e=>y(e.target.checked)}),(0,r.jsx)("span",{children:"Auto compartir al aceptar"})]}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("input",{type:"checkbox",checked:J,onChange:e=>G(e.target.checked)}),(0,r.jsx)("span",{children:"Beep nuevos asignados"})]}),(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("input",{type:"checkbox",checked:V,onChange:e=>W(e.target.checked)}),(0,r.jsx)("span",{children:"Flash destacados"})]}),!p&&(0,r.jsx)("button",{className:"btn secondary",onClick:function(){if(!navigator.geolocation){t("Geolocalizaci\xf3n no disponible","error");return}navigator.geolocation.getCurrentPosition(e=>{let{latitude:n,longitude:r}=e.coords;P({lat:n,lng:r}),t("Ubicaci\xf3n capturada","success")},()=>t("No se pudo capturar ubicaci\xf3n","error"),{enableHighAccuracy:!0,maximumAge:1e3,timeout:8e3})},children:"Usar mi ubicaci\xf3n"})]})}),A&&(0,r.jsxs)("div",{className:"card",style:{marginBottom:12},children:[(0,r.jsx)("strong",{children:"Asignados"}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)(o.qM,{height:14,width:220,style:{marginBottom:8}}),(0,r.jsx)(o.qM,{height:10,style:{marginBottom:6}}),(0,r.jsx)(o.qM,{height:10,style:{marginBottom:6}}),(0,r.jsx)(o.qM,{height:10,style:{marginBottom:6}})]})]}),v.length>0&&!A&&(0,r.jsxs)("div",{className:"card",style:{marginBottom:12,boxShadow:z&&z>Date.now()?"0 0 0 3px rgba(34,197,94,0.35) inset":void 0},children:[(0,r.jsx)("strong",{children:"Asignados"}),(0,r.jsx)("div",{className:"table-wrap",style:{marginTop:8},children:(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ID"}),(0,r.jsx)("th",{children:"Recogida"}),(0,r.jsx)("th",{children:"Destino"}),(0,r.jsx)("th",{children:"Distancia"}),(0,r.jsx)("th",{children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:(function(e,t){let n=e=>e*Math.PI/180,r=(e,t)=>{if(!e||!t)return null;let r=n(t.lat-e.lat),a=n(t.lng-e.lng),i=Math.sin(r/2)**2+Math.cos(n(e.lat))*Math.cos(n(t.lat))*Math.sin(a/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},a=t.map(t=>{let n=e?r(e,{lat:Number(t.pickupLat),lng:Number(t.pickupLng)}):null;return{it:t,distKm:null==n?null:Number(n)}});return e?a.sort((e,t)=>{var n,r;return(null!==(n=e.distKm)&&void 0!==n?n:1/0)-(null!==(r=t.distKm)&&void 0!==r?r:1/0)}):a})(F,v).map(e=>{let{it:t,distKm:a}=e;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:t.id}),(0,r.jsxs)("td",{children:[t.pickupLat.toFixed(5),", ",t.pickupLng.toFixed(5)]}),(0,r.jsxs)("td",{children:[t.dropoffLat.toFixed(5),", ",t.dropoffLng.toFixed(5)]}),(0,r.jsx)("td",{children:null!=a?"".concat(a.toFixed(2)," km"):"-"}),(0,r.jsxs)("td",{children:[(0,r.jsx)("button",{className:"btn secondary",onClick:()=>S(t.id),style:{marginRight:6},children:"Ver"}),(0,r.jsx)("button",{className:"btn",disabled:!n,onClick:()=>ee(t.id,"accept"),style:{marginRight:6},children:"Aceptar"}),(0,r.jsx)("button",{className:"btn danger",onClick:()=>ee(t.id,"reject"),children:"Rechazar"})]})]},t.id)})})]})}),F&&(0,r.jsx)("div",{className:"muted",style:{marginTop:6},children:"Ordenado por cercan\xeda a tu ubicaci\xf3n"}),(0,r.jsxs)("div",{className:"card",style:{marginTop:10},children:[(0,r.jsx)("strong",{children:"Vista previa"}),w?(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)(i.Z,{origin:{lat:Number(w.pickupLat),lng:Number(w.pickupLng)},destination:{lat:Number(w.dropoffLat),lng:Number(w.dropoffLng)},height:220}),(0,r.jsx)(m,{selected:w,driverLoc:F}),(0,r.jsxs)("div",{className:"row",style:{marginTop:8,gap:8},children:[(0,r.jsx)("button",{className:"btn secondary",onClick:()=>S(null),children:"Cerrar"}),(0,r.jsx)("button",{className:"btn",disabled:!n,onClick:()=>ee(w.id,"accept"),children:"Aceptar"}),(0,r.jsx)("button",{className:"btn danger",onClick:()=>ee(w.id,"reject"),children:"Rechazar"})]})]}):(0,r.jsx)("div",{className:"muted",style:{marginTop:8},children:"Selecciona un asignado para previsualizar"})]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("strong",{children:"Viaje activo"}),A?(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)(o.ik,{lines:2}),(0,r.jsx)("div",{style:{marginTop:10},children:(0,r.jsx)(o.qM,{height:300})}),(0,r.jsxs)("div",{className:"row",style:{gap:8,marginTop:10},children:[(0,r.jsx)(o.qM,{height:32,width:120}),(0,r.jsx)(o.qM,{height:32,width:120}),(0,r.jsx)(o.qM,{height:32,width:120})]})]}):b?(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsxs)("div",{className:"muted",children:["ID: ",b.id," • Estado: ",b.status," ",b.preferredMethod?"• Pago: ".concat(b.preferredMethod):""]}),I&&(0,r.jsx)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:6},children:"number"==typeof I.graceRemainingSec&&I.graceRemainingSec>0?(0,r.jsxs)("div",{className:"card",style:{padding:"4px 8px"},children:["Gracia rider: ",(e=I.graceRemainingSec,"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0")))]}):(0,r.jsx)("div",{className:"muted",children:I.feeUsd>0?"Fee cancelaci\xf3n: $".concat(I.feeUsd.toFixed(2)):"Sin fee por cancelaci\xf3n"})}),(0,r.jsxs)("div",{className:"muted",style:{marginTop:4},children:[null!=er&&(0,r.jsxs)("span",{children:["Hacia recogida: ",er.toFixed(2)," km • ~",ea," min. "]}),null!=ei&&(0,r.jsxs)("span",{children:["Trayecto: ",ei.toFixed(2)," km • ~",el," min."]})]}),(0,r.jsx)("div",{style:{marginTop:10},children:(0,r.jsx)(i.Z,{origin:et,destination:en,driver:F||void 0,height:300,controls:!0})}),(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap",marginTop:10},children:[(0,r.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("span",{children:"M\xe9todo"}),(0,r.jsxs)("select",{value:C,onChange:e=>M(e.target.value),children:[(0,r.jsx)("option",{value:"CASH",children:"CASH"}),(0,r.jsx)("option",{value:"CARD",children:"CARD"})]})]}),(0,r.jsx)("a",{className:"btn secondary",href:u(et),target:"_blank",rel:"noopener noreferrer",children:"Google Maps (recogida)"}),(0,r.jsx)("a",{className:"btn secondary",href:u(en),target:"_blank",rel:"noopener noreferrer",children:"Google Maps (destino)"}),(0,r.jsx)("a",{className:"btn secondary",href:h(et),target:"_blank",rel:"noopener noreferrer",children:"Apple Maps (recogida)"}),(0,r.jsx)("a",{className:"btn secondary",href:h(en),target:"_blank",rel:"noopener noreferrer",children:"Apple Maps (destino)"}),(0,r.jsx)("button",{className:"btn",disabled:"ASSIGNED"!==b.status||!n,onClick:()=>ee(b.id,"accept"),children:"Aceptar"}),(0,r.jsx)("button",{className:"btn",disabled:"ACCEPTED"!==b.status,onClick:()=>ee(b.id,"arrived"),children:"Llegu\xe9"}),(0,r.jsx)("button",{className:"btn",disabled:!("ACCEPTED"===b.status||"ARRIVED"===b.status),onClick:()=>ee(b.id,"start"),children:"Iniciar"}),(0,r.jsx)("button",{className:"btn",disabled:"STARTED"!==b.status,onClick:()=>ee(b.id,"complete"),children:"Completar"}),"ASSIGNED"===b.status&&(0,r.jsx)("button",{className:"btn danger",onClick:()=>ee(b.id,"reject"),children:"Rechazar"})]})]}):(0,r.jsx)("div",{className:"muted",style:{marginTop:8},children:"Sin viaje activo asignado."})]})]})}function u(e){if(!e)return"#";let t="".concat(encodeURIComponent(e.lat),",").concat(encodeURIComponent(e.lng));return"https://www.google.com/maps/dir/?api=1&destination=".concat(t)}function h(e){if(!e)return"#";let t="".concat(encodeURIComponent(e.lat),",").concat(encodeURIComponent(e.lng));return"http://maps.apple.com/?daddr=".concat(t)}async function g(e){let t=(0,c.oC)();if(!t)return{feeUsd:0,graceRemainingSec:null};let n=await fetch("".concat("http://localhost:8081","/trips/").concat(encodeURIComponent(e),"/cancel/quote"),{headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!n.ok)return{feeUsd:0,graceRemainingSec:null};let r=await n.json();return{feeUsd:Number(r.feeUsd||0),graceRemainingSec:"number"==typeof r.graceRemainingSec?r.graceRemainingSec:null}}function m(e){let{selected:t,driverLoc:n}=e,a=e=>e*Math.PI/180,i=(e,t)=>{if(!e||!t)return null;let n=a(t.lat-e.lat),r=a(t.lng-e.lng),i=Math.sin(n/2)**2+Math.cos(a(e.lat))*Math.cos(a(t.lat))*Math.sin(r/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},l={lat:Number(t.pickupLat),lng:Number(t.pickupLng)},c={lat:Number(t.dropoffLat),lng:Number(t.dropoffLng)},s=n?i(n,l):null,o=i(l,c);return(0,r.jsxs)("div",{className:"muted",style:{marginTop:6},children:[null!=s&&(0,r.jsxs)("span",{children:["Hacia recogida: ",s.toFixed(2)," km • ~",null==s?null:Math.round(s/28*60)," min. "]}),null!=o&&(0,r.jsxs)("span",{children:["Trayecto: ",o.toFixed(2)," km • ~",null==o?null:Math.round(o/28*60)," min."]})]})}},2268:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(7437),a=n(2265);function i(e){let{origin:t,destination:n,driver:i,height:l=320,controls:c=!1}=e,s=a.useRef(null),o=a.useRef(null),d=a.useRef({}),u=a.useRef(!1);function h(){let e=window.L;if(!e||!o.current)return;let r=o.current,a=d.current,l=(t,n)=>e.circleMarker([t.lat,t.lng],{radius:8,color:n,weight:2,fillColor:n,fillOpacity:.6});t&&isFinite(t.lat)&&isFinite(t.lng)?a.origin?a.origin.setLatLng([t.lat,t.lng]):a.origin=l(t,"#22c55e").addTo(r):a.origin&&(r.removeLayer(a.origin),a.origin=void 0),n&&isFinite(n.lat)&&isFinite(n.lng)?a.destination?a.destination.setLatLng([n.lat,n.lng]):a.destination=l(n,"#ef4444").addTo(r):a.destination&&(r.removeLayer(a.destination),a.destination=void 0),i&&isFinite(i.lat)&&isFinite(i.lng)?a.driver?a.driver.setLatLng([i.lat,i.lng]):a.driver=l(i,"#4f46e5").addTo(r):a.driver&&(r.removeLayer(a.driver),a.driver=void 0)}function g(){let e=window.L;if(!e||!o.current)return;let r=[];if(t&&r.push(t),n&&r.push(n),i&&r.push(i),0===r.length)return;let a=e.latLngBounds(r.map(e=>[e.lat,e.lng]));o.current.fitBounds(a.pad(.25),{maxZoom:16})}return a.useEffect(()=>{let e=!1;return(async function(){return!!window.L||(await new Promise(e=>{let t=document.querySelector("link[data-leaflet]"),n=document.querySelector("script[data-leaflet]");if(!t){let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",e.setAttribute("data-leaflet","1"),document.head.appendChild(e)}if(n){e();return}let r=document.createElement("script");r.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",r.async=!0,r.defer=!0,r.setAttribute("data-leaflet","1"),r.onload=()=>e(),r.onerror=()=>e(),document.body.appendChild(r)}),!!window.L)})().then(t=>{if(e||!t)return;let n=window.L;if(s.current){if(!o.current){let e=s.current,t=n.map(e,{zoomControl:!0});t.setView([0,0],2),n.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(t),o.current=t}u.current=!0,h(),g()}}),()=>{e=!0}},[]),a.useEffect(()=>{u.current&&(h(),g())},[JSON.stringify(t),JSON.stringify(n)]),a.useEffect(()=>{u.current&&h()},[JSON.stringify(i)]),(0,r.jsxs)("div",{style:{position:"relative",width:"100%",height:l},children:[(0,r.jsx)("div",{ref:s,style:{width:"100%",height:"100%"}}),c&&(0,r.jsxs)("div",{style:{position:"absolute",top:8,right:8,display:"flex",flexDirection:"column",gap:6},children:[(0,r.jsx)("button",{className:"btn secondary","aria-label":"Centrar a origen",onClick:()=>m(t),children:"Origen"}),(0,r.jsx)("button",{className:"btn secondary","aria-label":"Centrar a destino",onClick:()=>m(n),children:"Destino"}),(0,r.jsx)("button",{className:"btn secondary","aria-label":"Centrar a conductor",onClick:()=>m(i),children:"Driver"}),(0,r.jsx)("button",{className:"btn secondary","aria-label":"Encajar todo",onClick:()=>g(),children:"Reencuadrar"})]})]});function m(e){window.L&&o.current&&e&&isFinite(e.lat)&&isFinite(e.lng)&&o.current.setView([e.lat,e.lng],Math.max(14,o.current.getZoom()||14),{animate:!0})}}},21:function(e,t,n){"use strict";n.d(t,{ik:function(){return i},qM:function(){return a}});var r=n(7437);function a(e){let{height:t=16,width:n="100%",style:a,className:i}=e;return(0,r.jsx)("div",{className:i,style:{height:t,width:n,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...a}})}function i(e){let{lines:t=3}=e;return(0,r.jsx)("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:t}).map((e,t)=>(0,r.jsx)(a,{height:12,width:"".concat(80-8*t,"%")},t))})}if(n(2265),!document.getElementById("sk-keyframes")){let e=document.createElement("style");e.id="sk-keyframes",e.innerHTML="@keyframes skeleton { 0%{background-position:100% 50%} 100%{background-position:0 50%} }",document.head.appendChild(e)}},8873:function(e,t,n){"use strict";n.d(t,{V:function(){return c},p:function(){return l}});var r=n(7437),a=n(2265);let i=(0,a.createContext)(null);function l(){let e=(0,a.useContext)(i);if(!e)throw Error("useToast must be used within ToastProvider");return e}function c(e){let{children:t}=e,[n,l]=(0,a.useState)([]),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3200,r=Date.now()+Math.floor(1e3*Math.random()),a={id:r,kind:t,text:e,ttl:Date.now()+n};l(e=>[...e,a]),setTimeout(()=>l(e=>e.filter(e=>e.id!==r)),n)},s=(0,a.useMemo)(()=>({show:c}),[]);return(0,r.jsxs)(i.Provider,{value:s,children:[t,(0,r.jsx)("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:n.map(e=>(0,r.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:"4px solid ".concat("success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6")},children:[(0,r.jsx)("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),(0,r.jsx)("div",{className:"muted",children:e.text})]},e.id))})]})}},2800:function(e,t,n){"use strict";n.d(t,{S:function(){return r},j:function(){return a}});let r="http://localhost:8081";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=new Headers(t.headers||{});a.set("Content-Type","application/json"),n&&a.set("Authorization","Bearer ".concat(n));let i=await fetch("".concat(r).concat(e),{...t,headers:a,cache:"no-store"});if(!i.ok){let e=await i.text().catch(()=>"");throw Error("API ".concat(i.status,": ").concat(e||i.statusText))}return i.json()}},4282:function(e,t,n){"use strict";n.d(t,{DH:function(){return s},J1:function(){return l},PR:function(){return c},oC:function(){return o}});var r=n(6300).Buffer;let a="taxi_token",i="taxi_user";function l(e,t){localStorage.setItem(a,e),localStorage.setItem(i,JSON.stringify(t))}function c(){let e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function s(){localStorage.removeItem(a),localStorage.removeItem(i)}function o(){let e=localStorage.getItem(a);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",n=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(n);return r.from(n,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(s(),null):null}}},function(e){e.O(0,[300,971,23,744],function(){return e(e.s=7420)}),_N_E=e.O()}]);