(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[401],{9291:function(e,t,r){Promise.resolve().then(r.bind(r,7506))},7506:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(7437),n=r(2265),s=r(4282),l=r(2800),i=r(7138),c=r(21);function o(){let[e,t]=(0,n.useState)([]),[r,o]=(0,n.useState)(null),[d,u]=(0,n.useState)(!1),[h,x]=(0,n.useState)(!0),[m,f]=(0,n.useState)(null),[j,p]=(0,n.useState)("ALL"),[g,v]=(0,n.useState)(""),[b,C]=(0,n.useState)(""),[y,E]=(0,n.useState)("");async function N(){let e=(0,s.oC)();if(e&&r){x(!0);try{let a=await (0,l.j)("/rider/my-trips?limit=20&cursor=".concat(encodeURIComponent(r)),{},e);t(e=>e.concat(a.items||[])),o(a.nextCursor||null),u(!!a.nextCursor)}catch(e){f((null==e?void 0:e.message)||"Error")}finally{x(!1)}}}if((0,n.useEffect)(()=>{(async()=>{try{let e=(0,s.oC)();if(!e){location.href="/rider/login";return}let r=await (0,l.j)("/rider/my-trips?limit=20",{},e);t(r.items||[]),o(r.nextCursor||null),u(!!r.nextCursor)}catch(e){f((null==e?void 0:e.message)||"Error")}finally{x(!1)}})()},[]),h)return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:"Mis viajes"}),(0,a.jsx)("div",{className:"card",style:{marginTop:10},children:(0,a.jsx)(c.ik,{lines:2})}),(0,a.jsx)("div",{className:"table-wrap",style:{marginTop:10},children:(0,a.jsx)(c.qM,{height:240})})]});if(m)return(0,a.jsx)("div",{style:{color:"var(--danger)"},children:m});let S=e.filter(e=>(function(e,t,r,a,n){if("ALL"===t)return!0;let s=!0;if(s="COMPLETED"===t?s&&"COMPLETED"===e.status:"CANCELED"===t?s&&"CANCELED"===e.status:s&&"COMPLETED"!==e.status&&"CANCELED"!==e.status,r&&!e.id.toLowerCase().includes(r.trim().toLowerCase())&&(s=!1),a){let t=Date.parse(e.requestedAt),r=Date.parse(a);isFinite(t)&&isFinite(r)&&t<r&&(s=!1)}if(n){let t=Date.parse(e.requestedAt),r=Date.parse(n+"T23:59:59");isFinite(t)&&isFinite(r)&&t>r&&(s=!1)}return s})(e,j,g,b,y)),D={total:S.length,completed:S.filter(e=>"COMPLETED"===e.status).length,canceled:S.filter(e=>"CANCELED"===e.status).length};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("h2",{children:"Mis viajes"}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[(0,a.jsx)("button",{className:"btn secondary",onClick:()=>(function(e){try{let t=["id","status","requestedAt","completedAt","costUsd","currency","preferredMethod"],r=e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t},a=[t.join(",")].concat(e.map(e=>t.map(t=>r(e[t])).join(","))),n=new Blob([a.join("\n")],{type:"text/csv;charset=utf-8"}),s=URL.createObjectURL(n),l=document.createElement("a");l.href=s,l.download="mis_viajes_".concat(new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}catch(e){}})(S),"aria-label":"Exportar viajes filtrados a CSV",children:"Export CSV"}),(0,a.jsx)(i.default,{className:"btn",href:"/rider/request","aria-label":"Solicitar nuevo viaje",children:"Solicitar viaje"})]})]}),(0,a.jsx)("div",{className:"card",style:{marginTop:8},children:(0,a.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"muted",children:"Total"}),(0,a.jsx)("div",{style:{fontWeight:600},children:D.total})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"muted",children:"Completados"}),(0,a.jsx)("div",{style:{fontWeight:600},children:D.completed})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"muted",children:"Cancelados"}),(0,a.jsx)("div",{style:{fontWeight:600},children:D.canceled})]})]})}),(0,a.jsx)("div",{className:"row",style:{gap:8,margin:"8px 0"},children:["ALL","ACTIVE","COMPLETED","CANCELED"].map(e=>(0,a.jsx)("button",{className:"btn ".concat(j===e?"":"secondary"),onClick:()=>p(e),"aria-pressed":j===e,"aria-label":"Filtrar ".concat(e),children:"ALL"===e?"Todos":"ACTIVE"===e?"Activos":"COMPLETED"===e?"Completados":"Cancelados"},e))}),(0,a.jsx)("div",{className:"card",style:{margin:"8px 0"},children:(0,a.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap"},children:[(0,a.jsxs)("label",{children:[(0,a.jsx)("div",{className:"muted",children:"Buscar por ID"}),(0,a.jsx)("input",{"aria-label":"Buscar viaje por ID",placeholder:"trp_...",value:g,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("div",{className:"muted",children:"Desde"}),(0,a.jsx)("input",{type:"date","aria-label":"Fecha desde",value:b,onChange:e=>C(e.target.value)})]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("div",{className:"muted",children:"Hasta"}),(0,a.jsx)("input",{type:"date","aria-label":"Fecha hasta",value:y,onChange:e=>E(e.target.value)})]})]})}),0===e.length?(0,a.jsxs)("div",{className:"muted",children:["A\xfan no tienes viajes. ",(0,a.jsx)(i.default,{href:"/rider/request",children:"Solicitar uno"})]}):(0,a.jsxs)("table",{className:"table","aria-label":"Lista de viajes",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Fecha"}),(0,a.jsx)("th",{children:"Total"}),(0,a.jsx)("th",{children:"Pago"}),(0,a.jsx)("th",{})]})}),(0,a.jsx)("tbody",{children:S.map(e=>{var t;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.id}),(0,a.jsx)("td",{children:function(e){let t={REQUESTED:{text:"Solicitado",color:"#9aa4b2"},ASSIGNED:{text:"Asignado",color:"#06b6d4"},ACCEPTED:{text:"Aceptado",color:"#4f46e5"},ARRIVED:{text:"Lleg\xf3",color:"#22c55e"},STARTED:{text:"En curso",color:"#eab308"},COMPLETED:{text:"Completado",color:"#22c55e"},CANCELED:{text:"Cancelado",color:"#ef4444"}}[e]||{text:e,color:"#9aa4b2"};return(0,a.jsx)("span",{style:{padding:"2px 8px",borderRadius:999,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",color:t.color},children:t.text})}(e.status)}),(0,a.jsx)("td",{className:"muted",children:new Date(e.requestedAt).toLocaleString()}),(0,a.jsx)("td",{className:"muted",children:null!=e.costUsd?"$".concat(Number(e.costUsd).toFixed(2)):"-"}),(0,a.jsx)("td",{children:(t=e.preferredMethod)?(0,a.jsx)("span",{style:{padding:"2px 8px",borderRadius:999,background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",color:"CARD"===t?"#06b6d4":"#9aa4b2"},children:"CARD"===t?"Tarjeta":"Efectivo"}):(0,a.jsx)("span",{className:"muted",children:"-"})}),(0,a.jsx)("td",{children:(0,a.jsx)(i.default,{className:"btn secondary",href:"/rider/trip/".concat(e.id),"aria-label":"Ver viaje ".concat(e.id),children:"Ver"})})]},e.id)})})]}),d&&(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)("button",{className:"btn",onClick:N,disabled:h,"aria-label":"Cargar m\xe1s viajes",children:h?"Cargandoâ€¦":"Cargar m\xe1s"})})]})}},21:function(e,t,r){"use strict";r.d(t,{ik:function(){return s},qM:function(){return n}});var a=r(7437);function n(e){let{height:t=16,width:r="100%",style:n,className:s}=e;return(0,a.jsx)("div",{className:s,style:{height:t,width:r,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...n}})}function s(e){let{lines:t=3}=e;return(0,a.jsx)("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:t}).map((e,t)=>(0,a.jsx)(n,{height:12,width:"".concat(80-8*t,"%")},t))})}if(r(2265),!document.getElementById("sk-keyframes")){let e=document.createElement("style");e.id="sk-keyframes",e.innerHTML="@keyframes skeleton { 0%{background-position:100% 50%} 100%{background-position:0 50%} }",document.head.appendChild(e)}},2800:function(e,t,r){"use strict";r.d(t,{S:function(){return a},j:function(){return n}});let a="http://localhost:8081";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=new Headers(t.headers||{});n.set("Content-Type","application/json"),r&&n.set("Authorization","Bearer ".concat(r));let s=await fetch("".concat(a).concat(e),{...t,headers:n,cache:"no-store"});if(!s.ok){let e=await s.text().catch(()=>"");throw Error("API ".concat(s.status,": ").concat(e||s.statusText))}return s.json()}},4282:function(e,t,r){"use strict";r.d(t,{DH:function(){return c},J1:function(){return l},PR:function(){return i},oC:function(){return o}});var a=r(6300).Buffer;let n="taxi_token",s="taxi_user";function l(e,t){localStorage.setItem(n,e),localStorage.setItem(s,JSON.stringify(t))}function i(){let e=localStorage.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function c(){localStorage.removeItem(n),localStorage.removeItem(s)}function o(){let e=localStorage.getItem(n);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",r=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(r);return a.from(r,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(c(),null):null}}},function(e){e.O(0,[300,138,971,23,744],function(){return e(e.s=9291)}),_N_E=e.O()}]);