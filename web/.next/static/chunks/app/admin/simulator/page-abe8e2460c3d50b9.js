(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51],{9763:function(e,t,n){Promise.resolve().then(n.bind(n,8920))},8920:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(7437),a=n(2265),l=n(2800),s=n(4282);function i(){let[e,t]=(0,a.useState)("Guayaquil"),[n,i]=(0,a.useState)(5),[u,c]=(0,a.useState)(15),[o,d]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[f,p]=(0,a.useState)(1),[g,x]=(0,a.useState)([]),[b,j]=(0,a.useState)(""),[v,N]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=(0,s.PR)();if(!t){location.replace("/login");return}if("ADMIN"!==t.role){N("Acceso solo para ADMIN");return}let n=(0,s.oC)();if(!n){location.replace("/login");return}let r=new URLSearchParams;r.set("city",e),r.set("active","true"),(0,l.j)("/admin/tariffs?".concat(r),{},n).then(e=>{let t=e.items||[];x(t),t.length&&!b&&j(t[0].id)}).catch(e=>N((null==e?void 0:e.message)||"Error al cargar reglas"))},[e]);let y=(0,a.useMemo)(()=>g.find(e=>e.id===b)||null,[g,b]),S=(0,a.useMemo)(()=>{if(!y)return null;let e=Number(y.baseFareUsd||0),t=e+Number(y.perKmUsd||0)*Number(n||0)+Number(y.perMinUsd||0)*Number(u||0),r=(o?Number(y.nightMultiplier||1):1)*(h?Number(y.weekendMultiplier||1):1)*Number(f||1),a=t*r,l=Number(y.minFareUsd||0);return{base:e,beforeMin:a,minFare:l,total:Math.max(l,a),mult:r}},[y,n,u,o,h,f]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:"Simulador de Tarifa"}),(0,r.jsxs)("div",{className:"card",style:{display:"grid",gap:12,maxWidth:820},children:[(0,r.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Ciudad"}),(0,r.jsx)("input",{value:e,onChange:e=>t(e.target.value)})]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Regla"}),(0,r.jsx)("select",{value:b,onChange:e=>j(e.target.value),children:g.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.city," â€¢ base $",e.baseFareUsd,"/km $",e.perKmUsd,"/min $",e.perMinUsd]},e.id))})]})]}),(0,r.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Distancia (km)"}),(0,r.jsx)("input",{type:"number",step:"0.1",value:n,onChange:e=>i(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Duraci\xf3n (min)"}),(0,r.jsx)("input",{type:"number",step:"1",value:u,onChange:e=>c(Number(e.target.value))})]}),(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[(0,r.jsx)("input",{type:"checkbox",checked:o,onChange:e=>d(e.target.checked)})," Noche"]}),(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[(0,r.jsx)("input",{type:"checkbox",checked:h,onChange:e=>m(e.target.checked)})," Fin de semana"]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Surge"}),(0,r.jsx)("input",{type:"number",step:"0.1",value:f,onChange:e=>p(Number(e.target.value))})]})]}),v&&(0,r.jsx)("div",{style:{color:"var(--danger)"},children:v}),S&&(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{children:["Total estimado: ",(0,r.jsxs)("strong",{children:["$",S.total.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"muted",children:["(base + km + min) \xd7 mult = $",S.beforeMin.toFixed(2),"; m\xednimo $",S.minFare.toFixed(2)]})]})]})]})}},2800:function(e,t,n){"use strict";n.d(t,{S:function(){return r},j:function(){return a}});let r="http://localhost:8081";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=new Headers(t.headers||{});a.set("Content-Type","application/json"),n&&a.set("Authorization","Bearer ".concat(n));let l=await fetch("".concat(r).concat(e),{...t,headers:a,cache:"no-store"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error("API ".concat(l.status,": ").concat(e||l.statusText))}return l.json()}},4282:function(e,t,n){"use strict";n.d(t,{DH:function(){return u},J1:function(){return s},PR:function(){return i},oC:function(){return c}});var r=n(6300).Buffer;let a="taxi_token",l="taxi_user";function s(e,t){localStorage.setItem(a,e),localStorage.setItem(l,JSON.stringify(t))}function i(){let e=localStorage.getItem(l);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function u(){localStorage.removeItem(a),localStorage.removeItem(l)}function c(){let e=localStorage.getItem(a);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",n=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(n);return r.from(n,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(u(),null):null}}},function(e){e.O(0,[300,971,23,744],function(){return e(e.s=9763)}),_N_E=e.O()}]);