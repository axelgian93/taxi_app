(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[691],{6040:function(e,n,t){Promise.resolve().then(t.bind(t,5602))},5602:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return s}});var l=t(7437),a=t(2265),r=t(4282),o=t(8873);function s(){var e,n,t,s,i,u,d,c,m,g,v,h;let{show:b}=(0,o.p)(),[p,x]=(0,a.useState)([]),[f,j]=(0,a.useState)(!0),[y,N]=(0,a.useState)(null),[w,C]=(0,a.useState)(null),[S,k]=(0,a.useState)({key:"",name:"",center:{lat:0,lng:0},zoom:12,bounds:void 0}),[z,E]=(0,a.useState)(null),[T,L]=(0,a.useState)(null);async function I(){j(!0),N(null);let e=(0,r.oC)();if(!e){location.href="/login";return}try{let n=await fetch("".concat("http://localhost:8081","/admin/ops/cities"),{headers:{Authorization:"Bearer ".concat(e)},cache:"no-store"});if(!n.ok)throw Error("HTTP ".concat(n.status));let t=await n.json();x(Array.isArray(t.items)?t.items:[])}catch(e){N((null==e?void 0:e.message)||"Error al cargar")}finally{j(!1)}}async function P(){var e,n;if(N(null),C(null),!S.key.trim()||!S.name.trim()){N("Key y Nombre son obligatorios");return}if(S.center.lat<-90||S.center.lat>90||S.center.lng<-180||S.center.lng>180){N("Centro fuera de rango (-90..90, -180..180)");return}if((null!==(e=S.zoom)&&void 0!==e?e:12)<1||(null!==(n=S.zoom)&&void 0!==n?n:12)>20){N("Zoom fuera de rango (1..20)");return}let t=(0,r.oC)();if(!t){location.href="/login";return}try{let e={key:S.key.trim().toLowerCase(),name:S.name.trim(),center:{lat:Number(S.center.lat),lng:Number(S.center.lng)},zoom:Number(S.zoom||12)};if(S.bounds&&S.bounds.sw&&S.bounds.ne){let n=S.bounds;"number"==typeof n.sw.lat&&"number"==typeof n.sw.lng&&"number"==typeof n.ne.lat&&"number"==typeof n.ne.lng&&(e.bounds={sw:{lat:Number(n.sw.lat),lng:Number(n.sw.lng)},ne:{lat:Number(n.ne.lat),lng:Number(n.ne.lng)}})}let n=await fetch("".concat("http://localhost:8081","/admin/ops/cities"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(!n.ok)throw Error("HTTP ".concat(n.status));k({key:"",name:"",center:{lat:0,lng:0},zoom:12,bounds:void 0}),await I(),C("Ciudad creada"),b("Ciudad creada","success"),setTimeout(()=>C(null),2e3)}catch(e){N((null==e?void 0:e.message)||"Error al crear")}}async function O(e){if(!confirm("\xbfEliminar ciudad?"))return;let n=(0,r.oC)();if(!n){location.href="/login";return}try{let t=await fetch("".concat("http://localhost:8081","/admin/ops/cities/").concat(encodeURIComponent(e)),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}});if(!t.ok)throw Error("HTTP ".concat(t.status));await I(),C("Ciudad eliminada"),b("Ciudad eliminada","success"),setTimeout(()=>C(null),2e3)}catch(e){N((null==e?void 0:e.message)||"Error al eliminar")}}function W(){E(null),L(null)}async function _(){var e,n;if(!z||!T)return;if(!T.name.trim()){N("Nombre es obligatorio");return}if(T.center.lat<-90||T.center.lat>90||T.center.lng<-180||T.center.lng>180){N("Centro fuera de rango (-90..90, -180..180)");return}if((null!==(e=T.zoom)&&void 0!==e?e:12)<1||(null!==(n=T.zoom)&&void 0!==n?n:12)>20){N("Zoom fuera de rango (1..20)");return}let t=(0,r.oC)();if(!t){location.href="/login";return}try{let e={};T.name&&(e.name=T.name),T.center&&"number"==typeof T.center.lat&&"number"==typeof T.center.lng&&(e.center={lat:Number(T.center.lat),lng:Number(T.center.lng)}),null!=T.zoom&&(e.zoom=Number(T.zoom));let n=await fetch("".concat("http://localhost:8081","/admin/ops/cities/").concat(encodeURIComponent(z)),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(!n.ok)throw Error("HTTP ".concat(n.status));E(null),L(null),await I(),C("Ciudad actualizada"),b("Ciudad actualizada","success"),setTimeout(()=>C(null),2e3)}catch(e){N((null==e?void 0:e.message)||"Error al actualizar")}}return(0,a.useEffect)(()=>{I()},[]),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("h2",{children:"Ciudades"}),(0,l.jsx)("a",{className:"btn secondary",href:"/admin/ops",children:"Volver a Operaciones"})]}),(0,l.jsx)("div",{className:"card",style:{marginTop:10},children:(0,l.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap"},children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"Key"}),(0,l.jsx)("input",{value:S.key,onChange:e=>k({...S,key:e.target.value}),placeholder:"guayaquil"})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"Nombre"}),(0,l.jsx)("input",{value:S.name,onChange:e=>k({...S,name:e.target.value}),placeholder:"Guayaquil"})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"Lat"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:S.center.lat,onChange:e=>k({...S,center:{...S.center,lat:Number(e.target.value)}})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"Lng"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:S.center.lng,onChange:e=>k({...S,center:{...S.center,lng:Number(e.target.value)}})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"Zoom"}),(0,l.jsx)("input",{type:"number",min:"1",max:"20",value:S.zoom||12,onChange:e=>k({...S,zoom:Number(e.target.value)})})]}),(0,l.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-end"},children:[(0,l.jsx)("div",{className:"muted",style:{width:"100%"},children:"Bounds (opcional)"}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"SW Lat"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(m=null===(n=S.bounds)||void 0===n?void 0:null===(e=n.sw)||void 0===e?void 0:e.lat)&&void 0!==m?m:"",onChange:e=>k(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},sw:{...(null===(t=n.bounds)||void 0===t?void 0:t.sw)||{lat:0,lng:0},lat:Number(e.target.value||0)}}}})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"SW Lng"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(g=null===(s=S.bounds)||void 0===s?void 0:null===(t=s.sw)||void 0===t?void 0:t.lng)&&void 0!==g?g:"",onChange:e=>k(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},sw:{...(null===(t=n.bounds)||void 0===t?void 0:t.sw)||{lat:0,lng:0},lng:Number(e.target.value||0)}}}})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"NE Lat"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(v=null===(u=S.bounds)||void 0===u?void 0:null===(i=u.ne)||void 0===i?void 0:i.lat)&&void 0!==v?v:"",onChange:e=>k(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},ne:{...(null===(t=n.bounds)||void 0===t?void 0:t.ne)||{lat:0,lng:0},lat:Number(e.target.value||0)}}}})})]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("div",{className:"muted",children:"NE Lng"}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(h=null===(c=S.bounds)||void 0===c?void 0:null===(d=c.ne)||void 0===d?void 0:d.lng)&&void 0!==h?h:"",onChange:e=>k(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},ne:{...(null===(t=n.bounds)||void 0===t?void 0:t.ne)||{lat:0,lng:0},lng:Number(e.target.value||0)}}}})})]})]}),(0,l.jsx)("button",{className:"btn",onClick:P,children:"Agregar"})]})}),y&&(0,l.jsx)("div",{style:{color:"var(--danger)",marginTop:10},children:y}),w&&(0,l.jsx)("div",{style:{color:"#22c55e",marginTop:10},children:w}),f?(0,l.jsx)("div",{children:"Cargando…"}):(0,l.jsxs)("table",{className:"table",style:{marginTop:12},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Key"}),(0,l.jsx)("th",{children:"Nombre"}),(0,l.jsx)("th",{children:"Centro"}),(0,l.jsx)("th",{children:"Zoom"}),(0,l.jsx)("th",{children:"Bounds"}),(0,l.jsx)("th",{})]})}),(0,l.jsx)("tbody",{children:p.map(e=>{var n,t,a,r,o,s,i,u,d,c,m,g,v,h,b,p;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"muted",children:e.key}),z===e.key?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("td",{children:(0,l.jsx)("input",{value:(null==T?void 0:T.name)||"",onChange:e=>L(n=>({...n,name:e.target.value}))})}),(0,l.jsxs)("td",{className:"row",style:{gap:6},children:[(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(d=null==T?void 0:T.center.lat)&&void 0!==d?d:0,onChange:e=>L(n=>({...n,center:{...n.center,lat:Number(e.target.value)}}))}),(0,l.jsx)("input",{type:"number",step:"0.000001",value:null!==(c=null==T?void 0:T.center.lng)&&void 0!==c?c:0,onChange:e=>L(n=>({...n,center:{...n.center,lng:Number(e.target.value)}}))})]}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"number",min:1,max:20,value:null!==(m=null==T?void 0:T.zoom)&&void 0!==m?m:12,onChange:e=>L(n=>({...n,zoom:Number(e.target.value)}))})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"row",style:{gap:6,flexWrap:"wrap"},children:[(0,l.jsx)("input",{placeholder:"SW Lat",type:"number",step:"0.000001",value:null!==(g=null==T?void 0:null===(t=T.bounds)||void 0===t?void 0:null===(n=t.sw)||void 0===n?void 0:n.lat)&&void 0!==g?g:"",onChange:e=>L(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},sw:{...(null===(t=n.bounds)||void 0===t?void 0:t.sw)||{lat:0,lng:0},lat:Number(e.target.value||0)}}}})}),(0,l.jsx)("input",{placeholder:"SW Lng",type:"number",step:"0.000001",value:null!==(v=null==T?void 0:null===(r=T.bounds)||void 0===r?void 0:null===(a=r.sw)||void 0===a?void 0:a.lng)&&void 0!==v?v:"",onChange:e=>L(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},sw:{...(null===(t=n.bounds)||void 0===t?void 0:t.sw)||{lat:0,lng:0},lng:Number(e.target.value||0)}}}})}),(0,l.jsx)("input",{placeholder:"NE Lat",type:"number",step:"0.000001",value:null!==(h=null==T?void 0:null===(s=T.bounds)||void 0===s?void 0:null===(o=s.ne)||void 0===o?void 0:o.lat)&&void 0!==h?h:"",onChange:e=>L(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},ne:{...(null===(t=n.bounds)||void 0===t?void 0:t.ne)||{lat:0,lng:0},lat:Number(e.target.value||0)}}}})}),(0,l.jsx)("input",{placeholder:"NE Lng",type:"number",step:"0.000001",value:null!==(b=null==T?void 0:null===(u=T.bounds)||void 0===u?void 0:null===(i=u.ne)||void 0===i?void 0:i.lng)&&void 0!==b?b:"",onChange:e=>L(n=>{var t;return{...n,bounds:{...n.bounds||{sw:{lat:0,lng:0},ne:{lat:0,lng:0}},ne:{...(null===(t=n.bounds)||void 0===t?void 0:t.ne)||{lat:0,lng:0},lng:Number(e.target.value||0)}}}})}),(0,l.jsx)("button",{className:"btn secondary",onClick:()=>L(e=>e?{...e,bounds:null}:e),children:"Quitar bounds"})]})}),(0,l.jsxs)("td",{className:"row",style:{gap:6},children:[(0,l.jsx)("button",{className:"btn",onClick:_,children:"Guardar"}),(0,l.jsx)("button",{className:"btn secondary",onClick:W,children:"Cancelar"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("td",{children:e.name}),(0,l.jsxs)("td",{className:"muted",children:[e.center.lat,", ",e.center.lng]}),(0,l.jsx)("td",{className:"muted",children:null!==(p=e.zoom)&&void 0!==p?p:"-"}),(0,l.jsx)("td",{className:"muted",children:e.bounds?"".concat(e.bounds.sw.lat,",").concat(e.bounds.sw.lng," — ").concat(e.bounds.ne.lat,",").concat(e.bounds.ne.lng):"-"}),(0,l.jsxs)("td",{className:"row",style:{gap:6},children:[(0,l.jsx)("button",{className:"btn secondary",onClick:()=>(function(e){let n=new URLSearchParams;n.set("city",e.name),e.bounds?(n.set("swLat",String(e.bounds.sw.lat)),n.set("swLng",String(e.bounds.sw.lng)),n.set("neLat",String(e.bounds.ne.lat)),n.set("neLng",String(e.bounds.ne.lng))):(n.set("centerLat",String(e.center.lat)),n.set("centerLng",String(e.center.lng)),null!=e.zoom&&n.set("centerZoom",String(e.zoom))),location.href="/admin/ops?".concat(n.toString())})(e),children:"Usar en Operaciones"}),(0,l.jsx)("button",{className:"btn secondary",onClick:()=>{E(e.key),L({...e})},children:"Editar"}),(0,l.jsx)("button",{className:"btn secondary",onClick:()=>O(e.key),children:"Eliminar"})]})]})]},e.key)})})]})]})}},8873:function(e,n,t){"use strict";t.d(n,{V:function(){return s},p:function(){return o}});var l=t(7437),a=t(2265);let r=(0,a.createContext)(null);function o(){let e=(0,a.useContext)(r);if(!e)throw Error("useToast must be used within ToastProvider");return e}function s(e){let{children:n}=e,[t,o]=(0,a.useState)([]),s=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3200,l=Date.now()+Math.floor(1e3*Math.random()),a={id:l,kind:n,text:e,ttl:Date.now()+t};o(e=>[...e,a]),setTimeout(()=>o(e=>e.filter(e=>e.id!==l)),t)},i=(0,a.useMemo)(()=>({show:s}),[]);return(0,l.jsxs)(r.Provider,{value:i,children:[n,(0,l.jsx)("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:t.map(e=>(0,l.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:"4px solid ".concat("success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6")},children:[(0,l.jsx)("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),(0,l.jsx)("div",{className:"muted",children:e.text})]},e.id))})]})}},4282:function(e,n,t){"use strict";t.d(n,{DH:function(){return i},J1:function(){return o},PR:function(){return s},oC:function(){return u}});var l=t(6300).Buffer;let a="taxi_token",r="taxi_user";function o(e,n){localStorage.setItem(a,e),localStorage.setItem(r,JSON.stringify(n))}function s(){let e=localStorage.getItem(r);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function i(){localStorage.removeItem(a),localStorage.removeItem(r)}function u(){let e=localStorage.getItem(a);return e?!function(e){let n=function(e){let n=e.split(".");if(3!==n.length)return null;try{let e=function(e){try{let n=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",t=e.replace(/-/g,"+").replace(/_/g,"/")+n;if("function"==typeof atob)return atob(t);return l.from(t,"base64").toString("binary")}catch(e){return""}}(n[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=n&&!!n.exp&&Math.floor(Date.now()/1e3)>=n.exp}(e)?e:(i(),null):null}}},function(e){e.O(0,[300,971,23,744],function(){return e(e.s=6040)}),_N_E=e.O()}]);