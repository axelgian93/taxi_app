(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{1473:function(e,t,n){Promise.resolve().then(n.bind(n,5894))},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},5894:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(7437),i=n(2265),l=n(6463);function a(e){let{trips:t,drivers:n,height:l=520,onSelect:a,selected:s,follow:o,center:c,bounds:d}=e,u=i.useRef(null),f=i.useRef(null),m=i.useRef([]),h=i.useRef(new Map),g=i.useRef(null),p=i.useRef(null);function v(){let e=f.current,t=window.L;if(e&&t){if(g.current){try{e.removeLayer(g.current)}catch(e){}g.current=null}if(d){let n=t.latLngBounds([[d.sw.lat,d.sw.lng],[d.ne.lat,d.ne.lng]]);g.current=t.rectangle(n,{color:"#eab308",weight:2,fillOpacity:.05}),g.current.addTo(e),e.fitBounds(n.pad(.1),{maxZoom:15})}else c&&e.setView([c.lat,c.lng],c.zoom||Math.max(12,e.getZoom()||12),{animate:!0})}}return i.useEffect(()=>{let e=!1,t=()=>new Promise(e=>{if(window.L){e();return}let t=document.createElement("link");t.rel="stylesheet",t.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(t);let n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.defer=!0,n.onload=()=>e(),document.body.appendChild(n)});return(async()=>{await t(),e||function(){let e=window.L;if(e&&u.current&&!f.current){let t=e.map(u.current,{zoomControl:!0});t.setView([0,0],2),e.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(t),f.current=t}}()})(),()=>{e=!0}},[]),i.useEffect(()=>{f.current&&(function(){let e=window.L,n=f.current;if(e&&n){for(let e of m.current)try{n.removeLayer(e)}catch(e){}for(let r of(m.current=[],t)){if(r.origin&&isFinite(r.origin.lat)&&isFinite(r.origin.lng)){let t=e.circleMarker([r.origin.lat,r.origin.lng],{radius:6,color:"#22c55e",weight:2});t.on("click",()=>a&&a({type:"trip",id:r.id})),t.addTo(n),m.current.push(t)}if(r.destination&&isFinite(r.destination.lat)&&isFinite(r.destination.lng)){let t=e.circleMarker([r.destination.lat,r.destination.lng],{radius:6,color:"#ef4444",weight:2});t.on("click",()=>a&&a({type:"trip",id:r.id})),t.addTo(n),m.current.push(t)}}}}(),v())},[JSON.stringify(t)]),i.useEffect(()=>{f.current&&function(){let e=window.L,t=f.current;if(!e||!t)return;let r=new Set;for(let i of n){r.add(i.id);let n=i.pos,l=h.current.get(i.id);if(!n||!isFinite(n.lat)||!isFinite(n.lng)){if(l){try{t.removeLayer(l)}catch(e){}h.current.delete(i.id)}continue}let s="ON_TRIP"===i.status?"#4f46e5":"#9aa4b2";l?(l.setStyle({color:s}),l.setLatLng([n.lat,n.lng])):((l=e.circleMarker([n.lat,n.lng],{radius:5,color:s,weight:2})).on("click",()=>a&&a({type:"driver",id:i.id})),l.addTo(t),h.current.set(i.id,l))}for(let[e,n]of Array.from(h.current.entries()))if(!r.has(e)){try{t.removeLayer(n)}catch(e){}h.current.delete(e)}}()},[JSON.stringify(n)]),i.useEffect(()=>{f.current&&function(){if(!o||!s||!f.current)return;let e=null;if("driver"===s.type){let t=n.find(e=>e.id===s.id);t&&t.pos&&(e=t.pos)}else{let n=t.find(e=>e.id===s.id);n&&(e=n.origin||n.destination||null)}e&&f.current.setView([e.lat,e.lng],Math.max(13,f.current.getZoom()||13),{animate:!0})}()},[JSON.stringify(s),JSON.stringify(t),JSON.stringify(n),o]),i.useEffect(()=>{let e=window.L,r=f.current;if(!e||!r)return;if(p.current){try{r.removeLayer(p.current)}catch(e){}p.current=null}if(!s)return;let i=null;if("driver"===s.type){let e=n.find(e=>e.id===s.id);e&&e.pos&&isFinite(e.pos.lat)&&isFinite(e.pos.lng)&&(i=e.pos)}else{let e=t.find(e=>e.id===s.id);e&&(i=e.origin&&isFinite(e.origin.lat)&&isFinite(e.origin.lng)?e.origin:e.destination)}i&&(p.current=e.circleMarker([i.lat,i.lng],{radius:14,color:"#f59e0b",weight:3,fill:!1}),p.current.addTo(r))},[JSON.stringify(s),JSON.stringify(t),JSON.stringify(n)]),i.useEffect(()=>{v()},[JSON.stringify(d),c&&c.lat,c&&c.lng,c&&c.zoom]),(0,r.jsx)("div",{ref:u,style:{height:l}})}var s=n(2800),o=n(5155),c=n(21),d=n(4282);function u(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),n=(0,i.useRef)(!1),[u,p]=(0,i.useState)([]),[v,y]=(0,i.useState)(!0),[x,b]=(0,i.useState)(null),[j,w]=(0,i.useState)(!0),[N,S]=(0,i.useState)(!0),[k,C]=(0,i.useState)(""),[L,E]=(0,i.useState)([]),[A,I]=(0,i.useState)(null),[D,R]=(0,i.useState)(null),[T,O]=(0,i.useState)(!0),[P,z]=(0,i.useState)(["REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED"]),[B,_]=(0,i.useState)(["IDLE","ON_TRIP","ASSIGNED","ARRIVED"]),[J,M]=(0,i.useState)(null),[U,F]=(0,i.useState)([]),[W,V]=(0,i.useState)(null),[Z,G]=(0,i.useState)(""),[H,q]=(0,i.useState)(!1),Q=(0,i.useMemo)(()=>{let e=(Z||"").trim().toLowerCase();return!e||e.length<2?[]:[...u.filter(t=>(t.id||"").toLowerCase().includes(e)).slice(0,50).map(e=>({type:"trip",id:e.id,label:"Trip ".concat(e.id)})),...L.filter(t=>(t.id||"").toLowerCase().includes(e)).slice(0,50).map(e=>({type:"driver",id:e.id,label:"Driver ".concat(e.id)}))].slice(0,50)},[Z,JSON.stringify(u),JSON.stringify(L)]),K=(0,i.useMemo)(()=>u.filter(e=>"COMPLETED"!==e.status&&"CANCELED"!==e.status&&(!k||(e.city||"").toLowerCase()===k.toLowerCase())&&(0===P.length||P.includes(e.status))),[u,k,P]);async function Y(){try{let e=(0,d.oC)();if(!e)return;y(!0);let[t,n]=await Promise.all([fetch("".concat(s.S,"/admin/ops/active-trips").concat(k?"?city=".concat(encodeURIComponent(k)):""),{headers:{Authorization:"Bearer ".concat(e)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]})),fetch("".concat(s.S,"/admin/ops/active-drivers"),{headers:{Authorization:"Bearer ".concat(e)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]}))]);p(t.items||[]);let r=(n.items||[]).map(e=>{var t,n,r;return{id:e.userId,status:e.status,lat:null!==(t=e.lat)&&void 0!==t?t:null,lng:null!==(n=e.lng)&&void 0!==n?n:null,at:null!==(r=e.locationUpdatedAt)&&void 0!==r?r:null}});E(r)}catch(e){b((null==e?void 0:e.message)||"Error al refrescar")}finally{y(!1)}}(0,i.useEffect)(()=>{if(!n.current){n.current=!0;try{var e,r,i,l,a;let n=new URLSearchParams(t),s=JSON.parse(localStorage.getItem("ops_filters")||"{}"),o=null!==(e=n.get("city"))&&void 0!==e?e:s.city;o&&C(o);let c=n.get("centerLat"),d=n.get("centerLng"),u=n.get("centerZoom");c&&d&&M({lat:Number(c),lng:Number(d),zoom:u?Number(u):12});let f=n.get("swLat"),m=n.get("swLng"),h=n.get("neLat"),g=n.get("neLng");f&&m&&h&&g&&(V({sw:{lat:Number(f),lng:Number(m)},ne:{lat:Number(h),lng:Number(g)}}),M(null)),c||f||!s.center||"number"!=typeof s.center.lat||"number"!=typeof s.center.lng||M({lat:Number(s.center.lat),lng:Number(s.center.lng),zoom:s.center.zoom?Number(s.center.zoom):12}),!f&&s.bounds&&s.bounds.sw&&s.bounds.ne&&(V({sw:{lat:Number(s.bounds.sw.lat),lng:Number(s.bounds.sw.lng)},ne:{lat:Number(s.bounds.ne.lat),lng:Number(s.bounds.ne.lng)}}),M(null));let p=null!==(r=n.get("trip"))&&void 0!==r?r:Array.isArray(s.trip)?s.trip.join(","):void 0;p&&z(String(p).split(",").filter(Boolean));let v=null!==(i=n.get("driver"))&&void 0!==i?i:Array.isArray(s.driver)?s.driver.join(","):void 0;v&&_(String(v).split(",").filter(Boolean));let y=null!==(l=n.get("sse"))&&void 0!==l?l:s.useSse?"1":"0";S("1"===String(y));let x=null!==(a=n.get("follow"))&&void 0!==a?a:s.follow?"1":"0";O("1"===String(x))}catch(e){}}let o=(0,d.PR)();if(!o){location.replace("/login");return}if("ADMIN"!==o.role){b("Acceso solo para ADMIN"),y(!1);return}let c=(0,d.oC)();if(!c){location.replace("/login");return}y(!0),(async()=>{try{let[e,t]=await Promise.all([fetch("".concat(s.S,"/admin/ops/active-trips").concat(k?"?city=".concat(encodeURIComponent(k)):""),{headers:{Authorization:"Bearer ".concat(c)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]})),fetch("".concat(s.S,"/admin/ops/active-drivers"),{headers:{Authorization:"Bearer ".concat(c)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]}))]);p(e.items||[]);let n=(t.items||[]).map(e=>{var t,n,r;return{id:e.userId,status:e.status,lat:null!==(t=e.lat)&&void 0!==t?t:null,lng:null!==(n=e.lng)&&void 0!==n?n:null,at:null!==(r=e.locationUpdatedAt)&&void 0!==r?r:null}});E(n),fetch("".concat(s.S,"/admin/ops/cities"),{headers:{Authorization:"Bearer ".concat(c)},cache:"no-store"}).then(e=>e.ok?e.json():{items:[]}).then(e=>{Array.isArray(e.items)&&F(e.items)}).catch(()=>{})}catch(e){b((null==e?void 0:e.message)||"Error al cargar datos de operaciones")}finally{y(!1)}})()},[]),(0,i.useEffect)(()=>{let t=new URLSearchParams;k&&t.set("city",k),P.length&&t.set("trip",P.join(",")),B.length&&t.set("driver",B.join(",")),t.set("sse",N?"1":"0"),t.set("follow",T?"1":"0"),W&&W.sw&&W.ne?(t.set("swLat",String(W.sw.lat)),t.set("swLng",String(W.sw.lng)),t.set("neLat",String(W.ne.lat)),t.set("neLng",String(W.ne.lng))):J&&(t.set("centerLat",String(J.lat)),t.set("centerLng",String(J.lng)),J.zoom&&t.set("centerZoom",String(J.zoom)));let n=t.toString();e.replace("/admin/ops".concat(n?"?".concat(n):""));try{localStorage.setItem("ops_filters",JSON.stringify({city:k,trip:P,driver:B,useSse:N,follow:T,center:J,bounds:W}))}catch(e){}},[k,P,B,N,T,J,W]),(0,i.useEffect)(()=>{if(!j)return;let e=!1,t=async()=>{let t=(0,d.oC)();if(t)try{if(N){let e=new AbortController,n="".concat(s.S,"/admin/ops/sse").concat(k?"?city=".concat(encodeURIComponent(k)):"");return(0,o.Z)(n,{token:t,signal:e.signal,onEvent:e=>{if("SNAPSHOT"===(e.event||"").toUpperCase()){let t=e.data||{};t.trips&&p(t.trips),t.drivers&&E(t.drivers)}}}).catch(()=>{}),()=>e.abort()}{let[n,r]=await Promise.all([fetch("".concat(s.S,"/admin/ops/active-trips").concat(k?"?city=".concat(encodeURIComponent(k)):""),{headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]})),fetch("".concat(s.S,"/admin/ops/active-drivers"),{headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"}).then(e=>e.json()).catch(()=>({items:[]}))]);if(e)return;p(n.items||[]);let i=(r.items||[]).map(e=>{var t,n,r;return{id:e.userId,status:e.status,lat:null!==(t=e.lat)&&void 0!==t?t:null,lng:null!==(n=e.lng)&&void 0!==n?n:null,at:null!==(r=e.locationUpdatedAt)&&void 0!==r?r:null}});E(i)}}catch(e){}};if(N){let n=t();return()=>{e=!0,"function"==typeof n&&n()}}{let n=setInterval(t,1e4);return t(),()=>{e=!0,clearInterval(n)}}},[j,k,N]),(0,i.useEffect)(()=>{let e=e=>{var t,n;let r=null===(n=e.target)||void 0===n?void 0:null===(t=n.tagName)||void 0===t?void 0:t.toLowerCase();"input"!==r&&"textarea"!==r&&(("r"===e.key||"R"===e.key)&&(e.preventDefault(),Y()),("f"===e.key||"F"===e.key)&&(e.preventDefault(),O(e=>!e)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let X=K.map(e=>({id:e.id,origin:(null==e?void 0:e.origin)&&"number"==typeof e.origin.lat&&"number"==typeof e.origin.lng?{lat:e.origin.lat,lng:e.origin.lng}:(null==e?void 0:e.pickupLat)!=null&&(null==e?void 0:e.pickupLng)!=null?{lat:Number(e.pickupLat),lng:Number(e.pickupLng)}:null,destination:(null==e?void 0:e.destination)&&"number"==typeof e.destination.lat&&"number"==typeof e.destination.lng?{lat:e.destination.lat,lng:e.destination.lng}:(null==e?void 0:e.dropoffLat)!=null&&(null==e?void 0:e.dropoffLng)!=null?{lat:Number(e.dropoffLat),lng:Number(e.dropoffLng)}:null})),$=L.filter(e=>0===B.length||!e.status||B.includes(e.status)).map(e=>({id:e.id,pos:null!=e.lat&&null!=e.lng?{lat:e.lat,lng:e.lng}:null,status:e.status})),ee=(e,t)=>{I({type:e,id:t}),O(!0)};function et(){try{let e=String(Z||"").trim();if(!e)return;if(e.startsWith("trp_")){let t=u.find(t=>t.id===e);if(t){ee("trip",t.id);return}}if(e.startsWith("drv_")){let t=L.find(t=>t.id===e);if(t){ee("driver",t.id);return}}let t=u.find(t=>t.id===e);if(t){ee("trip",t.id);return}let n=L.find(t=>t.id===e);if(n){ee("driver",n.id);return}}catch(e){}}return v?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"card",style:{marginBottom:10},children:[(0,r.jsx)("strong",{children:"Operaciones"}),(0,r.jsx)("div",{style:{marginTop:8},children:(0,r.jsx)(c.ik,{lines:2})})]}),(0,r.jsx)(c.qM,{height:520})]}):x?(0,r.jsx)("div",{style:{color:"var(--danger)"},children:x}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"muted",style:{marginBottom:6},children:["Ayuda: ",(0,r.jsx)("a",{href:"/admin/readme",children:"/admin/readme"})]}),(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("h2",{children:"Operaciones"}),(0,r.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[(0,r.jsx)("span",{className:"muted",children:"Ciudad"}),(0,r.jsx)("input",{list:"ops-cities",value:k,onChange:e=>C(e.target.value),placeholder:"Guayaquil"}),(0,r.jsx)("datalist",{id:"ops-cities",children:U.map(e=>(0,r.jsx)("option",{value:e.name},e.key))})]}),(0,r.jsx)("button",{className:"btn secondary",onClick:()=>(function(e,t,n,r){if(!t)return;let i=t.trim().toLowerCase(),l=n.find(e=>e.key.toLowerCase()===i||e.name.toLowerCase()===i);l&&(l.bounds&&r?(r(l.bounds),e(null)):(r&&r(null),e({...l.center,zoom:l.zoom})))})(M,k,U,V),children:"Centrar ciudad"}),(0,r.jsx)(h,{value:P,onChange:z}),(0,r.jsx)(g,{value:B,onChange:_}),(0,r.jsxs)("button",{className:"btn secondary",onClick:()=>w(e=>!e),children:[j?"Pausar":"Reanudar"," auto"]}),(0,r.jsx)("button",{className:"btn secondary",onClick:()=>S(e=>!e),children:N?"Usar polling":"Usar SSE"}),(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[(0,r.jsx)("input",{type:"checkbox",checked:T,onChange:e=>O(e.target.checked)}),(0,r.jsx)("span",{className:"muted",children:"Seguir seleccionado"})]}),(0,r.jsx)("a",{className:"btn secondary",href:"/admin/ops/cities",children:"Administrar ciudades"})]})]}),(0,r.jsx)("div",{className:"card",style:{marginTop:8},children:(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-start"},children:[(0,r.jsxs)("label",{style:{position:"relative"},children:[(0,r.jsx)("div",{className:"muted",children:"Buscar ID (trip o driver)"}),(0,r.jsx)("input",{"aria-label":"Buscar ID (trip o driver)",placeholder:"trp_... o drv_...",list:"ops-ids",value:Z,onChange:e=>{G(e.target.value),q(!0)},onFocus:()=>q(!0),onBlur:()=>setTimeout(()=>q(!1),150),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),et())},style:{minWidth:280}}),(0,r.jsxs)("datalist",{id:"ops-ids",children:[u.slice(0,200).map(e=>(0,r.jsx)("option",{value:e.id,children:"Trip ".concat(e.id)},e.id)),L.slice(0,200).map(e=>(0,r.jsx)("option",{value:e.id,children:"Driver ".concat(e.id)},e.id))]}),H&&Q.length>0&&(0,r.jsx)("ul",{style:{position:"absolute",top:"100%",left:0,right:0,zIndex:5,background:"var(--surface)",border:"1px solid rgba(255,255,255,0.1)",maxHeight:220,overflowY:"auto",listStyle:"none",margin:0,padding:0},children:Q.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)("button",{type:"button",onClick:()=>{G(e.id),ee(e.type,e.id),q(!1)},className:"btn secondary",style:{display:"block",width:"100%",textAlign:"left",borderRadius:0},children:e.label})},"".concat(e.type,"-").concat(e.id)))})]}),(0,r.jsx)("button",{className:"btn",onClick:()=>{et(),q(!1)},"aria-label":"Seleccionar en mapa",children:"Seleccionar"})]})}),(0,r.jsxs)("div",{className:"card",style:{padding:0,marginTop:10,display:"flex",gap:12},children:[(0,r.jsx)("div",{style:{flex:"1 1 auto"},children:(0,r.jsx)(a,{trips:X,drivers:$,onSelect:e=>I(e),selected:A,follow:T,center:J,bounds:W})}),(0,r.jsx)(m,{selected:A,trips:u,drivers:L,onClose:()=>{I(null),R(null)},onNeedTripDetail:async e=>{let t=(0,d.oC)();t&&R(await (0,s.j)("/trips/".concat(encodeURIComponent(e)),{},t))}})]}),(0,r.jsxs)("div",{className:"row",style:{gap:16,marginTop:10,flexWrap:"wrap"},children:[(0,r.jsxs)("div",{className:"card",style:{flex:"1 1 300px"},children:[(0,r.jsx)("strong",{children:"Activos"}),(0,r.jsxs)("div",{className:"muted",children:["Trips activos: ",K.length]}),(0,r.jsxs)("div",{className:"muted",children:["Drivers activos: ",L.length]}),(0,r.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[(0,r.jsx)(f,{color:"#22c55e",label:"Origen"}),(0,r.jsx)(f,{color:"#ef4444",label:"Destino"}),(0,r.jsx)(f,{color:"#4f46e5",label:"Driver ON_TRIP",dot:!0}),(0,r.jsx)(f,{color:"#9aa4b2",label:"Driver IDLE",dot:!0})]})]}),(0,r.jsxs)("div",{className:"card",style:{flex:"2 1 480px"},children:[(0,r.jsx)("strong",{children:"\xdaltimos trips activos"}),(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ID"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Ciudad"}),(0,r.jsx)("th",{children:"Driver"})]})}),(0,r.jsx)("tbody",{children:K.slice(0,10).map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.id}),(0,r.jsx)("td",{children:e.status}),(0,r.jsx)("td",{className:"muted",children:e.city||"-"}),(0,r.jsx)("td",{className:"muted",children:e.driverId||"-"})]},e.id))})]})]})]})]})}function f(e){let{color:t,label:n,dot:i}=e;return(0,r.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,r.jsx)("span",{style:{width:i?12:16,height:i?12:10,background:t,borderRadius:i?"50%":2,display:"inline-block"}}),(0,r.jsx)("span",{className:"muted",children:n})]})}function m(e){let{selected:t,trips:n,drivers:i,onClose:l,onNeedTripDetail:a}=e;if(!t)return(0,r.jsx)("div",{style:{width:320}});let s={width:320,borderLeft:"1px solid rgba(255,255,255,0.1)",padding:12};if("trip"===t.type){let e=n.find(e=>e.id===t.id);return(0,r.jsxs)("div",{style:s,children:[(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,r.jsx)("strong",{children:"Trip"}),(0,r.jsx)("button",{className:"btn secondary",onClick:l,children:"Cerrar"})]}),(0,r.jsx)("div",{className:"muted",style:{marginTop:6},children:null==e?void 0:e.id}),(0,r.jsxs)("div",{className:"muted",children:["Status: ",(null==e?void 0:e.status)||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Ciudad: ",(null==e?void 0:e.city)||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Driver: ",(null==e?void 0:e.driverId)||"-"]}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("a",{className:"btn",href:"/admin/trips/".concat(t.id),children:"Abrir detalle"}),(0,r.jsx)("button",{className:"btn secondary",style:{marginLeft:8},onClick:()=>a(t.id),children:"Refrescar"})]})]})}{var o,c;let e=i.find(e=>e.id===t.id);return(0,r.jsxs)("div",{style:s,children:[(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,r.jsx)("strong",{children:"Driver"}),(0,r.jsx)("button",{className:"btn secondary",onClick:l,children:"Cerrar"})]}),(0,r.jsx)("div",{className:"muted",style:{marginTop:6},children:null==e?void 0:e.id}),(0,r.jsxs)("div",{className:"muted",children:["Status: ",(null==e?void 0:e.status)||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Ubicaci\xf3n: ",null!==(o=null==e?void 0:e.lat)&&void 0!==o?o:"-",", ",null!==(c=null==e?void 0:e.lng)&&void 0!==c?c:"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Actualizado: ",(null==e?void 0:e.at)?new Date(e.at).toLocaleString():"-"]})]})}}function h(e){let{value:t,onChange:n}=e,i=e=>n(t.includes(e)?t.filter(t=>t!==e):t.concat(e));return(0,r.jsxs)("div",{className:"row",style:{gap:6},children:[(0,r.jsx)("span",{className:"muted",children:"Trip"}),["REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED"].map(e=>(0,r.jsxs)("label",{className:"row",style:{gap:4},children:[(0,r.jsx)("input",{type:"checkbox",checked:t.includes(e),onChange:()=>i(e)}),(0,r.jsx)("span",{className:"muted",style:{fontSize:12},children:e})]},e))]})}function g(e){let{value:t,onChange:n}=e,i=e=>n(t.includes(e)?t.filter(t=>t!==e):t.concat(e));return(0,r.jsxs)("div",{className:"row",style:{gap:6},children:[(0,r.jsx)("span",{className:"muted",children:"Driver"}),["IDLE","ON_TRIP","ASSIGNED","ARRIVED"].map(e=>(0,r.jsxs)("label",{className:"row",style:{gap:4},children:[(0,r.jsx)("input",{type:"checkbox",checked:t.includes(e),onChange:()=>i(e)}),(0,r.jsx)("span",{className:"muted",style:{fontSize:12},children:e})]},e))]})}},21:function(e,t,n){"use strict";n.d(t,{ik:function(){return l},qM:function(){return i}});var r=n(7437);function i(e){let{height:t=16,width:n="100%",style:i,className:l}=e;return(0,r.jsx)("div",{className:l,style:{height:t,width:n,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...i}})}function l(e){let{lines:t=3}=e;return(0,r.jsx)("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:t}).map((e,t)=>(0,r.jsx)(i,{height:12,width:"".concat(80-8*t,"%")},t))})}if(n(2265),!document.getElementById("sk-keyframes")){let e=document.createElement("style");e.id="sk-keyframes",e.innerHTML="@keyframes skeleton { 0%{background-position:100% 50%} 100%{background-position:0 50%} }",document.head.appendChild(e)}},2800:function(e,t,n){"use strict";n.d(t,{S:function(){return r},j:function(){return i}});let r="http://localhost:8081";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=new Headers(t.headers||{});i.set("Content-Type","application/json"),n&&i.set("Authorization","Bearer ".concat(n));let l=await fetch("".concat(r).concat(e),{...t,headers:i,cache:"no-store"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error("API ".concat(l.status,": ").concat(e||l.statusText))}return l.json()}},4282:function(e,t,n){"use strict";n.d(t,{DH:function(){return o},J1:function(){return a},PR:function(){return s},oC:function(){return c}});var r=n(6300).Buffer;let i="taxi_token",l="taxi_user";function a(e,t){localStorage.setItem(i,e),localStorage.setItem(l,JSON.stringify(t))}function s(){let e=localStorage.getItem(l);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function o(){localStorage.removeItem(i),localStorage.removeItem(l)}function c(){let e=localStorage.getItem(i);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",n=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(n);return r.from(n,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(o(),null):null}},5155:function(e,t,n){"use strict";async function r(e,t){let n=new AbortController,r=t.signal?function(e,t){if(e.aborted)return e;if(t.aborted)return t;let n=new AbortController,r=()=>n.abort();return e.addEventListener("abort",r),t.addEventListener("abort",r),n.signal}(n.signal,t.signal):n.signal,i=await fetch(e,{method:"GET",headers:{Accept:"text/event-stream",...t.token?{Authorization:"Bearer ".concat(t.token)}:{}},cache:"no-store",signal:r});if(!i.ok||!i.body)throw Error("SSE HTTP ".concat(i.status));let l=i.body.getReader(),a=new TextDecoder("utf-8"),s="",o=!1;return(async()=>{try{for(;;){let e;let{value:n,done:r}=await l.read();if(r)break;for(s+=a.decode(n,{stream:!0});-1!==(e=s.indexOf("\n\n"));){let n=s.slice(0,e);s=s.slice(e+2);let r=function(e){let t;let n=e.split(/\r?\n/),r=[];for(let e of n){if(!e||e.startsWith(":"))continue;let n=e.indexOf(":"),i=-1===n?e:e.slice(0,n),l=-1===n?"":e.slice(n+1).replace(/^ /,"");"event"===i?t=l:"data"===i&&r.push(l)}let i=r.join("\n"),l=i;try{l=i?JSON.parse(i):void 0}catch(e){}return t||i?{event:t,data:l}:null}(n);r&&t.onEvent(r)}}}catch(e){}finally{o||n.abort()}})(),{close:()=>{o=!0,n.abort()}}}n.d(t,{Z:function(){return r}})}},function(e){e.O(0,[300,971,23,744],function(){return e(e.s=1473)}),_N_E=e.O()}]);