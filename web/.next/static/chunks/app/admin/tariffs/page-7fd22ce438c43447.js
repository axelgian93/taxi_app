(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[74],{9959:function(e,t,n){Promise.resolve().then(n.bind(n,1278))},1278:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(7437),a=n(2265),l=n(7138),i=n(2800),c=n(4282),s=n(21);function o(){let[e,t]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[f,m]=(0,a.useState)(""),[x,g]=(0,a.useState)("all"),j=(0,a.useMemo)(()=>{let e=new URLSearchParams;return f&&e.set("city",f),"all"!==x&&e.set("active","true"===x?"true":"false"),e.toString()},[f,x]);return(0,a.useEffect)(()=>{let e=(0,c.PR)();if(!e){location.replace("/login");return}if("ADMIN"!==e.role){h("Acceso solo para ADMIN"),o(!1);return}let n=(0,c.oC)();if(!n){location.replace("/login");return}o(!0),(0,i.j)("/admin/tariffs".concat(j?"?".concat(j):""),{},n).then(e=>t(e.items||[])).catch(e=>h((null==e?void 0:e.message)||"Error al cargar tarifas")).finally(()=>o(!1))},[j]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("h2",{children:"Tarifas"}),(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[(0,r.jsx)("button",{className:"btn secondary",onClick:d,children:"Auditor\xeda CSV"}),(0,r.jsx)(l.default,{href:"/admin/tariffs/new",className:"btn",children:"Nueva regla"})]})]}),(0,r.jsx)("div",{className:"card",style:{margin:"12px 0"},children:(0,r.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Ciudad"}),(0,r.jsx)("input",{value:f,onChange:e=>m(e.target.value),placeholder:"Guayaquil",style:{padding:6,borderRadius:8}})]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("div",{className:"muted",children:"Activa"}),(0,r.jsxs)("select",{value:x,onChange:e=>g(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"Todas"}),(0,r.jsx)("option",{value:"true",children:"Solo activas"}),(0,r.jsx)("option",{value:"false",children:"Solo inactivas"})]})]})]})}),n?(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"table-wrap",children:(0,r.jsx)(s.qM,{height:220})})}):u?(0,r.jsx)("div",{style:{color:"var(--danger)"},children:u}):(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Ciudad"}),(0,r.jsx)("th",{children:"Activa"}),(0,r.jsx)("th",{children:"Base"}),(0,r.jsx)("th",{children:"$/km"}),(0,r.jsx)("th",{children:"$/min"}),(0,r.jsx)("th",{children:"M\xednimo"}),(0,r.jsx)("th",{children:"Multipliers"}),(0,r.jsx)("th",{children:"Actualizada"}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:e.map(e=>{var t,n,a,i;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.city}),(0,r.jsx)("td",{children:e.active?"S\xed":"No"}),(0,r.jsxs)("td",{children:["$",e.baseFareUsd.toFixed(2)]}),(0,r.jsxs)("td",{children:["$",e.perKmUsd.toFixed(2)]}),(0,r.jsxs)("td",{children:["$",e.perMinUsd.toFixed(2)]}),(0,r.jsxs)("td",{children:["$",Number(null!==(t=e.minFareUsd)&&void 0!==t?t:0).toFixed(2)]}),(0,r.jsxs)("td",{className:"muted",children:["N:",null!==(n=e.nightMultiplier)&&void 0!==n?n:1," \xb7 W:",null!==(a=e.weekendMultiplier)&&void 0!==a?a:1," \xb7 S:",null!==(i=e.surgeMultiplier)&&void 0!==i?i:1]}),(0,r.jsx)("td",{className:"muted",children:new Date(e.updatedAt).toLocaleString()}),(0,r.jsx)("td",{children:(0,r.jsx)(l.default,{className:"btn secondary",href:"/admin/tariffs/".concat(e.id),children:"Editar"})})]},e.id)})})]})]})}async function d(){try{let e=(0,c.oC)();if(!e){location.href="/login";return}let t=await fetch("".concat("http://localhost:8081","/admin/audit/tariffs?format=csv"),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP ".concat(t.status));let n=await t.blob(),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download="tariffs_audit_".concat(new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}catch(e){alert("No se pudo descargar CSV de auditor\xeda")}}},21:function(e,t,n){"use strict";n.d(t,{ik:function(){return l},qM:function(){return a}});var r=n(7437);function a(e){let{height:t=16,width:n="100%",style:a,className:l}=e;return(0,r.jsx)("div",{className:l,style:{height:t,width:n,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...a}})}function l(e){let{lines:t=3}=e;return(0,r.jsx)("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:t}).map((e,t)=>(0,r.jsx)(a,{height:12,width:"".concat(80-8*t,"%")},t))})}if(n(2265),!document.getElementById("sk-keyframes")){let e=document.createElement("style");e.id="sk-keyframes",e.innerHTML="@keyframes skeleton { 0%{background-position:100% 50%} 100%{background-position:0 50%} }",document.head.appendChild(e)}},2800:function(e,t,n){"use strict";n.d(t,{S:function(){return r},j:function(){return a}});let r="http://localhost:8081";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=new Headers(t.headers||{});a.set("Content-Type","application/json"),n&&a.set("Authorization","Bearer ".concat(n));let l=await fetch("".concat(r).concat(e),{...t,headers:a,cache:"no-store"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error("API ".concat(l.status,": ").concat(e||l.statusText))}return l.json()}},4282:function(e,t,n){"use strict";n.d(t,{DH:function(){return s},J1:function(){return i},PR:function(){return c},oC:function(){return o}});var r=n(6300).Buffer;let a="taxi_token",l="taxi_user";function i(e,t){localStorage.setItem(a,e),localStorage.setItem(l,JSON.stringify(t))}function c(){let e=localStorage.getItem(l);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function s(){localStorage.removeItem(a),localStorage.removeItem(l)}function o(){let e=localStorage.getItem(a);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",n=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(n);return r.from(n,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(s(),null):null}}},function(e){e.O(0,[300,138,971,23,744],function(){return e(e.s=9959)}),_N_E=e.O()}]);