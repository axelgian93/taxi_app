(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{7144:function(e,t,a){Promise.resolve().then(a.bind(a,9477))},6463:function(e,t,a){"use strict";var n=a(1169);a.o(n,"useParams")&&a.d(t,{useParams:function(){return n.useParams}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})},9477:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var n=a(7437),r=a(2265),s=a(6463),l=a(4282),i=a(21);let o="http://localhost:8081";function c(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),a=(0,r.useRef)(!1),[c,g]=(0,r.useState)(""),[v,k]=(0,r.useState)(""),[M,C]=(0,r.useState)(""),[D,R]=(0,r.useState)(""),[I,A]=(0,r.useState)("city_method"),[T,_]=(0,r.useState)(1e3),[P,B]=(0,r.useState)(!1),[O,L]=(0,r.useState)([]),[E,U]=(0,r.useState)([]),[F,z]=(0,r.useState)([]),[K,W]=(0,r.useState)([]),[Y,q]=(0,r.useState)([]),[G,H]=(0,r.useState)([]),[J,V]=(0,r.useState)([]),[X,$]=(0,r.useState)(!1),[Z,Q]=(0,r.useState)(null),ee=(0,r.useMemo)(()=>d(I),[I]),et=(0,r.useMemo)(()=>u(O,ee),[O,ee]),ea=(0,r.useMemo)(()=>u(E,ee),[E,ee]),en=(0,r.useMemo)(()=>m(O,ee),[O,ee]),er=(0,r.useMemo)(()=>m(E,ee),[E,ee]),es=(0,r.useMemo)(()=>u(F,d("day")),[F]),el=(0,r.useMemo)(()=>u(K,d("city")),[K]),ei=(0,r.useMemo)(()=>u(Y,d("method")),[Y]),eo=(0,r.useMemo)(()=>p(O),[O]),ec=(0,r.useMemo)(()=>p(E),[E]),[ed,eu]=(0,r.useState)(null);if((0,r.useEffect)(()=>{if(a.current)return;a.current=!0;let e=new URLSearchParams(t),n=e.get("from"),r=e.get("to"),s=e.get("city"),l=e.get("method"),i=e.get("groupBy"),o=e.get("limit"),c=e.get("compare");n&&g(n),r&&k(r),s&&C(s),l&&R(l),i&&["city","method","city_method","day","city_day"].includes(i)&&A(i),o&&!isNaN(Number(o))&&_(Number(o)),"1"===c&&B(!0)},[t]),(0,r.useEffect)(()=>{let t=new URLSearchParams;c&&t.set("from",c),v&&t.set("to",v),M&&t.set("city",M),D&&t.set("method",D),t.set("groupBy",I),t.set("limit",String(T)),P&&t.set("compare","1");let a=t.toString();e.replace("/admin/reports".concat(a?"?".concat(a):""))},[c,v,M,D,I,T,P]),(0,r.useEffect)(()=>{let e=(0,l.PR)();if(!e){location.replace("/login");return}if("ADMIN"!==e.role){Q("Acceso solo para ADMIN");return}},[]),X)return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h2",{children:"Reportes"}),(0,n.jsxs)("div",{className:"row",style:{gap:8},children:[(0,n.jsx)(i.qM,{height:32,width:120}),(0,n.jsx)(i.qM,{height:32,width:140})]})]}),(0,n.jsx)("div",{className:"card",style:{marginTop:10},children:(0,n.jsx)(i.ik,{lines:2})}),(0,n.jsx)("div",{className:"card",style:{marginTop:10},children:(0,n.jsx)(i.qM,{height:260})}),(0,n.jsxs)("div",{className:"row",style:{gap:10,marginTop:10,flexWrap:"wrap"},children:[(0,n.jsx)(i.qM,{height:180,width:280}),(0,n.jsx)(i.qM,{height:180,width:280}),(0,n.jsx)(i.qM,{height:180,width:280})]})]});async function eh(){Q(null);let e=(0,l.oC)();if(!e){location.href="/login";return}$(!0);try{let t=new URLSearchParams;c&&t.set("from",new Date(c).toISOString()),v&&t.set("to",new Date(v+"T23:59:59").toISOString()),M&&t.set("city",M),D&&t.set("method",D),t.set("groupBy",I),t.set("format","json"),t.set("limit",String(T));let a=await fetch("".concat(o,"/admin/revenue/report?").concat(t),{headers:{Authorization:"Bearer ".concat((0,l.oC)())},cache:"no-store"});if(!a.ok)throw Error("HTTP ".concat(a.status));let n=await a.json(),r=Array.isArray(n.items)?n.items:[];if(L(r),U([]),P&&c&&v){let t=new Date(c),a=new Date(v+"T23:59:59").getTime()-t.getTime(),n=new Date(t.getTime()-1e3),r=new Date(n.getTime()-a),s=new URLSearchParams;s.set("from",r.toISOString()),s.set("to",n.toISOString()),M&&s.set("city",M),D&&s.set("method",D),s.set("groupBy",I),s.set("format","json"),s.set("limit",String(T));let l=await fetch("".concat(o,"/admin/revenue/report?").concat(s),{headers:{Authorization:"Bearer ".concat(e)},cache:"no-store"});if(l.ok){let e=await l.json();U(Array.isArray(e.items)?e.items:[])}}em("day").then(z).catch(()=>z([])),em("city").then(W).catch(()=>W([])),em("method").then(q).catch(()=>q([])),N({from:c,to:v,city:M}).then(eu).catch(()=>eu(null)),y("city",{from:c,to:v,city:M,limit:T}).then(H).catch(()=>H([])),y("day",{from:c,to:v,city:M,limit:T}).then(V).catch(()=>V([]))}catch(e){Q((null==e?void 0:e.message)||"Error al cargar reporte")}finally{$(!1)}}async function em(e){let t=(0,l.oC)();if(!t)return[];let a=new URLSearchParams;c&&a.set("from",new Date(c).toISOString()),v&&a.set("to",new Date(v+"T23:59:59").toISOString()),M&&a.set("city",M),D&&a.set("method",D),a.set("groupBy",e),a.set("format","json"),a.set("limit",String(T));let n=await fetch("".concat(o,"/admin/revenue/report?").concat(a),{headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});if(!n.ok)return[];let r=await n.json();return Array.isArray(r.items)?r.items:[]}return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h2",{children:"Reportes"}),(0,n.jsxs)("div",{className:"row",style:{gap:8},children:[(0,n.jsx)("button",{className:"btn secondary",onClick:function(){let e=(0,l.oC)();if(!e){location.href="/login";return}let t=new URLSearchParams;c&&t.set("from",new Date(c).toISOString()),v&&t.set("to",new Date(v+"T23:59:59").toISOString()),M&&t.set("city",M),D&&t.set("method",D),t.set("groupBy",I),t.set("format","csv"),t.set("limit",String(T)),fetch("".concat(o,"/admin/revenue/report?").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.blob()).then(e=>{let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="revenue_".concat(I,"_").concat(new Date().toISOString().slice(0,10),".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}).catch(()=>alert("No se pudo descargar CSV"))},children:"Export CSV"}),(0,n.jsx)("button",{className:"btn",onClick:eh,disabled:X,children:X?"Cargando…":"Actualizar"})]})]}),(0,n.jsx)(f,{gmv:eo.gmv,count:eo.count,avg:eo.avg,tripSummary:ed||void 0}),(0,n.jsx)("div",{className:"card",style:{margin:"10px 0"},children:(0,n.jsxs)("div",{className:"row",style:{gap:16,flexWrap:"wrap"},children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Preset"}),(0,n.jsx)(S,{value:{from:c,to:v,city:M,method:D,groupBy:I,limit:T,compare:P},onLoad:e=>{g(e.from||""),k(e.to||""),C(e.city||""),R(e.method||""),A(e.groupBy||"city_method"),_(Number(e.limit||1e3)),B(!!e.compare)}})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Guardar preset"}),(0,n.jsx)("button",{className:"btn secondary",onClick:()=>(function(e){var t;let a=null===(t=prompt("Nombre del preset:"))||void 0===t?void 0:t.trim();if(!a)return;let n=b().filter(e=>e.name!==a);n.push({name:a,...e}),w(n),alert("Preset guardado")})({from:c,to:v,city:M,method:D,groupBy:I,limit:T,compare:P}),children:"Guardar"})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Rango r\xe1pido"}),(0,n.jsxs)("select",{value:"",onChange:e=>(function(e){let t,a;let n=e=>e.toString().padStart(2,"0"),r=e=>"".concat(e.getFullYear(),"-").concat(n(e.getMonth()+1),"-").concat(n(e.getDate())),s=new Date;if("today"===e)t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),a=new Date(s.getFullYear(),s.getMonth(),s.getDate());else if("7d"===e)(t=new Date(a=new Date(s.getFullYear(),s.getMonth(),s.getDate()))).setDate(a.getDate()-6);else if("30d"===e)(t=new Date(a=new Date(s.getFullYear(),s.getMonth(),s.getDate()))).setDate(a.getDate()-29);else if("this_month"===e)t=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0);else{if("prev_month"!==e)return;t=new Date(s.getFullYear(),s.getMonth()-1,1),a=new Date(s.getFullYear(),s.getMonth(),0)}g(r(t)),k(r(a))})(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Seleccionar…"}),(0,n.jsx)("option",{value:"today",children:"Hoy"}),(0,n.jsx)("option",{value:"7d",children:"\xdaltimos 7 d\xedas"}),(0,n.jsx)("option",{value:"30d",children:"\xdaltimos 30 d\xedas"}),(0,n.jsx)("option",{value:"this_month",children:"Este mes"}),(0,n.jsx)("option",{value:"prev_month",children:"Mes anterior"})]})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Desde"}),(0,n.jsx)("input",{type:"date",value:c,onChange:e=>g(e.target.value)})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Hasta"}),(0,n.jsx)("input",{type:"date",value:v,onChange:e=>k(e.target.value)})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Ciudad"}),(0,n.jsx)("input",{value:M,onChange:e=>C(e.target.value),placeholder:"Guayaquil"})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"M\xe9todo"}),(0,n.jsx)("input",{value:D,onChange:e=>R(e.target.value),placeholder:"CARD/CASH"})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"Grupo"}),(0,n.jsxs)("select",{value:I,onChange:e=>A(e.target.value),children:[(0,n.jsx)("option",{value:"city_method",children:"Ciudad + M\xe9todo"}),(0,n.jsx)("option",{value:"city",children:"Ciudad"}),(0,n.jsx)("option",{value:"method",children:"M\xe9todo"}),(0,n.jsx)("option",{value:"day",children:"D\xeda"}),(0,n.jsx)("option",{value:"city_day",children:"Ciudad + D\xeda"})]})]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("div",{className:"muted",children:"L\xedmite"}),(0,n.jsx)("input",{type:"number",value:T,onChange:e=>_(Number(e.target.value))})]}),(0,n.jsxs)("label",{className:"row",style:{gap:8},children:[(0,n.jsx)("input",{type:"checkbox",checked:P,onChange:e=>B(e.target.checked),disabled:!c||!v}),(0,n.jsx)("span",{className:"muted",children:"Comparar vs periodo anterior"})]})]})}),(0,n.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(f,{gmv:eo.gmv,count:eo.count,avg:eo.avg,prev:P?ec:void 0,tripSummary:ed||void 0}),(0,n.jsx)("button",{className:"btn secondary",onClick:()=>(function(){try{let e=document.getElementById("main_chart");if(!e)return;let t=new XMLSerializer().serializeToString(e),a=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(a),r=new Image;r.onload=()=>{let t=document.createElement("canvas");t.width=e.width.baseVal.value,t.height=e.height.baseVal.value;let a=t.getContext("2d");a.fillStyle="#0b0f17",a.fillRect(0,0,t.width,t.height),a.drawImage(r,0,0),URL.revokeObjectURL(n);let s=document.createElement("a");s.download="revenue_chart_".concat(new Date().toISOString().slice(0,19).replace(/[:T]/g,"-"),".png"),s.href=t.toDataURL("image/png"),s.click()},r.src=n}catch(e){}})(),"aria-label":"Exportar gr\xe1fico como PNG",children:"Export PNG"})]}),(0,n.jsx)(h,{series:et,prevSeries:P?ea:void 0,dims:ee,countTotals:en,prevCountTotals:P?er:void 0,exportableId:"main_chart"}),(0,n.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap",marginTop:12},children:[(0,n.jsxs)("div",{style:{flex:"1 1 380px",minWidth:320},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Por ciudad"})}),(0,n.jsx)(h,{series:el,dims:d("city")})]}),(0,n.jsxs)("div",{style:{flex:"1 1 380px",minWidth:320},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Por m\xe9todo"})}),(0,n.jsx)(j,{series:ei})]})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Evoluci\xf3n diaria"})}),(0,n.jsx)(h,{series:es,dims:d("day")})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Trips por ciudad (Completed vs Canceled)"})}),(0,n.jsx)(x,{items:G})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Trips por d\xeda (Completed vs Canceled)"})}),(0,n.jsx)(x,{items:J})]}),(0,n.jsxs)("table",{className:"table",style:{marginTop:12},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[ee.keys.map(e=>(0,n.jsx)("th",{children:e},e)),(0,n.jsx)("th",{children:"Count"}),(0,n.jsx)("th",{children:"Amount (USD)"})]})}),(0,n.jsx)("tbody",{children:O.map((e,t)=>(0,n.jsxs)("tr",{children:[ee.keys.map(t=>{var a;return(0,n.jsx)("td",{children:String(null!==(a=e[t])&&void 0!==a?a:"")},t)}),(0,n.jsx)("td",{className:"muted",children:Number(e.count||0)}),(0,n.jsxs)("td",{children:["$",Number(e.amountUsd||0).toFixed(2)]})]},t))})]})]})}function d(e){return"city"===e?{keys:["city"],primary:"city"}:"method"===e?{keys:["method"],primary:"method"}:"day"===e?{keys:["day"],primary:"day"}:"city_method"===e?{keys:["city","method"],primary:"city",secondary:"method"}:"city_day"===e?{keys:["city","day"],primary:"city",secondary:"day"}:{keys:[],primary:""}}function u(e,t){let a=new Map,n=new Set;for(let l of e){var r,s;let e=String(null!==(r=l[t.primary])&&void 0!==r?r:"—"),i=t.secondary?String(null!==(s=l[t.secondary])&&void 0!==s?s:"—"):"",o=t.secondary?"".concat(e,"__").concat(i):e;a.set(o,(a.get(o)||0)+Number(l.amountUsd||0)),t.secondary&&n.add(i)}let l=new Map;for(let[e,n]of a.entries())if(t.secondary){let[t,a]=e.split("__"),r=l.get(t)||{};r[a]=(r[a]||0)+n,l.set(t,r)}else l.set(e,{total:n});let i=Array.from(l.keys()),o=t.secondary?Array.from(n):["total"],c=i.map(e=>o.map(t=>{var a;return(null===(a=l.get(e))||void 0===a?void 0:a[t])||0}));return{labels:i,seriesKeys:o,data:c}}function h(e){let{series:t,prevSeries:a,dims:r,countTotals:s,prevCountTotals:l,exportableId:i}=e,o=function(e,t){if(!t||0===t.seriesKeys.length)return e;let a=Array.from(new Set([...e.labels,...t.labels])),n=[],r=a.map(()=>[]);for(let t of e.seriesKeys)n.push(t);for(let e of t.seriesKeys)n.push("".concat(e," (prev)"));let s=new Map(e.labels.map((e,t)=>[e,t])),l=new Map(t.labels.map((e,t)=>[e,t]));return a.forEach((a,n)=>{let i=s.get(a),o=l.get(a);for(let t=0;t<e.seriesKeys.length;t++)r[n][t]=null!=i?e.data[i][t]:0;for(let a=0;a<t.seriesKeys.length;a++)r[n][e.seriesKeys.length+a]=null!=o?t.data[o][a]:0}),{labels:a,seriesKeys:n,data:r}}(t,a),c=Math.max(640,60*o.labels.length),d=c-60-20,u=Math.max(1,...o.data.flat()),h=["#4f46e5","#22c55e","#eab308","#ef4444","#06b6d4","#a855f7"],m=d/Math.max(1,o.labels.length),x=Math.max(10,(m-10)/Math.max(1,o.seriesKeys.length));return(0,n.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[(0,n.jsx)("svg",{id:i,width:c,height:260,role:"img","aria-label":"Revenue chart",children:(0,n.jsxs)("g",{transform:"translate(".concat(60,",").concat(20,")"),children:[(0,n.jsx)("line",{x1:0,y1:0,x2:0,y2:180,stroke:"rgba(255,255,255,0.2)"}),(0,n.jsx)("line",{x1:0,y1:180,x2:d,y2:180,stroke:"rgba(255,255,255,0.2)"}),o.labels.map((e,t)=>{let a=t*m;return(0,n.jsxs)("g",{transform:"translate(".concat(a,",0)"),children:[o.seriesKeys.map((e,a)=>{let r=o.data[t][a]/u*170;return(0,n.jsx)("g",{children:(0,n.jsx)("rect",{x:a*x+4*a,y:180-r,width:x,height:r,fill:h[a%h.length],rx:3})},a)}),(0,n.jsx)("text",{x:m/2,y:194,textAnchor:"middle",fontSize:"10",fill:"#9aa4b2",children:e})]},t)}),s&&s.labels.length>0&&(0,n.jsxs)(n.Fragment,{children:[g(s,m,180,u,"#93c5fd"),l&&g(l,m,180,u,"#fda4af",2)]}),[0,.25,.5,.75,1].map((e,t)=>{let a=u*e,r=180-170*e;return(0,n.jsxs)("g",{children:[(0,n.jsx)("line",{x1:0,y1:r,x2:d,y2:r,stroke:"rgba(255,255,255,0.08)"}),(0,n.jsxs)("text",{x:-8,y:r,textAnchor:"end",alignmentBaseline:"middle",fontSize:"10",fill:"#9aa4b2",children:["$",a.toFixed(0)]})]},t)})]})}),(0,n.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[o.seriesKeys.map((e,t)=>(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:12,background:h[t%h.length],borderRadius:2,display:"inline-block"}}),(0,n.jsx)("span",{className:"muted",children:e})]},t)),s&&s.labels.length>0&&(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:2,background:"#93c5fd",display:"inline-block",alignSelf:"center"}}),(0,n.jsx)("span",{className:"muted",children:"Count"})]}),l&&l.labels.length>0&&(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:2,background:"#fda4af",display:"inline-block",alignSelf:"center"}}),(0,n.jsx)("span",{className:"muted",children:"Count (prev)"})]})]})]})}function m(e,t){let a=new Map;for(let r of e){var n;let e=String(null!==(n=r[t.primary])&&void 0!==n?n:"—");a.set(e,(a.get(e)||0)+Number(r.count||0))}let r=Array.from(a.keys()),s=r.map(e=>a.get(e)||0);return{labels:r,data:s}}function g(e,t,a,r,s){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=[];for(let n=0;n<e.labels.length;n++){let s=n*t+t/2,l=e.data[n]||0,o=a-(r>0?l/r*(a-10):0);i.push("".concat(s,",").concat(o))}return(0,n.jsx)("polyline",{fill:"none",stroke:s,strokeWidth:2,strokeDasharray:l?"".concat(l,",").concat(l):void 0,points:i.join(" ")})}function x(e){let{items:t}=e,a=Math.max(640,60*((null==t?void 0:t.length)||0)),r=a-60-20,s=t.map(e=>e.key),l=Math.max(1,...t.map(e=>e.total||0)),i=r/Math.max(1,s.length),o="#22c55e",c="#ef4444";return(0,n.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[(0,n.jsx)("svg",{width:a,height:240,role:"img","aria-label":"Trips counts",children:(0,n.jsxs)("g",{transform:"translate(".concat(60,",").concat(20,")"),children:[(0,n.jsx)("line",{x1:0,y1:0,x2:0,y2:160,stroke:"rgba(255,255,255,0.2)"}),(0,n.jsx)("line",{x1:0,y1:160,x2:r,y2:160,stroke:"rgba(255,255,255,0.2)"}),t.map((e,t)=>{let a=t*i,r=Number(e.completed||0)/l*150,s=Number(e.canceled||0)/l*150,d=160-r;return(0,n.jsxs)("g",{transform:"translate(".concat(a,",0)"),children:[(0,n.jsx)("rect",{x:10,y:d-s,width:i-20,height:s,fill:c,rx:3}),(0,n.jsx)("rect",{x:10,y:d,width:i-20,height:r,fill:o,rx:3}),(0,n.jsx)("text",{x:i/2,y:174,textAnchor:"middle",fontSize:"10",fill:"#9aa4b2",children:e.key})]},t)}),[0,.25,.5,.75,1].map((e,t)=>{let a=160-150*e;return(0,n.jsxs)("g",{children:[(0,n.jsx)("line",{x1:0,y1:a,x2:r,y2:a,stroke:"rgba(255,255,255,0.08)"}),(0,n.jsx)("text",{x:-8,y:a,textAnchor:"end",alignmentBaseline:"middle",fontSize:"10",fill:"#9aa4b2",children:Math.round(l*e)})]},t)})]})}),(0,n.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:12,background:o,borderRadius:2,display:"inline-block"}}),(0,n.jsx)("span",{className:"muted",children:"Completed"})]}),(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:12,background:c,borderRadius:2,display:"inline-block"}}),(0,n.jsx)("span",{className:"muted",children:"Canceled"})]})]})]})}async function y(e,t){let a=(0,l.oC)();if(!a)return[];let n=new URLSearchParams;t.from&&n.set("from",new Date(t.from).toISOString()),t.to&&n.set("to",new Date(t.to+"T23:59:59").toISOString()),t.city&&n.set("city",t.city),n.set("groupBy",e),n.set("limit",String(t.limit));let r=await fetch("".concat(o,"/admin/analytics/trips?").concat(n),{headers:{Authorization:"Bearer ".concat(a)},cache:"no-store"});if(!r.ok)return[];let s=await r.json();return Array.isArray(s.items)?s.items:[]}function p(e){let t=e.reduce((e,t)=>e+Number(t.amountUsd||0),0),a=e.reduce((e,t)=>e+Number(t.count||0),0);return{gmv:t,count:a,avg:a>0?t/a:0}}function f(e){let{gmv:t,count:a,avg:r,prev:s,tripSummary:l}=e,i=e=>"$".concat(e.toFixed(2)),o=(e,t)=>{if(null==t||!isFinite(t)||0===t)return null;let a=e-t,r=a>0,s=0===a;return(0,n.jsxs)("span",{style:{color:s?"#9aa4b2":r?"#22c55e":"#ef4444",marginLeft:6,fontSize:12},children:[s?"•":r?"▲":"▼"," ",Math.abs(0!==t?a/t*100:0).toFixed(1),"%"]})},c=(e,t,a)=>(0,n.jsxs)("div",{className:"card",style:{padding:"12px 16px",flex:"1 1 160px"},children:[(0,n.jsx)("div",{className:"muted",style:{marginBottom:6},children:e}),(0,n.jsxs)("div",{style:{fontSize:22,fontWeight:600,display:"flex",alignItems:"center"},children:[t,a]})]});return(0,n.jsxs)("div",{className:"row",style:{gap:12,flexWrap:"wrap",marginTop:10},children:[c("GMV (USD)",i(t),o(t,null==s?void 0:s.gmv)),c("Pagos (PAID)",String(a),o(a,null==s?void 0:s.count)),c("Ticket promedio",i(r),o(r,null==s?void 0:s.avg)),l?c("Cancel rate","".concat((100*l.cancelRate).toFixed(1),"%")):null,l?c("Completion rate","".concat((100*l.completionRate).toFixed(1),"%")):null]})}function j(e){let{series:t}=e,a=t.data.flat().reduce((e,t)=>e+t,0),r=["#4f46e5","#22c55e","#eab308","#ef4444","#06b6d4","#a855f7"],s=0,l=t.labels.map((e,n)=>{let l=t.data[n][0]||0,i=a>0?l/a*Math.PI*2:0,o=s,c=s+i;s=c;let d=100+70*Math.cos(o),u=100+70*Math.sin(o),h=100+70*Math.cos(c),m=100+70*Math.sin(c);return{d:"M ".concat(100," ").concat(100," L ").concat(d," ").concat(u," A ").concat(70," ").concat(70," 0 ").concat(i>Math.PI?1:0," 1 ").concat(h," ").concat(m," Z"),color:r[n%r.length],label:e,val:l}});return(0,n.jsxs)("div",{className:"card",style:{display:"flex",gap:12,alignItems:"center"},children:[(0,n.jsx)("svg",{width:220,height:220,viewBox:"0 0 ".concat(200," ").concat(200),children:l.map((e,t)=>(0,n.jsx)("path",{d:e.d,fill:e.color},t))}),(0,n.jsx)("div",{children:t.labels.map((e,t)=>(0,n.jsxs)("div",{className:"row",style:{gap:6},children:[(0,n.jsx)("span",{style:{width:12,height:12,background:r[t%r.length],borderRadius:2,display:"inline-block"}}),(0,n.jsx)("span",{className:"muted",children:e})]},t))})]})}let v="reports_presets";function b(){try{return JSON.parse(localStorage.getItem(v)||"[]")}catch(e){return[]}}function w(e){localStorage.setItem(v,JSON.stringify(e))}function S(e){let{value:t,onLoad:a}=e,[s,l]=(0,r.useState)([]);(0,r.useEffect)(()=>{l(b())},[]);let[i,o]=(0,r.useState)("");return(0,n.jsxs)("div",{className:"row",style:{gap:8},children:[(0,n.jsxs)("select",{value:i,onChange:e=>o(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Seleccionar…"}),s.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,n.jsx)("button",{className:"btn secondary",onClick:()=>{let e=s.find(e=>e.name===i);e&&a(e)},children:"Cargar"}),(0,n.jsx)("button",{className:"btn secondary",onClick:()=>{if(!i)return;let e=s.filter(e=>e.name!==i);w(e),l(e),o("")},children:"Eliminar"})]})}async function N(e){let t=(0,l.oC)();if(!t)return{total:0,completed:0,canceled:0,completionRate:0,cancelRate:0};let a=new URLSearchParams;e.from&&a.set("from",new Date(e.from).toISOString()),e.to&&a.set("to",new Date(e.to+"T23:59:59").toISOString()),e.city&&a.set("city",e.city);let n=await fetch("".concat(o,"/admin/analytics/trips?").concat(a),{headers:{Authorization:"Bearer ".concat(t)},cache:"no-store"});return n.ok?n.json():{total:0,completed:0,canceled:0,completionRate:0,cancelRate:0}}},21:function(e,t,a){"use strict";a.d(t,{ik:function(){return s},qM:function(){return r}});var n=a(7437);function r(e){let{height:t=16,width:a="100%",style:r,className:s}=e;return(0,n.jsx)("div",{className:s,style:{height:t,width:a,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...r}})}function s(e){let{lines:t=3}=e;return(0,n.jsx)("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:t}).map((e,t)=>(0,n.jsx)(r,{height:12,width:"".concat(80-8*t,"%")},t))})}if(a(2265),!document.getElementById("sk-keyframes")){let e=document.createElement("style");e.id="sk-keyframes",e.innerHTML="@keyframes skeleton { 0%{background-position:100% 50%} 100%{background-position:0 50%} }",document.head.appendChild(e)}},4282:function(e,t,a){"use strict";a.d(t,{DH:function(){return o},J1:function(){return l},PR:function(){return i},oC:function(){return c}});var n=a(6300).Buffer;let r="taxi_token",s="taxi_user";function l(e,t){localStorage.setItem(r,e),localStorage.setItem(s,JSON.stringify(t))}function i(){let e=localStorage.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function o(){localStorage.removeItem(r),localStorage.removeItem(s)}function c(){let e=localStorage.getItem(r);return e?!function(e){let t=function(e){let t=e.split(".");if(3!==t.length)return null;try{let e=function(e){try{let t=e.length%4==2?"==":e.length%4==3?"=":e.length%4==1?"===":"",a=e.replace(/-/g,"+").replace(/_/g,"/")+t;if("function"==typeof atob)return atob(a);return n.from(a,"base64").toString("binary")}catch(e){return""}}(t[1]);return JSON.parse(e)}catch(e){return null}}(e);return null!=t&&!!t.exp&&Math.floor(Date.now()/1e3)>=t.exp}(e)?e:(o(),null):null}}},function(e){e.O(0,[300,971,23,744],function(){return e(e.s=7144)}),_N_E=e.O()}]);