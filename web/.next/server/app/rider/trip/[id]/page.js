(()=>{var e={};e.id=586,e.ids=[586],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3608:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>s.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>o});var t=r(3191),n=r(8716),i=r(7922),s=r.n(i),l=r(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);r.d(a,c);let o=["",{children:["rider",{children:["trip",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6271)),"/app/src/app/rider/trip/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/app/src/app/rider/trip/[id]/page.tsx"],u="/rider/trip/[id]/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/rider/trip/[id]/page",pathname:"/rider/trip/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4818:(e,a,r)=>{Promise.resolve().then(r.bind(r,6753))},5047:(e,a,r)=>{"use strict";var t=r(7389);r.o(t,"useParams")&&r.d(a,{useParams:function(){return t.useParams}}),r.o(t,"useRouter")&&r.d(a,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(a,{useSearchParams:function(){return t.useSearchParams}})},6753:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>d});var t=r(326),n=r(7577),i=r(5047),s=r(6208),l=r(6836),c=r(8145),o=r(2326);function d(){var e;let{show:a}=(0,c.p)(),r=(0,i.useParams)(),s=r?.id||"",[d,m]=(0,n.useState)(null),[x,f]=(0,n.useState)(null),[j,v]=(0,n.useState)(null),[b,y]=(0,n.useState)(null),[N,S]=(0,n.useState)(null);if((0,n.useRef)(null),!s)return t.jsx("div",{children:"Sin id"});if(b)return t.jsx("div",{style:{color:"var(--danger)"},children:b});if(!d)return(0,t.jsxs)("div",{children:[t.jsx("h2",{children:"Mi viaje"}),t.jsx(o.ik,{lines:2}),t.jsx("div",{style:{marginTop:10},children:t.jsx(o.qM,{height:360})}),(0,t.jsxs)("div",{className:"row",style:{gap:8,marginTop:10},children:[t.jsx(o.qM,{height:32,width:140}),t.jsx(o.qM,{height:32,width:120})]})]});let C=d.pickupLat&&d.pickupLng?{lat:Number(d.pickupLat),lng:Number(d.pickupLng)}:null,E=d.dropoffLat&&d.dropoffLng?{lat:Number(d.dropoffLat),lng:Number(d.dropoffLng)}:null,P=x&&null!=x.lat&&null!=x.lng?{lat:Number(x.lat),lng:Number(x.lng)}:void 0;return(0,t.jsxs)("div",{children:[t.jsx("h2",{children:"Mi viaje"}),(0,t.jsxs)("div",{className:"muted",children:["ID: ",d.id]}),(0,t.jsxs)("div",{className:"muted",children:["Estado: ",d.status]}),t.jsx(h,{status:d.status}),N&&t.jsx("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:6},children:"number"==typeof N.graceRemainingSec&&N.graceRemainingSec>0?(0,t.jsxs)("div",{className:"card",style:{padding:"4px 8px"},children:["Ventana de gracia: ",(e=N.graceRemainingSec,`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`)]}):t.jsx("div",{className:"muted",children:N.feeUsd>0?`Tarifa de cancelaci\xf3n estimada: $${N.feeUsd.toFixed(2)}`:"Cancelaci\xf3n sin tarifa"})}),t.jsx(g,{trip:d,driverLoc:x}),t.jsx("div",{style:{marginTop:10},children:t.jsx(l.Z,{origin:C,destination:E,driver:P,height:360,controls:!0})}),(0,t.jsxs)("div",{style:{marginTop:10},children:["STARTED"!==d.status&&"COMPLETED"!==d.status&&"CANCELED"!==d.status&&t.jsx("button",{className:"btn danger","aria-label":"Cancelar viaje",onClick:()=>p(d,s,a,m),children:"Cancelar viaje"}),t.jsx("button",{className:"btn secondary","aria-label":"Ver recibo",onClick:async()=>{await u(s,v),j||a("Recibo cargado","success")},style:{marginLeft:8},children:"Ver recibo"}),j&&(0,t.jsxs)("div",{className:"card",style:{marginTop:8},children:[(0,t.jsxs)("div",{className:"muted",children:["Monto: $",Number(j.amountUsd||0).toFixed(2)," ",j.currency||"USD"]}),(0,t.jsxs)("div",{className:"muted",children:["Pago: ",j.status||"-"," ",j.method?`• ${j.method}`:""]}),(0,t.jsxs)("div",{className:"muted",children:["Fecha: ",new Date(j.createdAt).toLocaleString()]})]})]})]})}async function u(e,a){try{let r=(0,s.oC)();if(!r)return;let t=await fetch(`http://localhost:8081/payments/${encodeURIComponent(e)}/receipt`,{headers:{Authorization:`Bearer ${r}`},cache:"no-store"});if(!t.ok)return;let n=await t.json();a(n)}catch{}}async function p(e,a,r,t){try{let e=(0,s.oC)();if(!e)return;let n=await fetch(`http://localhost:8081/rider/trips/${encodeURIComponent(a)}/cancel/quote`,{headers:{Authorization:`Bearer ${e}`},cache:"no-store"}),i="\xbfCancelar el viaje?";if(n.ok){let e=await n.json();e&&e.cancellable?e.feeUsd&&e.feeUsd>0?i=`Se aplicar\xe1 una tarifa de cancelaci\xf3n de $${Number(e.feeUsd).toFixed(2)}. \xbfDeseas cancelar?`:"number"==typeof e.graceRemainingSec&&e.graceRemainingSec>0&&(i=`A\xfan dentro de la ventana de gracia (${e.graceRemainingSec}s). No se cobrar\xe1 tarifa. \xbfCancelar?`):i="Este viaje ya no puede cancelarse."}if(!confirm(i))return;m(a,r,t)}catch{if(!confirm("\xbfCancelar el viaje?"))return;m(a,r,t)}}async function m(e,a,r){try{let t=(0,s.oC)();if(!t)return;let n=await fetch(`http://localhost:8081/trips/${encodeURIComponent(e)}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({reason:"DEMO"})});if(!n.ok){a("No se pudo cancelar","error");return}let i=await n.json();r(e=>e?{...e,status:i?.trip?.status||"CANCELED"}:e),a("Viaje cancelado","success")}catch{a("No se pudo cancelar","error")}}function g({trip:e,driverLoc:a}){let r=(e,a)=>{if(!e||!a||null==e.lat||null==e.lng||null==a.lat||null==a.lng)return null;let r=n(a.lat-e.lat),t=n(a.lng-e.lng),i=Math.sin(r/2)**2+Math.cos(n(e.lat))*Math.cos(n(a.lat))*Math.sin(t/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},n=e=>e*Math.PI/180,i=e.pickupLat&&e.pickupLng?{lat:Number(e.pickupLat),lng:Number(e.pickupLng)}:null,s=e.dropoffLat&&e.dropoffLng?{lat:Number(e.dropoffLat),lng:Number(e.dropoffLng)}:null,l=a&&i?r(a,i):null,c=i&&s?r(i,s):null,o=e=>null==e?null:Math.round(e/28*60);return(0,t.jsxs)("div",{className:"muted",style:{marginTop:6},children:[null!=l&&(0,t.jsxs)("span",{children:["Distancia a recogida: ",l.toFixed(2)," km • ETA ~",o(l)," min. "]}),null!=c&&(0,t.jsxs)("span",{children:["Trayecto estimado: ",c.toFixed(2)," km • ~",o(c)," min."]})]})}function h({status:e}){let a=["REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED","COMPLETED"],r=a.indexOf(e);return(0,t.jsxs)("div",{className:"row",style:{gap:6,marginTop:6,flexWrap:"wrap",alignItems:"center"},children:[a.map((e,n)=>(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("div",{className:"card",style:{padding:"4px 8px",background:n<=r?"var(--brand-weak)":void 0},children:e}),n<a.length-1&&t.jsx("span",{style:{margin:"0 4px"},children:"›"})]},e)),"CANCELED"===e&&t.jsx("div",{className:"card",style:{padding:"4px 8px",background:"var(--danger-weak)",color:"var(--danger)"},children:"CANCELED"})]})}},2326:(e,a,r)=>{"use strict";r.d(a,{ik:()=>i,qM:()=>n});var t=r(326);function n({height:e=16,width:a="100%",style:r,className:n}){return t.jsx("div",{className:n,style:{height:e,width:a,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...r}})}function i({lines:e=3}){return t.jsx("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:e}).map((e,a)=>t.jsx(n,{height:12,width:`${80-8*a}%`},a))})}r(7577)},6271:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>t});let t=(0,r(8570).createProxy)(String.raw`/app/src/app/rider/trip/[id]/page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[555,791],()=>r(3608));module.exports=t})();