(()=>{var e={};e.id=805,e.ids=[805],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4558:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>a.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>o});var r=t(3191),i=t(8716),n=t(7922),a=t.n(n),l=t(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let o=["",{children:["admin",{children:["ops",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,5127)),"/app/src/app/admin/ops/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/admin/ops/page.tsx"],u="/admin/ops/page",h={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/ops/page",pathname:"/admin/ops",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},9189:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},4047:(e,s,t)=>{Promise.resolve().then(t.bind(t,933)),Promise.resolve().then(t.bind(t,6618)),Promise.resolve().then(t.bind(t,8482))},3757:(e,s,t)=>{Promise.resolve().then(t.bind(t,5198))},5047:(e,s,t)=>{"use strict";var r=t(7389);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},5198:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var r=t(326),i=t(7577),n=t.n(i),a=t(5047);function l(e){let{trips:s,drivers:t,height:i=520,onSelect:a,selected:l,follow:d,center:o,bounds:c}=e,u=n().useRef(null);return n().useRef(null),n().useRef([]),n().useRef(new Map),n().useRef(null),n().useRef(null),r.jsx("div",{ref:u,style:{height:i}})}var d=t(8069),o=t(2326),c=t(6208);function u(){(0,a.useRouter)(),(0,a.useSearchParams)(),(0,i.useRef)(!1);let[e,s]=(0,i.useState)([]),[t,n]=(0,i.useState)(!0),[u,f]=(0,i.useState)(null),[j,g]=(0,i.useState)(!0),[y,v]=(0,i.useState)(!0),[b,N]=(0,i.useState)(""),[w,S]=(0,i.useState)([]),[C,D]=(0,i.useState)(null),[P,k]=(0,i.useState)(null),[T,E]=(0,i.useState)(!0),[R,I]=(0,i.useState)(["REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED"]),[A,L]=(0,i.useState)(["IDLE","ON_TRIP","ASSIGNED","ARRIVED"]),[$,_]=(0,i.useState)(null),[M,O]=(0,i.useState)([]),[z,G]=(0,i.useState)(null),[q,B]=(0,i.useState)(""),[W,H]=(0,i.useState)(!1),U=(0,i.useMemo)(()=>{let s=(q||"").trim().toLowerCase();return!s||s.length<2?[]:[...e.filter(e=>(e.id||"").toLowerCase().includes(s)).slice(0,50).map(e=>({type:"trip",id:e.id,label:`Trip ${e.id}`})),...w.filter(e=>(e.id||"").toLowerCase().includes(s)).slice(0,50).map(e=>({type:"driver",id:e.id,label:`Driver ${e.id}`}))].slice(0,50)},[q,JSON.stringify(e),JSON.stringify(w)]),V=(0,i.useMemo)(()=>e.filter(e=>"COMPLETED"!==e.status&&"CANCELED"!==e.status&&(!b||(e.city||"").toLowerCase()===b.toLowerCase())&&(0===R.length||R.includes(e.status))),[e,b,R]),J=V.map(e=>({id:e.id,origin:e?.origin&&"number"==typeof e.origin.lat&&"number"==typeof e.origin.lng?{lat:e.origin.lat,lng:e.origin.lng}:e?.pickupLat!=null&&e?.pickupLng!=null?{lat:Number(e.pickupLat),lng:Number(e.pickupLng)}:null,destination:e?.destination&&"number"==typeof e.destination.lat&&"number"==typeof e.destination.lng?{lat:e.destination.lat,lng:e.destination.lng}:e?.dropoffLat!=null&&e?.dropoffLng!=null?{lat:Number(e.dropoffLat),lng:Number(e.dropoffLng)}:null})),F=w.filter(e=>0===A.length||!e.status||A.includes(e.status)).map(e=>({id:e.id,pos:null!=e.lat&&null!=e.lng?{lat:e.lat,lng:e.lng}:null,status:e.status})),Q=(e,s)=>{D({type:e,id:s}),E(!0)};function K(){try{let s=String(q||"").trim();if(!s)return;if(s.startsWith("trp_")){let t=e.find(e=>e.id===s);if(t){Q("trip",t.id);return}}if(s.startsWith("drv_")){let e=w.find(e=>e.id===s);if(e){Q("driver",e.id);return}}let t=e.find(e=>e.id===s);if(t){Q("trip",t.id);return}let r=w.find(e=>e.id===s);if(r){Q("driver",r.id);return}}catch{}}return t?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"card",style:{marginBottom:10},children:[r.jsx("strong",{children:"Operaciones"}),r.jsx("div",{style:{marginTop:8},children:r.jsx(o.ik,{lines:2})})]}),r.jsx(o.qM,{height:520})]}):u?r.jsx("div",{style:{color:"var(--danger)"},children:u}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"muted",style:{marginBottom:6},children:["Ayuda: ",r.jsx("a",{href:"/admin/readme",children:"/admin/readme"})]}),(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[r.jsx("h2",{children:"Operaciones"}),(0,r.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[r.jsx("span",{className:"muted",children:"Ciudad"}),r.jsx("input",{list:"ops-cities",value:b,onChange:e=>N(e.target.value),placeholder:"Guayaquil"}),r.jsx("datalist",{id:"ops-cities",children:M.map(e=>r.jsx("option",{value:e.name},e.key))})]}),r.jsx("button",{className:"btn secondary",onClick:()=>(function(e,s,t,r){if(!s)return;let i=s.trim().toLowerCase(),n=t.find(e=>e.key.toLowerCase()===i||e.name.toLowerCase()===i);n&&(n.bounds&&r?(r(n.bounds),e(null)):(r&&r(null),e({...n.center,zoom:n.zoom})))})(_,b,M,G),children:"Centrar ciudad"}),r.jsx(p,{value:R,onChange:I}),r.jsx(x,{value:A,onChange:L}),(0,r.jsxs)("button",{className:"btn secondary",onClick:()=>g(e=>!e),children:[j?"Pausar":"Reanudar"," auto"]}),r.jsx("button",{className:"btn secondary",onClick:()=>v(e=>!e),children:y?"Usar polling":"Usar SSE"}),(0,r.jsxs)("label",{className:"row",style:{gap:8},children:[r.jsx("input",{type:"checkbox",checked:T,onChange:e=>E(e.target.checked)}),r.jsx("span",{className:"muted",children:"Seguir seleccionado"})]}),r.jsx("a",{className:"btn secondary",href:"/admin/ops/cities",children:"Administrar ciudades"})]})]}),r.jsx("div",{className:"card",style:{marginTop:8},children:(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-start"},children:[(0,r.jsxs)("label",{style:{position:"relative"},children:[r.jsx("div",{className:"muted",children:"Buscar ID (trip o driver)"}),r.jsx("input",{"aria-label":"Buscar ID (trip o driver)",placeholder:"trp_... o drv_...",list:"ops-ids",value:q,onChange:e=>{B(e.target.value),H(!0)},onFocus:()=>H(!0),onBlur:()=>setTimeout(()=>H(!1),150),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),K())},style:{minWidth:280}}),(0,r.jsxs)("datalist",{id:"ops-ids",children:[e.slice(0,200).map(e=>r.jsx("option",{value:e.id,children:`Trip ${e.id}`},e.id)),w.slice(0,200).map(e=>r.jsx("option",{value:e.id,children:`Driver ${e.id}`},e.id))]}),W&&U.length>0&&r.jsx("ul",{style:{position:"absolute",top:"100%",left:0,right:0,zIndex:5,background:"var(--surface)",border:"1px solid rgba(255,255,255,0.1)",maxHeight:220,overflowY:"auto",listStyle:"none",margin:0,padding:0},children:U.map(e=>r.jsx("li",{children:r.jsx("button",{type:"button",onClick:()=>{B(e.id),Q(e.type,e.id),H(!1)},className:"btn secondary",style:{display:"block",width:"100%",textAlign:"left",borderRadius:0},children:e.label})},`${e.type}-${e.id}`))})]}),r.jsx("button",{className:"btn",onClick:()=>{K(),H(!1)},"aria-label":"Seleccionar en mapa",children:"Seleccionar"})]})}),(0,r.jsxs)("div",{className:"card",style:{padding:0,marginTop:10,display:"flex",gap:12},children:[r.jsx("div",{style:{flex:"1 1 auto"},children:r.jsx(l,{trips:J,drivers:F,onSelect:e=>D(e),selected:C,follow:T,center:$,bounds:z})}),r.jsx(m,{selected:C,trips:e,drivers:w,onClose:()=>{D(null),k(null)},onNeedTripDetail:async e=>{let s=(0,c.oC)();s&&k(await (0,d.j)(`/trips/${encodeURIComponent(e)}`,{},s))}})]}),(0,r.jsxs)("div",{className:"row",style:{gap:16,marginTop:10,flexWrap:"wrap"},children:[(0,r.jsxs)("div",{className:"card",style:{flex:"1 1 300px"},children:[r.jsx("strong",{children:"Activos"}),(0,r.jsxs)("div",{className:"muted",children:["Trips activos: ",V.length]}),(0,r.jsxs)("div",{className:"muted",children:["Drivers activos: ",w.length]}),(0,r.jsxs)("div",{className:"row",style:{gap:10,marginTop:8,flexWrap:"wrap"},children:[r.jsx(h,{color:"#22c55e",label:"Origen"}),r.jsx(h,{color:"#ef4444",label:"Destino"}),r.jsx(h,{color:"#4f46e5",label:"Driver ON_TRIP",dot:!0}),r.jsx(h,{color:"#9aa4b2",label:"Driver IDLE",dot:!0})]})]}),(0,r.jsxs)("div",{className:"card",style:{flex:"2 1 480px"},children:[r.jsx("strong",{children:"\xdaltimos trips activos"}),(0,r.jsxs)("table",{className:"table",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"ID"}),r.jsx("th",{children:"Status"}),r.jsx("th",{children:"Ciudad"}),r.jsx("th",{children:"Driver"})]})}),r.jsx("tbody",{children:V.slice(0,10).map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{children:e.id}),r.jsx("td",{children:e.status}),r.jsx("td",{className:"muted",children:e.city||"-"}),r.jsx("td",{className:"muted",children:e.driverId||"-"})]},e.id))})]})]})]})]})}function h({color:e,label:s,dot:t}){return(0,r.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[r.jsx("span",{style:{width:t?12:16,height:t?12:10,background:e,borderRadius:t?"50%":2,display:"inline-block"}}),r.jsx("span",{className:"muted",children:s})]})}function m({selected:e,trips:s,drivers:t,onClose:i,onNeedTripDetail:n}){if(!e)return r.jsx("div",{style:{width:320}});let a={width:320,borderLeft:"1px solid rgba(255,255,255,0.1)",padding:12};if("trip"===e.type){let t=s.find(s=>s.id===e.id);return(0,r.jsxs)("div",{style:a,children:[(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[r.jsx("strong",{children:"Trip"}),r.jsx("button",{className:"btn secondary",onClick:i,children:"Cerrar"})]}),r.jsx("div",{className:"muted",style:{marginTop:6},children:t?.id}),(0,r.jsxs)("div",{className:"muted",children:["Status: ",t?.status||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Ciudad: ",t?.city||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Driver: ",t?.driverId||"-"]}),(0,r.jsxs)("div",{style:{marginTop:8},children:[r.jsx("a",{className:"btn",href:`/admin/trips/${e.id}`,children:"Abrir detalle"}),r.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:()=>n(e.id),children:"Refrescar"})]})]})}{let s=t.find(s=>s.id===e.id);return(0,r.jsxs)("div",{style:a,children:[(0,r.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[r.jsx("strong",{children:"Driver"}),r.jsx("button",{className:"btn secondary",onClick:i,children:"Cerrar"})]}),r.jsx("div",{className:"muted",style:{marginTop:6},children:s?.id}),(0,r.jsxs)("div",{className:"muted",children:["Status: ",s?.status||"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Ubicaci\xf3n: ",s?.lat??"-",", ",s?.lng??"-"]}),(0,r.jsxs)("div",{className:"muted",children:["Actualizado: ",s?.at?new Date(s.at).toLocaleString():"-"]})]})}}function p({value:e,onChange:s}){let t=t=>s(e.includes(t)?e.filter(e=>e!==t):e.concat(t));return(0,r.jsxs)("div",{className:"row",style:{gap:6},children:[r.jsx("span",{className:"muted",children:"Trip"}),["REQUESTED","ASSIGNED","ACCEPTED","ARRIVED","STARTED"].map(s=>(0,r.jsxs)("label",{className:"row",style:{gap:4},children:[r.jsx("input",{type:"checkbox",checked:e.includes(s),onChange:()=>t(s)}),r.jsx("span",{className:"muted",style:{fontSize:12},children:s})]},s))]})}function x({value:e,onChange:s}){let t=t=>s(e.includes(t)?e.filter(e=>e!==t):e.concat(t));return(0,r.jsxs)("div",{className:"row",style:{gap:6},children:[r.jsx("span",{className:"muted",children:"Driver"}),["IDLE","ON_TRIP","ASSIGNED","ARRIVED"].map(s=>(0,r.jsxs)("label",{className:"row",style:{gap:4},children:[r.jsx("input",{type:"checkbox",checked:e.includes(s),onChange:()=>t(s)}),r.jsx("span",{className:"muted",style:{fontSize:12},children:s})]},s))]})}},8482:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var r=t(326),i=t(7577),n=t.n(i),a=t(434),l=t(6208);let d="http://localhost:8081";function o(){let[e,s]=(0,i.useState)(()=>!1),[t,n]=(0,i.useState)(!1),[a,o]=(0,i.useState)(null);async function c(){n(!0),o(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let s=await fetch(`${d}/admin/demo/seed`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!s.ok)throw Error(`Seed HTTP ${s.status}`);o("Demo iniciada")}catch(e){o(e?.message||"Error en seed")}finally{n(!1)}}async function u(){n(!0),o(null);try{let e=(0,l.oC)();if(!e)throw Error("Inicia sesi\xf3n");let s=await fetch(`${d}/admin/demo/reset`,{method:"POST",headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(!s.ok)throw Error(`Reset HTTP ${s.status}`);o("Demo reseteada")}catch(e){o(e?.message||"Error en reset")}finally{n(!1)}}async function h(){let t=!e;s(t),t?await c():await u()}return(0,r.jsxs)("div",{style:{background:e?"#0b4":"#444",color:"white",padding:"6px 12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[r.jsx("strong",{children:"Modo Demo"}),r.jsx("span",{className:"muted",children:e?"activo":"inactivo"}),a&&r.jsx("span",{style:{opacity:.8},children:a})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8},children:[r.jsx("button",{className:"btn secondary",onClick:h,disabled:t,children:e?"Detener":"Iniciar"}),e&&r.jsx("button",{className:"btn secondary",onClick:u,disabled:t,children:"Reset ahora"})]})]})}function c(){let[e,s]=(0,i.useState)(""),[t,n]=(0,i.useState)("");if(!e)return null;let a=t?` ${t.toLowerCase()}`:"";return(0,r.jsxs)("span",{className:"muted",style:{marginLeft:12},children:["v",e,a?` (${a})`:""]})}var u=t(8145);function h({children:e}){return(0,r.jsxs)(r.Fragment,{children:[r.jsx(o,{}),(0,r.jsxs)("header",{className:"container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{className:"row",children:[r.jsx("strong",{children:"Taxi App"}),(0,r.jsxs)("nav",{className:"row",style:{gap:16},children:[r.jsx(a.default,{href:"/",children:"Inicio"}),r.jsx(a.default,{href:"/admin/trips",children:"Trips"}),r.jsx(a.default,{href:"/admin/tariffs",children:"Tarifas"}),r.jsx(a.default,{href:"/admin/simulator",children:"Simulador"}),r.jsx(a.default,{href:"/admin/reports",children:"Reportes"}),r.jsx(a.default,{href:"/admin/ops",children:"Operaciones"})]})]}),r.jsx(m,{})]}),r.jsx(u.V,{children:r.jsx("main",{className:"container",children:e})}),(0,r.jsxs)("footer",{className:"container",style:{marginTop:24,paddingBottom:24,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[r.jsx(a.default,{href:"/admin/readme",children:"Gu\xeda de Demo"}),r.jsx(c,{})]})]})}function m(){let[e,s]=n().useState(()=>(0,l.PR)());return e?(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("span",{className:"muted",children:[e.email," (",e.role,")"]}),r.jsx("button",{className:"btn secondary",onClick:()=>{(0,l.DH)(),location.href="/login"},children:"Salir"})]}):r.jsx(a.default,{className:"btn secondary",href:"/login",children:"Ingresar"})}},2326:(e,s,t)=>{"use strict";t.d(s,{ik:()=>n,qM:()=>i});var r=t(326);function i({height:e=16,width:s="100%",style:t,className:i}){return r.jsx("div",{className:i,style:{height:e,width:s,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...t}})}function n({lines:e=3}){return r.jsx("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:e}).map((e,s)=>r.jsx(i,{height:12,width:`${80-8*s}%`},s))})}t(7577)},8145:(e,s,t)=>{"use strict";t.d(s,{V:()=>l,p:()=>a});var r=t(326),i=t(7577);let n=(0,i.createContext)(null);function a(){let e=(0,i.useContext)(n);if(!e)throw Error("useToast must be used within ToastProvider");return e}function l({children:e}){let[s,t]=(0,i.useState)([]),a=(e,s="info",r=3200)=>{let i=Date.now()+Math.floor(1e3*Math.random()),n={id:i,kind:s,text:e,ttl:Date.now()+r};t(e=>[...e,n]),setTimeout(()=>t(e=>e.filter(e=>e.id!==i)),r)},l=(0,i.useMemo)(()=>({show:a}),[]);return(0,r.jsxs)(n.Provider,{value:l,children:[e,r.jsx("div",{style:{position:"fixed",top:12,right:12,display:"flex",flexDirection:"column",gap:8,zIndex:1e3},children:s.map(e=>(0,r.jsxs)("div",{className:"card",style:{padding:"10px 12px",minWidth:260,maxWidth:360,borderLeft:`4px solid ${"success"===e.kind?"#22c55e":"error"===e.kind?"#ef4444":"#3b82f6"}`},children:[r.jsx("div",{style:{fontWeight:600,marginBottom:2},children:"success"===e.kind?"\xc9xito":"error"===e.kind?"Error":"Info"}),r.jsx("div",{className:"muted",children:e.text})]},e.id))})]})}},8069:(e,s,t)=>{"use strict";t.d(s,{S:()=>r,j:()=>i});let r="http://localhost:8081";async function i(e,s={},t){let i=new Headers(s.headers||{});i.set("Content-Type","application/json"),t&&i.set("Authorization",`Bearer ${t}`);let n=await fetch(`${r}${e}`,{...s,headers:i,cache:"no-store"});if(!n.ok){let e=await n.text().catch(()=>"");throw Error(`API ${n.status}: ${e||n.statusText}`)}return n.json()}},6208:(e,s,t)=>{"use strict";function r(e,s){}function i(){return null}function n(){}function a(){return null}t.d(s,{DH:()=>n,J1:()=>r,PR:()=>i,oC:()=>a})},5127:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/app/src/app/admin/ops/page.tsx#default`)},2029:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var r=t(9510);t(4315),t(1159);let i=(0,t(5782).default)(()=>t.e(298).then(t.bind(t,7298)),{loadableGenerated:{modules:["app/layout.tsx -> @/src/components/ClientShell"]},ssr:!1});function n({children:e}){return r.jsx("html",{lang:"es",children:r.jsx("body",{children:r.jsx(i,{children:e})})})}},4315:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[555],()=>t(4558));module.exports=r})();