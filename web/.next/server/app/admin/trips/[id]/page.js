(()=>{var e={};e.id=970,e.ids=[970],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8544:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>o});var n=s(3191),i=s(8716),r=s(7922),a=s.n(r),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["admin",{children:["trips",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5836)),"/app/src/app/admin/trips/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/admin/trips/[id]/page.tsx"],u="/admin/trips/[id]/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/trips/[id]/page",pathname:"/admin/trips/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4733:(e,t,s)=>{Promise.resolve().then(s.bind(s,2612))},2612:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var n=s(326),i=s(7577),r=s(8069),a=s(6208),l=s(434),d=s(6836),o=s(2326);function c({params:e}){let{id:t}=e,[s,c]=(0,i.useState)(null),[h,g]=(0,i.useState)(!0),[m,x]=(0,i.useState)(null),[j,v]=(0,i.useState)(!0),[y,f]=(0,i.useState)(!0),[N,b]=(0,i.useState)([]);(0,i.useRef)(null);let[w,S]=(0,i.useState)(null);async function P(){let e=(0,a.oC)();if(!e){location.href="/login";return}try{let s=await (0,r.j)(`/trips/${encodeURIComponent(t)}/driver-location`,{},e);S({lat:s.lat,lng:s.lng,at:s.locationUpdatedAt})}catch(e){alert(e?.message||"No se pudo obtener ubicaci\xf3n")}}return h?(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[n.jsx(o.qM,{height:24,width:240}),(0,n.jsxs)("div",{className:"row",style:{gap:8},children:[n.jsx(o.qM,{height:32,width:120}),n.jsx(o.qM,{height:32,width:140})]})]}),n.jsx("div",{style:{marginTop:10},children:n.jsx(o.ik,{lines:2})}),n.jsx("div",{style:{marginTop:16},children:n.jsx(o.qM,{height:360})}),(0,n.jsxs)("div",{className:"row",style:{gap:8,marginTop:12},children:[n.jsx(o.qM,{height:32,width:160}),n.jsx(o.qM,{height:32,width:160}),n.jsx(o.qM,{height:32,width:160})]})]}):m?n.jsx("div",{style:{color:"var(--danger)"},children:m}):s?(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,n.jsxs)("h2",{children:["Trip ",s.id]}),(0,n.jsxs)("div",{className:"row",style:{gap:8},children:["COMPLETED"!==s.status&&"CANCELED"!==s.status&&n.jsx("button",{className:"btn secondary",onClick:p,children:"Cancelar"}),(0,n.jsxs)("button",{className:"btn secondary",onClick:()=>v(e=>!e),children:[j?"Pausar":"Reanudar"," auto-refresh"]}),n.jsx("button",{className:"btn secondary",onClick:()=>f(e=>!e),children:y?"Usar polling":"Usar SSE"}),n.jsx(l.default,{className:"btn secondary",href:"/admin/trips",children:"Volver"})]})]}),(0,n.jsxs)("p",{className:"muted",children:["Status: ",s.status]}),(0,n.jsxs)("div",{className:"row",style:{gap:24},children:[(0,n.jsxs)("div",{children:[n.jsx("strong",{children:"Rider"}),n.jsx("div",{className:"muted",children:s.riderId||"-"})]}),(0,n.jsxs)("div",{children:[n.jsx("strong",{children:"Driver"}),n.jsx("div",{className:"muted",children:s.driverId||"-"})]}),(0,n.jsxs)("div",{children:[n.jsx("strong",{children:"Ciudad"}),n.jsx("div",{className:"muted",children:s.city||"-"})]})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Fechas"}),(0,n.jsxs)("div",{className:"muted",children:["requested: ",u(s.requestedAt)," \xb7 started: ",u(s.startedAt)," \xb7 completed: ",u(s.completedAt)]})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Coordenadas"}),n.jsx("pre",{className:"card",style:{overflow:"auto"},children:JSON.stringify({origin:s.origin,destination:s.destination},null,2)})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Mapa"}),n.jsx("div",{className:"card",style:{padding:0},children:n.jsx(d.Z,{origin:s?.origin&&"number"==typeof s.origin.lat&&"number"==typeof s.origin.lng?{lat:s.origin.lat,lng:s.origin.lng}:s?.pickupLat!=null&&s?.pickupLng!=null?{lat:Number(s.pickupLat),lng:Number(s.pickupLng)}:null,destination:s?.destination&&"number"==typeof s.destination.lat&&"number"==typeof s.destination.lng?{lat:s.destination.lat,lng:s.destination.lng}:s?.dropoffLat!=null&&s?.dropoffLng!=null?{lat:Number(s.dropoffLat),lng:Number(s.dropoffLng)}:null,driver:w&&null!=w.lat&&null!=w.lng?{lat:Number(w.lat),lng:Number(w.lng)}:void 0,height:360})})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Driver (ubicaci\xf3n actual)"}),(0,n.jsxs)("div",{className:"row",style:{gap:8},children:[n.jsx("button",{className:"btn secondary",onClick:P,children:"Actualizar ubicaci\xf3n"}),w&&(0,n.jsxs)("span",{className:"muted",children:[w.lat??"-",", ",w.lng??"-"," â€¢ ",w.at?new Date(w.at).toLocaleString():"-"]})]})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Pricing"}),n.jsx("pre",{className:"card",style:{overflow:"auto"},children:JSON.stringify(s.pricing||{},null,2)})]}),(0,n.jsxs)("div",{style:{marginTop:16},children:[n.jsx("strong",{children:"Eventos"}),0===N.length?n.jsx("div",{className:"muted",children:"Sin eventos a\xfan."}):n.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:N.map((e,t)=>(0,n.jsxs)("li",{className:"card",style:{marginTop:8},children:[n.jsx("div",{className:"muted",children:e.event||"message"}),n.jsx("pre",{style:{overflow:"auto"},children:JSON.stringify(e.data,null,2)})]},t))})]})]}):n.jsx("div",{children:"No encontrado"})}function u(e){if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}}async function p(){if(!confirm("\xbfSeguro que deseas cancelar este viaje?"))return;let e=prompt("Motivo de cancelaci\xf3n (opcional):","ADMIN_PANEL"),t=(0,a.oC)();if(!t){location.href="/login";return}try{await (0,r.j)(`/trips/${encodeURIComponent(location.pathname.split("/").pop()||"")}/cancel`,{method:"POST",body:JSON.stringify({reason:e||"ADMIN_PANEL"})},t),location.reload()}catch(e){alert(e?.message||"No se pudo cancelar")}}},2326:(e,t,s)=>{"use strict";s.d(t,{ik:()=>r,qM:()=>i});var n=s(326);function i({height:e=16,width:t="100%",style:s,className:i}){return n.jsx("div",{className:i,style:{height:e,width:t,background:"linear-gradient(90deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.12) 37%, rgba(255,255,255,0.06) 63%)",backgroundSize:"400% 100%",animation:"skeleton 1.2s ease-in-out infinite",borderRadius:8,...s}})}function r({lines:e=3}){return n.jsx("div",{className:"row",style:{gap:8,flexDirection:"column"},children:Array.from({length:e}).map((e,t)=>n.jsx(i,{height:12,width:`${80-8*t}%`},t))})}s(7577)},8069:(e,t,s)=>{"use strict";s.d(t,{S:()=>n,j:()=>i});let n="http://localhost:8081";async function i(e,t={},s){let i=new Headers(t.headers||{});i.set("Content-Type","application/json"),s&&i.set("Authorization",`Bearer ${s}`);let r=await fetch(`${n}${e}`,{...t,headers:i,cache:"no-store"});if(!r.ok){let e=await r.text().catch(()=>"");throw Error(`API ${r.status}: ${e||r.statusText}`)}return r.json()}},5836:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});let n=(0,s(8570).createProxy)(String.raw`/app/src/app/admin/trips/[id]/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[555,791],()=>s(8544));module.exports=n})();