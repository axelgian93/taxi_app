(()=>{var e={};e.id=101,e.ids=[101],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9390:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=a(3191),s=a(8716),n=a(7922),i=a.n(n),o=a(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);a.d(t,l);let d=["",{children:["admin",{children:["demo",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,9737)),"/app/src/app/admin/demo/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2029)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/admin/demo/page.tsx"],u="/admin/demo/page",p={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/demo/page",pathname:"/admin/demo",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1899:(e,t,a)=>{Promise.resolve().then(a.bind(a,2782))},5047:(e,t,a)=>{"use strict";var r=a(7389);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},2782:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(326),s=a(7577),n=a(5047),i=a(6836);async function o(e,t){let a=new AbortController,r=t.signal?function(e,t){if(e.aborted)return e;if(t.aborted)return t;let a=new AbortController,r=()=>a.abort();return e.addEventListener("abort",r),t.addEventListener("abort",r),a.signal}(a.signal,t.signal):a.signal,s=await fetch(e,{method:"GET",headers:{Accept:"text/event-stream",...t.token?{Authorization:`Bearer ${t.token}`}:{}},cache:"no-store",signal:r});if(!s.ok||!s.body)throw Error(`SSE HTTP ${s.status}`);let n=s.body.getReader(),i=new TextDecoder("utf-8"),o="",l=!1;return(async()=>{try{for(;;){let e;let{value:a,done:r}=await n.read();if(r)break;for(o+=i.decode(a,{stream:!0});-1!==(e=o.indexOf("\n\n"));){let a=o.slice(0,e);o=o.slice(e+2);let r=function(e){let t;let a=e.split(/\r?\n/),r=[];for(let e of a){if(!e||e.startsWith(":"))continue;let a=e.indexOf(":"),s=-1===a?e:e.slice(0,a),n=-1===a?"":e.slice(a+1).replace(/^ /,"");"event"===s?t=n:"data"===s&&r.push(n)}let s=r.join("\n"),n=s;try{n=s?JSON.parse(s):void 0}catch{}return t||s?{event:t,data:n}:null}(a);r&&t.onEvent(r)}}}catch{}finally{l||a.abort()}})(),{close:()=>{l=!0,a.abort()}}}var l=a(8069),d=a(6208),c=a(8145);function u(){let{show:e}=(0,c.p)();(0,n.useSearchParams)();let[t,a]=(0,s.useState)("Guayaquil"),[u,m]=(0,s.useState)({lat:-2.170998,lng:-79.922359}),[h,f]=(0,s.useState)({lat:-2.185,lng:-79.9}),[g,x]=(0,s.useState)(null),[y,b]=(0,s.useState)([]),[j,v]=(0,s.useState)(!1);async function S(){v(!0);let t=(0,d.oC)();if(!t)return alert("Inicia sesi\xf3n");try{let a=await fetch(`${l.S}/admin/demo/seed`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw Error(`HTTP ${a.status}`);alert("Demo seeded: usuarios y tarifas listos (pwd 123456)"),e("Demo seeded: usuarios y tarifas listos (pwd 123456)","success")}catch(e){alert(e?.message||"Error")}finally{v(!1)}}async function P(){v(!0);let t=(0,d.oC)();if(!t)return alert("Inicia sesi\xf3n");try{let a=await fetch(`${l.S}/admin/demo/reset`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw Error(`HTTP ${a.status}`);x(null),b([]),alert("Demo reseteada"),e("Demo reseteada","success")}catch(e){alert(e?.message||"Error")}finally{v(!1)}}async function k(){if(!u||!h)return alert("Define origen y destino");v(!0);try{let a=(0,d.oC)();if(!a)return alert("Inicia sesi\xf3n");let r={city:t,pickupLat:u.lat,pickupLng:u.lng,dropoffLat:h.lat,dropoffLng:h.lng,distanceKm:3.2,durationMin:10},s=await (0,l.j)("/trips/request",{method:"POST",body:JSON.stringify(r)},a);x({id:s.trip.id,status:s.trip.status,pickupLat:u.lat,pickupLng:u.lng,dropoffLat:h.lat,dropoffLng:h.lng,city:t}),function(e){let t=(0,d.oC)();t&&o(`${l.S}/trips/${encodeURIComponent(e)}/sse`,{token:t,onEvent:e=>{b(t=>[e,...t].slice(0,50)),e?.data?.status&&x(t=>t?{...t,status:e.data.status}:t)}}).catch(()=>{})}(s.trip.id),e("Viaje solicitado","success")}catch(e){alert(e?.message||"Error")}finally{v(!1)}}async function N(){if(!g)return;let t=(0,d.oC)();if(!t)return alert("Inicia sesi\xf3n");await fetch(`${l.S}/admin/demo/trips/${encodeURIComponent(g.id)}/assign-driver`,{method:"POST",headers:{Authorization:`Bearer ${t}`}}),e("Driver asignado","success")}async function C(t){if(!g)return;let a=(0,d.oC)();if(!a)return alert("Inicia sesi\xf3n");await fetch(`${l.S}/admin/demo/trips/${encodeURIComponent(g.id)}/advance`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({to:t})}),e(`Avanzado a ${t}`,"success")}return(0,r.jsxs)("div",{children:[r.jsx("h2",{children:"Demo de Viaje"}),(0,r.jsxs)("div",{className:"muted",style:{marginBottom:8},children:["\xbfNecesitas gu\xeda? Revisa ",r.jsx("a",{href:"/admin/readme",children:"/admin/readme"})]}),(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Ciudad"}),r.jsx("input",{value:t,onChange:e=>a(e.target.value)})]}),r.jsx("button",{className:"btn secondary",onClick:S,disabled:j,children:"Start Demo (seed)"}),r.jsx("button",{className:"btn secondary",onClick:P,disabled:j,children:"Reset Demo"})]}),(0,r.jsxs)("div",{className:"card",style:{marginTop:10},children:[(0,r.jsxs)("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Origen (click en mapa)"}),r.jsx("input",{type:"text",value:u?`${u.lat.toFixed(6)}, ${u.lng.toFixed(6)}`:"",readOnly:!0})]}),(0,r.jsxs)("label",{children:[r.jsx("div",{className:"muted",children:"Destino (click en mapa con ALT)"}),r.jsx("input",{type:"text",value:h?`${h.lat.toFixed(6)}, ${h.lng.toFixed(6)}`:"",readOnly:!0})]}),r.jsx("button",{className:"btn",onClick:k,disabled:j||!u||!h,children:"Solicitar viaje"}),r.jsx("button",{className:"btn secondary",onClick:N,disabled:!g,children:"Asignar driver"}),r.jsx("button",{className:"btn secondary",onClick:()=>C("ACCEPTED"),disabled:!g,children:"Aceptar"}),r.jsx("button",{className:"btn secondary",onClick:()=>C("ARRIVED"),disabled:!g,children:"Llegar"}),r.jsx("button",{className:"btn secondary",onClick:()=>C("STARTED"),disabled:!g,children:"Iniciar"}),r.jsx("button",{className:"btn secondary",onClick:()=>C("COMPLETED"),disabled:!g,children:"Completar"})]}),r.jsx("div",{style:{height:360,marginTop:10},children:r.jsx(p,{origin:u,dest:h,onPick:e=>m(e),onPickAlt:e=>f(e)})})]}),g&&(0,r.jsxs)("div",{className:"card",style:{marginTop:10},children:[(0,r.jsxs)("strong",{children:["Trip ",g.id]}),(0,r.jsxs)("div",{className:"muted",children:["Status: ",g.status]}),r.jsx(i.Z,{origin:u||(g.pickupLat&&g.pickupLng?{lat:Number(g.pickupLat),lng:Number(g.pickupLng)}:null),destination:h||(g.dropoffLat&&g.dropoffLng?{lat:Number(g.dropoffLat),lng:Number(g.dropoffLng)}:null),height:300}),(0,r.jsxs)("div",{style:{marginTop:10},children:[r.jsx("strong",{children:"Eventos"}),0===y.length?r.jsx("div",{className:"muted",children:"Sin eventos a\xfan."}):r.jsx("ul",{style:{listStyle:"none",padding:0},children:y.map((e,t)=>(0,r.jsxs)("li",{className:"card",style:{marginTop:6},children:[r.jsx("div",{className:"muted",children:e.event}),r.jsx("pre",{children:JSON.stringify(e.data,null,2)})]},t))})]})]})]})}function p({origin:e,dest:t,onPick:a,onPickAlt:n}){let i=(0,s.useRef)(null),o=(0,s.useRef)(null),l=(0,s.useRef)({});function d(e,t,a){let r=window.L,s=o.current;if(!r||!s)return;let n=l.current;n[e]?n[e].setLatLng([t.lat,t.lng]):n[e]=r.circleMarker([t.lat,t.lng],{radius:8,color:a,fillColor:a,fillOpacity:.6}).addTo(s)}return(0,s.useEffect)(()=>{o.current&&e&&d("o",e,"#22c55e")},[JSON.stringify(e)]),(0,s.useEffect)(()=>{o.current&&t&&d("d",t,"#ef4444")},[JSON.stringify(t)]),r.jsx("div",{ref:i,style:{width:"100%",height:"100%"}})}},8069:(e,t,a)=>{"use strict";a.d(t,{S:()=>r,j:()=>s});let r="http://localhost:8081";async function s(e,t={},a){let s=new Headers(t.headers||{});s.set("Content-Type","application/json"),a&&s.set("Authorization",`Bearer ${a}`);let n=await fetch(`${r}${e}`,{...t,headers:s,cache:"no-store"});if(!n.ok){let e=await n.text().catch(()=>"");throw Error(`API ${n.status}: ${e||n.statusText}`)}return n.json()}},9737:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(8570).createProxy)(String.raw`/app/src/app/admin/demo/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[555,791],()=>a(9390));module.exports=r})();